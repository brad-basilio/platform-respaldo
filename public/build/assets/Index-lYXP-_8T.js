import{c as je,r as F,U as Ne,j as t,a as we,b as re}from"./app-CwxdnFbm.js";import{t as c,A as Se}from"./AuthenticatedLayout-DPWZ-5h6.js";import{I as u}from"./input-CgbuVXOQ.js";import{B as Ce}from"./button-q2cQFBzn.js";import{T as Pe,S as Ee,a as ke}from"./textarea-BIpmM5YD.js";import{S as Fe}from"./Select2-D7hKT7o8.js";import{M as ze,a as De,C as Me,A as Re,t as Te}from"./ag-grid-custom-7pHCTvbw.js";import{C as me}from"./credit-card-In5WNqPE.js";import{T as Ae,P as $e}from"./trash-2-DoVgB211.js";import{S as Be}from"./search-3tb-sHD5.js";/* empty css            */import"./graduation-cap-l7Ws-pDZ.js";import"./createLucideIcon-B582JtdG.js";import"./settings-BVi-z_PT.js";import"./video-BlmAYXVS.js";import"./chart-pie-BiTuHYZb.js";import"./users-CFn3_c4S.js";import"./book-open-Dka01MhU.js";import"./award-B1uUNeYR.js";import"./user-check-B27WC56d.js";import"./index-wUkP_laI.js";import"./utils-D0Zg16Wk.js";import"./index-Df53GKCf.js";import"./index-DINtjDLr.js";import"./index-DVJW481j.js";import"./floating-ui.dom-l_pIkl4b.js";ze.registerModules([De]);const Nt=n=>{const e=je.c(78),{paymentPlans:fe,academicLevels:d,selectedLevelId:ge}=n,[o,_e]=F.useState(fe),[r,ue]=F.useState(ge),[ie,h]=F.useState(!1),[m,pe]=F.useState(null),[x,he]=F.useState("");let M;e[0]===Symbol.for("react.memo_cache_sentinel")?(M={name:"",academic_level_id:void 0,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""},e[0]=M):M=e[0];const[s,i]=F.useState(M);let R;e[1]===Symbol.for("react.memo_cache_sentinel")?(R=async()=>{try{const l=(await we.get("/api/admin/payment-plans")).data;Array.isArray(l)&&(_e(l),console.log("✅ Planes de pago actualizados desde el servidor:",l.length,"planes"))}catch(a){console.error("❌ Error fetching payment plans:",a),c.error("Error al obtener planes de pago",{description:"No se pudo sincronizar con el servidor.",duration:5e3})}},e[1]=R):R=e[1];const f=R;let T,A;e[2]===Symbol.for("react.memo_cache_sentinel")?(T=()=>{f()},A=[f],e[2]=T,e[3]=A):(T=e[2],A=e[3]),Ne.useEffect(T,A);let $;e[4]!==o||e[5]!==r?($=r?o.filter(a=>a.academic_level_id===r):o,e[4]=o,e[5]=r,e[6]=$):$=e[6];const g=$;let B;e[7]===Symbol.for("react.memo_cache_sentinel")?(B=a=>{pe(a),i({name:a.name,academic_level_id:a.academic_level_id,installments_count:a.installments_count,monthly_amount:a.monthly_amount,total_amount:a.total_amount,discount_percentage:a.discount_percentage,duration_months:a.duration_months,late_fee_percentage:a.late_fee_percentage,grace_period_days:a.grace_period_days,is_active:a.is_active,description:a.description||""}),h(!0)},e[7]=B):B=e[7];const ve=B;let q;e[8]===Symbol.for("react.memo_cache_sentinel")?(q=a=>{confirm(`¿Estás seguro de eliminar el plan "${a.name}"?`)&&re.delete(`/admin/payment-plans/${a.id}`,{preserveScroll:!0,onSuccess:async()=>{c.success("Plan de pago eliminado exitosamente"),await f()},onError:qe})},e[8]=q):q=e[8];const ye=q;let I,L,G,H,Q,W;e[9]===Symbol.for("react.memo_cache_sentinel")?(Q={headerName:"Plan de Pago",field:"name",flex:1,minWidth:250,filter:"agTextColumnFilter",cellRenderer:Ie},W={headerName:"Cuotas",field:"installments_count",width:100,cellRenderer:Le},I={headerName:"Mensualidad",field:"monthly_amount",width:140,cellRenderer:Ge},L={headerName:"Total",field:"total_amount",width:140,cellRenderer:He},G={headerName:"Descuento",field:"discount_percentage",width:120,cellRenderer:Qe},H={headerName:"Duración",field:"duration_months",width:110,cellRenderer:We},e[9]=I,e[10]=L,e[11]=G,e[12]=H,e[13]=Q,e[14]=W):(I=e[9],L=e[10],G=e[11],H=e[12],Q=e[13],W=e[14]);let U;e[15]===Symbol.for("react.memo_cache_sentinel")?(U={headerName:"Estado",field:"is_active",width:120,cellRenderer:a=>{const l=a.data,p=a.value,xe=async D=>{if(!l||!l.id){c.error("Error",{description:"No se pudo identificar el plan de pago",duration:3e3});return}re.put(`/admin/payment-plans/${l.id}`,{name:l.name,academic_level_id:l.academic_level_id,installments_count:l.installments_count,monthly_amount:l.monthly_amount,total_amount:l.total_amount,discount_percentage:l.discount_percentage,duration_months:l.duration_months,late_fee_percentage:l.late_fee_percentage,grace_period_days:l.grace_period_days,is_active:D,description:l.description},{preserveScroll:!0,onSuccess:async()=>{await f(),c.success(D?"Plan activado":"Plan desactivado",{description:`El plan "${l.name}" ha sido ${D?"activado":"desactivado"}`,duration:3e3})},onError:Ue})};return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(Ee,{checked:p,onCheckedChange:xe})})}},e[15]=U):U=e[15];let X;e[16]===Symbol.for("react.memo_cache_sentinel")?(X=[Q,W,I,L,G,H,U,{headerName:"Acciones",width:120,sortable:!1,filter:!1,cellRenderer:a=>{const l=a.data;return t.jsxs("div",{className:"flex items-center justify-center space-x-2 h-full",children:[t.jsx("button",{onClick:()=>ve(l),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded transition-colors",title:"Editar plan",children:t.jsx(ke,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>ye(l),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded transition-colors",title:"Eliminar plan",children:t.jsx(Ae,{className:"h-4 w-4"})})]})}}],e[16]=X):X=e[16];const be=X;let J;e[17]!==d[0]?.id||e[18]!==r?(J=()=>{pe(null),i({name:"",academic_level_id:r||d[0]?.id,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""}),h(!0)},e[17]=d[0]?.id,e[18]=r,e[19]=J):J=e[19];const oe=J;let K;e[20]!==m||e[21]!==s?(K=a=>{a.preventDefault();const{academic_level:l,...p}=s;m?re.put(`/admin/payment-plans/${m.id}`,p,{preserveScroll:!0,onSuccess:async()=>{c.success("Plan de pago actualizado exitosamente"),h(!1),await f()},onError:Xe}):re.post("/admin/payment-plans",p,{preserveScroll:!0,onSuccess:async()=>{c.success("Plan de pago creado exitosamente"),h(!1),await f()},onError:Je})},e[20]=m,e[21]=s,e[22]=K):K=e[22];const ce=K;let O;e[23]!==s?(O=()=>{const a=s.monthly_amount||0,l=s.installments_count||1,p=s.discount_percentage||0,D=a*l*(1-p/100);i({...s,total_amount:Math.round(D*100)/100})},e[23]=s,e[24]=O):O=e[24];const z=O;let V;e[25]===Symbol.for("react.memo_cache_sentinel")?(V=t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(me,{className:"w-7 h-7 text-blue-600"}),"Planes de Pago"]}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Configura los planes de pago por nivel académico"})]}),e[25]=V):V=e[25];let Y;e[26]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsx($e,{className:"w-4 h-4"}),e[26]=Y):Y=e[26];let _;e[27]!==oe?(_=t.jsxs("div",{className:"flex items-center justify-between",children:[V,t.jsxs(Ce,{onClick:oe,className:"flex items-center gap-2",children:[Y,"Nuevo Plan"]})]}),e[27]=oe,e[28]=_):_=e[28];let Z,ee;e[29]===Symbol.for("react.memo_cache_sentinel")?(Z=a=>he(a.target.value),ee=t.jsx(Be,{className:"w-4 h-4"}),e[29]=Z,e[30]=ee):(Z=e[29],ee=e[30]);let v,y;e[31]!==x?(v=t.jsx(u,{type:"text",label:"Buscar por nombre, nivel, descripción...",value:x,onChange:Z,icon:ee,className:"pr-10"}),y=x&&t.jsx("button",{onClick:()=>he(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:t.jsx(Me,{className:"w-5 h-5"})}),e[31]=x,e[32]=v,e[33]=y):(v=e[32],y=e[33]);let b;e[34]!==v||e[35]!==y?(b=t.jsxs("div",{className:"relative",children:[v,y]}),e[34]=v,e[35]=y,e[36]=b):b=e[36];let te;e[37]===Symbol.for("react.memo_cache_sentinel")?(te=()=>ue(void 0),e[37]=te):te=e[37];const de=`px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${r?"text-gray-600 hover:bg-gray-50":"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-md"}`;let j;e[38]!==o.length?(j=t.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-white/20",children:o.length}),e[38]=o.length,e[39]=j):j=e[39];let N;e[40]!==de||e[41]!==j?(N=t.jsxs("button",{onClick:te,className:de,children:["Todos los Planes",j]}),e[40]=de,e[41]=j,e[42]=N):N=e[42];let w;if(e[43]!==d||e[44]!==o||e[45]!==r){let a;e[47]!==o||e[48]!==r?(a=l=>t.jsxs("button",{onClick:()=>ue(l.id),className:`px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${r===l.id?"text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,style:r===l.id?{background:`linear-gradient(to right, ${l.color||"#3B82F6"}, ${l.color||"#3B82F6"}dd)`}:{},children:[l.name,t.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-white/20",children:o.filter(p=>p.academic_level_id===l.id).length})]},l.id),e[47]=o,e[48]=r,e[49]=a):a=e[49],w=d.map(a),e[43]=d,e[44]=o,e[45]=r,e[46]=w}else w=e[46];let S;e[50]!==N||e[51]!==w?(S=t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-1 inline-flex overflow-x-auto",children:t.jsxs("div",{className:"flex space-x-2",children:[N,w]})}),e[50]=N,e[51]=w,e[52]=S):S=e[52];let ae;e[53]===Symbol.for("react.memo_cache_sentinel")?(ae={height:"calc(100vh - 400px)",width:"100%"},e[53]=ae):ae=e[53];let le;e[54]===Symbol.for("react.memo_cache_sentinel")?(le={sortable:!0,resizable:!0},e[54]=le):le=e[54];let se;e[55]===Symbol.for("react.memo_cache_sentinel")?(se=[10,20,50,100],e[55]=se):se=e[55];let C;e[56]!==g||e[57]!==x?(C=t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:t.jsx("div",{className:"ag-theme-quartz",style:ae,children:t.jsx(Re,{rowData:g,columnDefs:be,quickFilterText:x,defaultColDef:le,pagination:!0,paginationPageSize:20,paginationPageSizeSelector:se,animateRows:!0,rowHeight:70,headerHeight:50,theme:Te})})}),e[56]=g,e[57]=x,e[58]=C):C=e[58];let P;e[59]!==b||e[60]!==S||e[61]!==C?(P=t.jsxs("div",{className:"space-y-4",children:[b,S,C]}),e[59]=b,e[60]=S,e[61]=C,e[62]=P):P=e[62];let E;e[63]!==g.length||e[64]!==r?(E=g.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(me,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 text-lg",children:r?"No hay planes de pago para este nivel académico":"No hay planes de pago registrados"}),t.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Crea el primer plan para comenzar"})]}),e[63]=g.length,e[64]=r,e[65]=E):E=e[65];let k;e[66]!==d||e[67]!==z||e[68]!==m||e[69]!==s||e[70]!==ce||e[71]!==ie?(k=ie&&t.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/75 backdrop-blur-sm animate-fade-in flex items-center justify-center p-4",onClick:()=>h(!1),style:{height:"100vh",width:"100vw"},children:t.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col animate-scale-in",onClick:Ke,children:[t.jsx("div",{className:"relative bg-blue-600 px-8 py-6 rounded-t-3xl flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:m?"Editar Plan de Pago":"Nuevo Plan de Pago"}),t.jsx("p",{className:"text-blue-100",children:m?"Actualiza la información del plan":"Completa la información para crear un nuevo plan"})]}),t.jsx("button",{type:"button",onClick:()=>h(!1),className:"text-white/80 hover:text-white hover:bg-white/10 rounded-full p-2 transition-all duration-200",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),t.jsxs("form",{onSubmit:ce,className:"flex flex-col flex-1 overflow-hidden",children:[t.jsx("div",{className:"p-8 space-y-6 overflow-y-auto flex-1",children:t.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[t.jsx(u,{label:"Nombre del Plan",value:s.name,onChange:a=>i({...s,name:a.target.value}),placeholder:"Ej: Plan Premium, Plan Estándar",required:!0}),t.jsxs("div",{children:[t.jsx(Fe,{value:s.academic_level_id,onChange:a=>i({...s,academic_level_id:a}),options:d.map(Oe),label:"Selecciona un nivel académico"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Nivel académico al que pertenece el plan"})]}),t.jsx(Pe,{label:"Descripción",value:s.description,onChange:a=>i({...s,description:a.target.value}),placeholder:"Descripción opcional del plan",rows:2}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(u,{label:"Número de Cuotas",type:"number",value:s.installments_count,onChange:a=>i({...s,installments_count:parseInt(a.target.value)||1}),onBlur:z,min:1,max:12,required:!0})}),t.jsx("div",{children:t.jsx(u,{label:"Duración (meses)",type:"number",value:s.duration_months,onChange:a=>i({...s,duration_months:parseInt(a.target.value)||1}),min:1,required:!0})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(u,{label:"Monto Mensual (S/)",type:"number",step:"0.01",value:s.monthly_amount,onChange:a=>i({...s,monthly_amount:parseFloat(a.target.value)||0}),onBlur:z,min:0,required:!0})}),t.jsx("div",{children:t.jsx(u,{label:"Descuento (%)",type:"number",step:"0.01",value:s.discount_percentage,onChange:a=>i({...s,discount_percentage:parseFloat(a.target.value)||0}),onBlur:z,min:0,max:100})})]}),t.jsxs("div",{children:[t.jsx(u,{label:"Monto Total (S/)",type:"number",step:"0.01",value:s.total_amount,onChange:a=>i({...s,total_amount:parseFloat(a.target.value)||0}),min:0,required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se calcula automáticamente: (Mensualidad × Cuotas) - Descuento"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(u,{label:"Mora Mensual (%)",type:"number",step:"0.01",value:s.late_fee_percentage,onChange:a=>i({...s,late_fee_percentage:parseFloat(a.target.value)||0}),min:0,max:100})}),t.jsx("div",{children:t.jsx(u,{label:"Período de Gracia (días)",type:"number",value:s.grace_period_days,onChange:a=>i({...s,grace_period_days:parseInt(a.target.value)||0}),min:0})})]})]})}),t.jsx("div",{className:"bg-gray-50 px-8 py-6 rounded-b-3xl border-t-2 border-gray-200 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 py-3 text-gray-700 bg-white hover:bg-gray-100 border-2 border-gray-300 rounded-xl font-semibold transition-all duration-200",children:"Cancelar"}),t.jsx("button",{type:"submit",className:"px-6 py-3 rounded-xl font-semibold transition-all duration-200 shadow-sm bg-blue-600 hover:bg-blue-700 text-white",children:m?"Actualizar Plan":"Crear Plan"})]})})]})]})}),e[66]=d,e[67]=z,e[68]=m,e[69]=s,e[70]=ce,e[71]=ie,e[72]=k):k=e[72];let ne;return e[73]!==_||e[74]!==P||e[75]!==E||e[76]!==k?(ne=t.jsx(Se,{children:t.jsxs("div",{className:"p-6 space-y-6",children:[_,P,E,k]})}),e[73]=_,e[74]=P,e[75]=E,e[76]=k,e[77]=ne):ne=e[77],ne};function qe(){c.error("Error al eliminar plan de pago")}function Ie(n){const e=n.data;return t.jsxs("div",{className:"flex items-center py-2 h-full",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:e.academic_level?.color||"#3B82F6"},children:t.jsx(me,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-xs text-gray-500",children:e.academic_level?.name})]})]})}function Le(n){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800",children:n.value})})}function Ge(n){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["S/ ",n.value.toFixed(2)]})})}function He(n){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["S/ ",n.value.toFixed(2)]})})}function Qe(n){const e=n.value||0;return t.jsx("div",{className:"flex items-center justify-center h-full",children:e>0?t.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:[e,"%"]}):t.jsx("span",{className:"text-xs text-gray-400",children:"Sin descuento"})})}function We(n){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-sm text-gray-600",children:[n.value," meses"]})})}function Ue(n){console.error("❌ Error al cambiar estado:",n),c.error("Error al cambiar estado")}function Xe(n){console.error(n),c.error("Error al actualizar plan de pago")}function Je(n){console.error(n),c.error("Error al crear plan de pago")}function Ke(n){return n.stopPropagation()}function Oe(n){return{value:n.id,label:n.name}}export{Nt as default};
