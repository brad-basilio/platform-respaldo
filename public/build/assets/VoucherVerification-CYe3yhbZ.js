import{r,j as e}from"./app-DSVeOK47.js";import{t as o,A as M,F as T,e as P,C as E,n as F}from"./AuthenticatedLayout-B0PnzZYA.js";import{B as n}from"./button-qF2hMlUR.js";import{B as R}from"./badge-Dm7VyEuu.js";import{A as O,a as _}from"./alert-Cn7BhGxs.js";import{T as B}from"./textarea-CcyuIas9.js";import{e as L,d as $,D as q,a as X,c as I}from"./dialog-BBTTqs3x.js";import{L as p}from"./loader-circle-BFUHj-Ct.js";import{C as N}from"./circle-check-CmeTww9s.js";import{C as K}from"./calendar-yqpnbgvG.js";import{C as H}from"./credit-card-BgqffAWY.js";import{E as A}from"./eye-MtJRvnZp.js";import{C as J}from"./circle-alert-5fFICnpS.js";import{f as U,p as G}from"./parseISO-BF3vvqhW.js";/* empty css            */import"./dropdown-menu-BBLlZevk.js";import"./createLucideIcon-D2yacS8E.js";import"./index-9slIqL29.js";import"./index-BmMNtogR.js";import"./index-Byh3KcYV.js";import"./x-Celym2f-.js";import"./triangle-alert-DdpNgicO.js";import"./circle-check-big-CrG6Q2ty.js";import"./clock-M5dfVafe.js";import"./clsx-B-dksMZM.js";import"./index-DhR4_bmJ.js";function ve(){const[j,D]=r.useState([]),[y,b]=r.useState(!0),[a,i]=r.useState(null),[k,d]=r.useState(!1),[u,z]=r.useState("approve"),[m,g]=r.useState(""),[c,x]=r.useState(!1);r.useEffect(()=>{h()},[]);const h=async()=>{b(!0);try{const s=await fetch("/api/vouchers/pending");if(!s.ok)throw new Error("Error al cargar vouchers pendientes");const t=await s.json();D(t.data||[])}catch(s){console.error("Error loading vouchers:",s),o.error("Error al cargar vouchers pendientes")}finally{b(!1)}},S=async()=>{if(a){x(!0);try{const s=await fetch(`/api/vouchers/${a.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!s.ok){const t=await s.json();throw new Error(t.message||"Error al aprobar voucher")}o.success("Voucher aprobado exitosamente"),d(!1),i(null),h()}catch(s){console.error("Error approving voucher:",s),o.error(s instanceof Error?s.message:"Error al aprobar voucher")}finally{x(!1)}}},V=async()=>{if(!a||!m.trim()){o.error("Debes proporcionar un motivo de rechazo");return}x(!0);try{const s=await fetch(`/api/vouchers/${a.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({rejection_reason:m})});if(!s.ok){const t=await s.json();throw new Error(t.message||"Error al rechazar voucher")}o.success("Voucher rechazado"),d(!1),i(null),g(""),h()}catch(s){console.error("Error rejecting voucher:",s),o.error(s instanceof Error?s.message:"Error al rechazar voucher")}finally{x(!1)}},v=(s,t)=>{i(s),z(t),d(!0)},w=()=>{d(!1),i(null),g("")},l=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),f=s=>{try{return U(G(s),"d 'de' MMMM, yyyy",{locale:F})}catch{return s}},C=s=>({cash:"Efectivo",transfer:"Transferencia",deposit:"Depósito",card:"Tarjeta"})[s]||s;return e.jsxs(M,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Verificación de Vouchers"}),e.jsx("p",{className:"text-gray-600",children:"Revisa y aprueba los vouchers de pago de cuotas"})]}),e.jsxs(n,{onClick:h,variant:"outline",children:[e.jsx(p,{className:`w-4 h-4 mr-2 ${y?"animate-spin":""}`}),"Actualizar"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Vouchers Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:j.length})]}),e.jsx(T,{className:"w-8 h-8 text-blue-500"})]})})}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{className:"w-8 h-8 animate-spin text-primary"})}):j.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"¡Todo al día!"}),e.jsx("p",{className:"text-gray-600",children:"No hay vouchers pendientes de verificación en este momento."})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Aprendiz"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cuota"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Fecha de Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Monto Declarado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Método"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Subido Por"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:s.installment?.enrollment?.student?.name||"N/A"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:["Cuota ",s.installment?.installment_number]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Vence: ",s.installment?.due_date?f(s.installment.due_date):"N/A"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"w-3 h-3 text-gray-400"}),f(s.payment_date)]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("p",{className:"text-sm font-semibold",children:l(s.declared_amount)}),s.installment?.totalDue&&s.declared_amount!==s.installment.totalDue&&e.jsxs("p",{className:"text-xs text-orange-600",children:["Esperado: ",l(s.installment.totalDue)]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs(R,{variant:"outline",className:"text-xs",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),C(s.payment_method)]}),s.transaction_reference&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Op: ",s.transaction_reference]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.uploadedBy?.name||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>window.open(`/api/vouchers/${s.id}`,"_blank"),children:e.jsx(A,{className:"w-3 h-3"})}),e.jsxs(n,{size:"sm",onClick:()=>v(s,"approve"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"Aprobar"]}),e.jsxs(n,{size:"sm",onClick:()=>v(s,"reject"),variant:"destructive",children:[e.jsx(E,{className:"w-3 h-3 mr-1"}),"Rechazar"]})]})})]},s.id))})]})})})]}),a&&e.jsx(L,{open:k,onOpenChange:w,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsx(q,{children:e.jsx(X,{children:u==="approve"?"Aprobar Voucher":"Rechazar Voucher"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Aprendiz:"}),e.jsx("p",{className:"font-semibold",children:a.installment?.enrollment?.student?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Cuota:"}),e.jsxs("p",{className:"font-semibold",children:["Cuota ",a.installment?.installment_number]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Monto Declarado:"}),e.jsx("p",{className:"font-semibold text-lg text-blue-600",children:l(a.declared_amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Monto a Pagar:"}),e.jsx("p",{className:"font-semibold text-lg",children:a.installment?.totalDue?l(a.installment.totalDue):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Método de Pago:"}),e.jsx("p",{className:"font-semibold",children:C(a.payment_method)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Fecha de Pago:"}),e.jsx("p",{className:"font-semibold",children:f(a.payment_date)})]})]}),a.transaction_reference&&e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"N° de Operación:"}),e.jsx("p",{className:"font-semibold",children:a.transaction_reference})]})]}),a.installment?.totalDue&&a.declared_amount!==a.installment.totalDue&&e.jsxs(O,{variant:"destructive",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsxs(_,{children:["El monto declarado (",l(a.declared_amount),") no coincide con el monto esperado (",l(a.installment.totalDue),")."]})]}),u==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"rejection_reason",className:"text-sm font-semibold text-gray-700",children:"Motivo del Rechazo *"}),e.jsx(B,{id:"rejection_reason",value:m,onChange:s=>g(s.target.value),placeholder:"Explica por qué se rechaza este voucher...",rows:4,required:!0})]}),e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>window.open(`/api/vouchers/${a.id}`,"_blank"),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Ver Voucher en Nueva Pestaña"]})]}),e.jsxs(I,{children:[e.jsx(n,{variant:"outline",onClick:w,disabled:c,children:"Cancelar"}),u==="approve"?e.jsx(n,{onClick:S,disabled:c,className:"bg-green-600 hover:bg-green-700",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}),"Aprobando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Confirmar Aprobación"]})}):e.jsx(n,{onClick:V,disabled:c||!m.trim(),variant:"destructive",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}),"Rechazando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Confirmar Rechazo"]})})]})]})})]})}export{ve as default};
