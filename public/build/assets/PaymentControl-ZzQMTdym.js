import{r as C,j as e,a as oe,c as fe}from"./app-CFjDzXMp.js";import{A as ge,C as z,S as K,F as Y,D as me}from"./AuthenticatedLayout-Dz0yZKcw.js";import{A as be,t as je,M as Ne,a as ye}from"./index.esm-DTi-nA7O.js";import{I as we}from"./input-BRaku5sj.js";/* empty css                       */import{C as de}from"./clock-K-JLNY1M.js";import{E as xe}from"./eye-JxeMA3dr.js";import{S as ve}from"./search-D0GS7P1O.js";import{U as Ce}from"./users-BbVcWBVS.js";import{C as X}from"./circle-alert-GLjkDpl9.js";import{C as Z}from"./circle-check-big-BZbHqZN0.js";import{C as Se}from"./calendar-BX_yeC02.js";import{D as he}from"./dollar-sign-PdZDcYZj.js";import{C as Pe}from"./credit-card-3SaMs0It.js";import{B as De}from"./building-2-Cuhjt6gR.js";import{S as _e}from"./smartphone-BcohYOKc.js";/* empty css            */import"./button-Bd86L7oB.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-pgajX6Yu.js";import"./createLucideIcon-W0zMed0x.js";import"./index-epogFq-A.js";import"./index-DhFfkZJo.js";import"./index-Bp39ufWM.js";import"./badge-CuzEfVzO.js";import"./x-BgUjAJLb.js";import"./triangle-alert-3dOUa8Ja.js";Ne.registerModules([ye]);const Fe=({installment:c,student:t,onClose:n,onVerifyVoucher:i})=>{const[p,N]=C.useState(!1),[y,B]=C.useState(null),f=c.vouchers||[],x=f.find(a=>a.status==="pending"),b=c.late_fee||c.lateFee||0,w=c.total_due||c.totalDue||c.amount+b,h=c.paid_amount||c.paidAmount||0,S=async()=>{if(x){N(!0);try{await i(x.id,"approve"),n()}finally{N(!1)}}},M=async()=>{if(!x)return;const a=await K.fire({title:"Rechazar Voucher",input:"textarea",inputLabel:"Motivo del rechazo",inputPlaceholder:"Explica por qu√© se rechaza este voucher...",inputAttributes:{"aria-label":"Motivo del rechazo"},showCancelButton:!0,confirmButtonText:"Rechazar",cancelButtonText:"Cancelar",confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",inputValidator:m=>{if(!m)return"Debes especificar un motivo"}});if(a.isConfirmed&&a.value){N(!0);try{await i(x.id,"reject",a.value),n()}finally{N(!1)}}},P=a=>{switch(a?.toLowerCase()){case"yape":return e.jsx(_e,{className:"w-5 h-5"});case"transfer":case"transferencia":return e.jsx(De,{className:"w-5 h-5"});case"card":case"tarjeta":return e.jsx(Pe,{className:"w-5 h-5"});default:return e.jsx(he,{className:"w-5 h-5"})}},v=a=>{switch(a?.toLowerCase()){case"yape":return"Yape";case"transfer":case"transferencia":return"Transferencia Bancaria";case"card":case"tarjeta":return"Tarjeta de Cr√©dito/D√©bito";case"cash":case"efectivo":return"Efectivo";default:return a||"No especificado"}},_=c.installment_number||c.installmentNumber||0,j=c.due_date||c.dueDate||"";let u;try{if(typeof j=="string"&&j.includes("-")){const[a,m,s]=j.split("-").map(Number);u=new Date(a,(m||1)-1,s||1)}else u=new Date(j);isNaN(u.getTime())&&(u=new Date)}catch{u=new Date}return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-5 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:["Detalle de Pago - Cuota ",_]}),e.jsxs("p",{className:"text-white/90 text-sm mt-1",children:[t.name," ‚Ä¢ ",t.enrollmentCode]})]}),e.jsx("button",{onClick:n,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",children:e.jsx(z,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-slate-50 to-slate-100 rounded-xl p-6 border border-slate-200",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 mb-4 flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 mr-2 text-[#073372]"}),"Informaci√≥n de la Cuota"]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"N√∫mero de Cuota"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900",children:["Cuota ",_]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"Fecha de Vencimiento"}),e.jsx("p",{className:"text-lg font-bold text-slate-900",children:u.toLocaleDateString("es-PE",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"Monto Base"}),e.jsxs("p",{className:"text-lg font-bold text-slate-900",children:["S/ ",c.amount.toFixed(2)]})]}),b>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-red-600 font-medium mb-1",children:"Mora"}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:["+ S/ ",b.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium mb-1",children:"Total a Pagar"}),e.jsxs("p",{className:`text-lg font-bold ${b>0?"text-red-600":"text-slate-900"}`,children:["S/ ",w.toFixed(2)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-medium mb-1",children:"Pagado"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["S/ ",h.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-6 border-2 border-[#073372]/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-slate-900 flex items-center",children:[e.jsx(me,{className:"w-5 h-5 mr-2 text-[#073372]"}),"Vouchers de Pago (",f.length,")"]}),x&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-[#073372]/10 text-[#073372] border-2 border-[#073372]/30 animate-pulse",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Pendiente de Verificaci√≥n"]})]}),f.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(X,{className:"w-12 h-12 text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-600",children:"No hay vouchers subidos para esta cuota"})]}):e.jsx("div",{className:"space-y-4",children:f.sort((a,m)=>a.status==="pending"&&m.status!=="pending"?-1:a.status!=="pending"&&m.status==="pending"?1:new Date(m.created_at).getTime()-new Date(a.created_at).getTime()).map((a,m)=>{const s=a.status==="pending",r=a.status==="approved",l=a.status==="rejected";return e.jsxs("div",{className:`rounded-xl border-2 p-5 transition-all ${s?"bg-gradient-to-br from-blue-50 to-blue-100 border-[#073372] shadow-lg":r?"bg-green-50 border-green-300":"bg-red-50 border-red-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2.5 rounded-lg ${s?"bg-[#073372] animate-pulse":r?"bg-green-500":"bg-red-500"}`,children:s?e.jsx(de,{className:"w-5 h-5 text-white"}):r?e.jsx(Z,{className:"w-5 h-5 text-white"}):e.jsx(z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-bold ${s?"text-[#073372]":r?"text-green-700":"text-red-700"}`,children:s?"üîç Pendiente de Verificaci√≥n":r?"‚úÖ Aprobado":"‚ùå Rechazado"}),e.jsxs("p",{className:"text-xs text-slate-600 mt-0.5",children:["Fecha de pago: ",(()=>{try{const d=new Date(a.payment_date);return isNaN(d.getTime())?"Fecha no especificada":d.toLocaleDateString("es-PE",{day:"2-digit",month:"long",year:"numeric"})}catch{return"Fecha no especificada"}})()]})]})]}),e.jsxs("span",{className:`inline-flex items-center justify-center w-8 h-8 rounded-full text-xs font-bold ${s?"bg-[#073372] text-white":r?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:["#",f.length-m]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"M√©todo de Pago"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${s?"bg-[#073372]/20 text-[#073372]":"bg-white/50"}`,children:P(a.payment_method)}),e.jsx("span",{className:"text-sm font-semibold text-slate-900",children:v(a.payment_method)})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Monto Declarado"}),e.jsxs("p",{className:`text-lg font-bold ${s?"text-[#073372]":"text-slate-900"}`,children:["S/ ",parseFloat(String(a.declared_amount||"0")).toFixed(2)]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Fecha de Pago"}),e.jsx("p",{className:"text-sm font-semibold text-slate-900",children:(()=>{try{const d=new Date(a.payment_date);return isNaN(d.getTime())?"Fecha no disponible":d.toLocaleDateString("es-PE",{day:"2-digit",month:"long",year:"numeric"})}catch{return"Fecha no disponible"}})()})]})]}),e.jsxs("div",{className:"bg-white/60 rounded-lg border border-slate-200 overflow-hidden",children:[e.jsxs("button",{onClick:()=>B(y===a.id?null:a.id),className:"w-full p-4 flex items-center justify-between hover:bg-slate-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Y,{className:`w-5 h-5 ${s?"text-[#073372]":"text-slate-600"}`}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"text-xs text-slate-600 font-medium",children:"Comprobante"}),e.jsx("p",{className:"text-sm text-slate-900 font-semibold",children:a.voucher_url?"Archivo disponible":"Sin archivo"})]})]}),a.voucher_url&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`text-xs font-medium ${s?"text-[#073372]":"text-slate-600"}`,children:y===a.id?"Ocultar":"Ver"}),e.jsx(xe,{className:`w-4 h-4 transition-transform ${y===a.id?"rotate-180":""} ${s?"text-[#073372]":"text-slate-600"}`})]})]}),y===a.id&&a.voucher_url&&e.jsx("div",{className:"border-t border-slate-200 p-4 bg-slate-50",children:e.jsx("div",{className:"bg-white rounded-lg p-3 border border-slate-200",children:a.voucher_url.match(/\.(jpg|jpeg|png|gif|webp)$/i)?e.jsx("img",{src:a.voucher_url,alt:"Comprobante de pago",className:"w-full h-auto max-h-96 object-contain rounded"}):a.voucher_url.match(/\.pdf$/i)?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Archivo PDF"}),e.jsxs("a",{href:a.voucher_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-[#073372] hover:bg-[#17BC91] text-white font-medium rounded-lg transition-colors",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Abrir PDF"]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-slate-400 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-slate-600 mb-3",children:"Archivo adjunto"}),e.jsxs("a",{href:a.voucher_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-[#073372] hover:bg-[#17BC91] text-white font-medium rounded-lg transition-colors",children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"Descargar Archivo"]})]})})})]}),l&&a.rejection_reason&&e.jsxs("div",{className:"mt-4 p-4 bg-red-100 rounded-lg border-2 border-red-300",children:[e.jsxs("p",{className:"text-xs font-bold text-red-800 mb-2 flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1"}),"Motivo del Rechazo:"]}),e.jsx("p",{className:"text-sm text-red-700 font-medium",children:a.rejection_reason})]}),r&&a.receipt_url&&e.jsx("div",{className:"mt-4",children:e.jsxs("a",{href:a.receipt_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-[#073372] hover:bg-[#073372]/90 text-white text-sm font-semibold rounded-lg transition-colors",children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Ver Boleta de Pago"]})}),(r||l)&&a.verified_by&&e.jsx("div",{className:"mt-3 flex items-center text-xs text-slate-600",children:e.jsxs("span",{className:"font-medium",children:["Verificado por: ",a.verified_by]})})]},a.id)})})]})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 border-t border-slate-200 flex justify-between items-center flex-shrink-0",children:[e.jsx("button",{onClick:n,disabled:p,className:"px-6 py-2.5 border-2 border-slate-300 text-slate-700 font-semibold rounded-lg hover:bg-slate-100 transition-colors disabled:opacity-50",children:"Cerrar"}),x&&e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:M,disabled:p,className:"inline-flex items-center px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"w-5 h-5 mr-2"}),"Rechazar"]})}),e.jsx("button",{onClick:S,disabled:p,className:"inline-flex items-center px-6 py-2.5 bg-gradient-to-r from-[#17BC91] to-emerald-600 hover:shadow-lg text-white font-semibold rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Procesando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-5 h-5 mr-2"}),"Aprobar Pago"]})})]})]})]})})},Be=c=>{const t=fe.c(66),{student:n,enrollment:i,onClose:p,onViewInstallmentDetail:N}=c;let y;t[0]!==i.paymentPlan?(y=o=>{if(o.status==="verified")return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Verificado"]});if(o.status==="paid")return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#073372]/10 text-[#073372] border border-[#073372]/30 animate-pulse",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Pendiente Verificaci√≥n"]});if(o.status==="pending"||o.status==="overdue"){const k=o.due_date||o.dueDate||"";let D;if(typeof k=="string"&&k.includes("-")){const[A,ue,pe]=k.split("-").map(Number);D=new Date(A,(ue||1)-1,pe||1)}else D=new Date(k);const Q=new Date,T=new Date(Q.getFullYear(),Q.getMonth(),Q.getDate()),ne=o.daysUntilDue,ie=o.daysUntilGraceLimit,W=typeof ne=="number"?ne:Math.round((D.getTime()-T.getTime())/864e5),J=i.paymentPlan?.gracePeriodDays||i.paymentPlan?.grace_period_days||0,$=typeof ie=="number"?ie:(function(){const A=new Date(D);return A.setDate(A.getDate()+J),Math.round((A.getTime()-T.getTime())/864e5)})();return console.log("üîç Cashier Debug - Cuota:",{dueDateStr:k,dueDate:D.toISOString().split("T")[0],today:T.toISOString().split("T")[0],gracePeriodDays:J,daysUntilDue:W,daysUntilGraceLimit:$,moraEnDias:Math.abs($),usingServer:typeof ie=="number"}),W<0&&$>=0&&J>0?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 border border-orange-300",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Per√≠odo de Gracia (",$,"d)"]}):$<0?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-300",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Vencido con Mora (",Math.abs($),"d)"]}):e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Pendiente (",W>0?`${W}d`:"Vence hoy",")"]})}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(X,{className:"w-3 h-3 mr-1"}),"Desconocido"]})},t[0]=i.paymentPlan,t[1]=y):y=t[1];const B=y;let f;t[2]===Symbol.for("react.memo_cache_sentinel")?(f=e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Cronograma de Pagos"}),t[2]=f):f=t[2];let x;t[3]!==n.enrollmentCode||t[4]!==n.name?(x=e.jsxs("div",{children:[f,e.jsxs("p",{className:"text-white/90 text-sm",children:[n.name," - ",n.enrollmentCode]})]}),t[3]=n.enrollmentCode,t[4]=n.name,t[5]=x):x=t[5];let b;t[6]===Symbol.for("react.memo_cache_sentinel")?(b=e.jsx(z,{className:"h-6 w-6"}),t[6]=b):b=t[6];let w;t[7]!==p?(w=e.jsx("button",{onClick:p,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:b}),t[7]=p,t[8]=w):w=t[8];let h;t[9]!==x||t[10]!==w?(h=e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] px-8 py-6 flex items-center justify-between",children:[x,w]}),t[9]=x,t[10]=w,t[11]=h):h=t[11];let S;t[12]===Symbol.for("react.memo_cache_sentinel")?(S=e.jsx("p",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Total Plan"}),t[12]=S):S=t[12];const M=(i.enrollment_fee||0)+(i.totalPending||0)+(i.totalPaid||0);let P;t[13]!==M?(P=M.toFixed(2),t[13]=M,t[14]=P):P=t[14];let v;t[15]!==P?(v=e.jsxs("div",{children:[S,e.jsxs("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:["S/ ",P]})]}),t[15]=P,t[16]=v):v=t[16];let _;t[17]===Symbol.for("react.memo_cache_sentinel")?(_=e.jsx(Y,{className:"h-8 w-8 text-blue-600 opacity-50"}),t[17]=_):_=t[17];let j;t[18]!==v?(j=e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[v,_]})}),t[18]=v,t[19]=j):j=t[19];let u;t[20]===Symbol.for("react.memo_cache_sentinel")?(u=e.jsx("p",{className:"text-xs text-green-600 font-semibold uppercase",children:"Pagado"}),t[20]=u):u=t[20];const a=(i.enrollment_fee||0)+(i.totalPaid||0);let m;t[21]!==a?(m=a.toFixed(2),t[21]=a,t[22]=m):m=t[22];let s;t[23]!==m?(s=e.jsxs("div",{children:[u,e.jsxs("p",{className:"text-2xl font-bold text-green-900 mt-1",children:["S/ ",m]})]}),t[23]=m,t[24]=s):s=t[24];let r;t[25]===Symbol.for("react.memo_cache_sentinel")?(r=e.jsx(Z,{className:"h-8 w-8 text-green-600 opacity-50"}),t[25]=r):r=t[25];let l;t[26]!==s?(l=e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[s,r]})}),t[26]=s,t[27]=l):l=t[27];let d;t[28]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx("p",{className:"text-xs text-yellow-600 font-semibold uppercase",children:"Pendiente"}),t[28]=d):d=t[28];const V=i.totalPending||0;let g;t[29]!==V?(g=V.toFixed(2),t[29]=V,t[30]=g):g=t[30];let F;t[31]!==g?(F=e.jsxs("div",{children:[d,e.jsxs("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:["S/ ",g]})]}),t[31]=g,t[32]=F):F=t[32];let ee;t[33]===Symbol.for("react.memo_cache_sentinel")?(ee=e.jsx(X,{className:"h-8 w-8 text-yellow-600 opacity-50"}),t[33]=ee):ee=t[33];let R;t[34]!==F?(R=e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-4 border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[F,ee]})}),t[34]=F,t[35]=R):R=t[35];let te;t[36]===Symbol.for("react.memo_cache_sentinel")?(te=e.jsx("p",{className:"text-xs text-purple-600 font-semibold uppercase",children:"Progreso"}),t[36]=te):te=t[36];const ce=i.paymentProgress||0;let E;t[37]!==ce?(E=ce.toFixed(2),t[37]=ce,t[38]=E):E=t[38];let I;t[39]!==E?(I=e.jsxs("div",{children:[te,e.jsxs("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[E,"%"]})]}),t[39]=E,t[40]=I):I=t[40];let se;t[41]===Symbol.for("react.memo_cache_sentinel")?(se=e.jsx(he,{className:"h-8 w-8 text-purple-600 opacity-50"}),t[41]=se):se=t[41];let L;t[42]!==I?(L=e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[I,se]})}),t[42]=I,t[43]=L):L=t[43];let U;t[44]!==j||t[45]!==l||t[46]!==R||t[47]!==L?(U=e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[j,l,R,L]}),t[44]=j,t[45]=l,t[46]=R,t[47]=L,t[48]=U):U=t[48];let re;t[49]===Symbol.for("react.memo_cache_sentinel")?(re=e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cuotas del Plan"})}),t[49]=re):re=t[49];let ae;t[50]===Symbol.for("react.memo_cache_sentinel")?(ae=e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Cuota"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha Vencimiento"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),t[50]=ae):ae=t[50];let G;t[51]!==i.installments||t[52]!==B||t[53]!==N?(G=i.installments&&i.installments.length>0?i.installments.map(o=>{const k=o.installment_number||o.installmentNumber||0,D=o.due_date||o.dueDate||"";let Q=new Date(D);if(typeof D=="string"&&D.includes("-")){const[J,$,A]=D.split("-").map(Number);Q=new Date(J,($||1)-1,A||1)}const T=o.late_fee||o.lateFee||0,ne=o.total_due||o.totalDue||o.amount+T,W=(o.vouchers||[]).some(Ve);return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:k})}),e.jsxs("span",{className:"ml-3 text-sm font-medium text-gray-900",children:["Cuota ",k]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[e.jsx(Se,{className:"w-4 h-4 mr-2 text-gray-400"}),Q.toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:`text-sm font-bold ${T>0?"text-red-600":"text-gray-900"}`,children:["S/ ",ne.toFixed(2)]}),T>0&&e.jsxs("span",{className:"text-xs text-red-500 italic",children:["(incluye mora S/ ",T.toFixed(2),")"]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:B(o)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:e.jsxs("button",{onClick:()=>N(o),className:`inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium transition-all ${W?"bg-[#073372] hover:bg-[#17BC91] text-white shadow-md animate-pulse":"bg-slate-100 hover:bg-slate-200 text-slate-700"}`,children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Ver Detalle"]})})]},o.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"No hay cuotas registradas"})}),t[51]=i.installments,t[52]=B,t[53]=N,t[54]=G):G=t[54];let q;t[55]!==G?(q=e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[re,e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[ae,e.jsx("tbody",{className:"divide-y divide-gray-200",children:G})]})})]}),t[55]=G,t[56]=q):q=t[56];let O;t[57]!==U||t[58]!==q?(O=e.jsxs("div",{className:"p-8 overflow-y-auto max-h-[calc(90vh-200px)]",children:[U,q]}),t[57]=U,t[58]=q,t[59]=O):O=t[59];let H;t[60]!==p?(H=e.jsx("div",{className:"bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:p,className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2.5 rounded-xl font-medium transition-colors",children:"Cerrar"})}),t[60]=p,t[61]=H):H=t[61];let le;return t[62]!==O||t[63]!==H||t[64]!==h?(le=e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[h,O,H]})}),t[62]=O,t[63]=H,t[64]=h,t[65]=le):le=t[65],le},lt=({students:c=[]})=>{const[t]=C.useState(c??[]),[n,i]=C.useState(null),[p,N]=C.useState(!1),[y,B]=C.useState(!1),[f,x]=C.useState(null),[b,w]=C.useState(""),[h,S]=C.useState("all"),M=s=>{x(s),B(!0)},P=async s=>{try{console.log("üìã Abriendo cronograma para aprendiz:",s.id,s.name);const r=await oe.get(`/cashier/students/${s.id}/enrollment`);if(console.log("‚úÖ Respuesta del servidor:",r.data),r.data.success)i({...s,enrollment:r.data.enrollment}),N(!0);else throw new Error(r.data.message||"No se pudo cargar el cronograma")}catch(r){console.error("‚ùå Error al cargar cronograma:",r),console.error("Error response:",r.response?.data),await K.fire({title:"Error",text:r.response?.data?.message||"No se pudo cargar el cronograma de pagos",icon:"error",confirmButtonColor:"#ef4444"})}},v=async(s,r,l)=>{const d=r==="approve"?"¬øAprobar Voucher?":"¬øRechazar Voucher?",V=r==="approve"?"¬øConfirmas que el voucher de pago es v√°lido?":"El voucher ser√° rechazado y el aprendiz deber√° subir uno nuevo.";if(!(r==="reject"&&l)){if(r==="approve"&&!(await K.fire({title:d,html:`
          <div class="text-left">
            <p class="text-gray-700 mb-3">${V}</p>
            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
              <p class="text-sm text-blue-800">
                <strong>Importante:</strong> Al aprobar este voucher:
              </p>
              <ul class="text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside">
                <li>Se marcar√° el voucher como aprobado</li>
                <li>Se actualizar√° la cuota correspondiente</li>
                <li>Se registrar√° tu nombre como revisor</li>
              </ul>
            </div>
          </div>
        `,icon:"question",showCancelButton:!0,confirmButtonColor:"#10b981",cancelButtonColor:"#6b7280",confirmButtonText:"S√≠, Aprobar",cancelButtonText:"Cancelar",reverseButtons:!0})).isConfirmed)return}try{const g=await oe.post(`/cashier/vouchers/${s}/verify`,{action:r,rejection_reason:l});if(g.data.success){if(n?.enrollment){const F=await oe.get(`/cashier/students/${n.id}/enrollment`);F.data.success&&i({...n,enrollment:F.data.enrollment})}await K.fire({title:r==="approve"?"¬°Aprobado!":"Rechazado",text:g.data.message,icon:"success",confirmButtonColor:"#10b981",timer:2e3,timerProgressBar:!0})}}catch(g){console.error("Error al verificar voucher:",g),await K.fire({title:"Error",text:"No se pudo procesar la verificaci√≥n del voucher",icon:"error",confirmButtonColor:"#ef4444"})}},_=C.useMemo(()=>{let s=t.filter(r=>r.enrollmentVerified);return h==="pending"?s=s.filter(r=>r.enrollment&&(r.enrollment.paymentProgress||0)<100):h==="completed"&&(s=s.filter(r=>r.enrollment&&r.enrollment.paymentProgress===100)),s},[t,h]),j=C.useMemo(()=>[{headerName:"Aprendiz",field:"name",minWidth:300,filter:"agTextColumnFilter",cellRenderer:s=>{const r=s.data;return e.jsxs("div",{className:"flex items-center py-2 w-full h-full",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-[#073372] to-[#17BC91] rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-sm font-semibold",children:r.name.split(" ").map(l=>l[0]).join("")})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:r.name}),e.jsx("div",{className:"text-xs text-gray-500",children:r.email})]})]})}},{headerName:"C√≥digo",field:"enrollmentCode",width:150,filter:"agTextColumnFilter",cellRenderer:s=>e.jsx("div",{className:"flex items-center h-full",children:e.jsx("span",{className:"text-sm font-mono text-gray-900",children:s.value})})},{headerName:"Plan",width:200,filter:"agTextColumnFilter",cellRenderer:s=>{const r=s.data;return e.jsx("div",{className:"flex items-center h-full",children:e.jsx("span",{className:"text-sm text-gray-900",children:r.paymentPlan?.name||r.enrollment?.paymentPlan?.name||"Sin plan"})})}},{headerName:"Progreso de Pagos",width:250,cellRenderer:s=>{const r=s.data,l=r.enrollment?.paymentProgress||0;return e.jsxs("div",{className:"flex flex-col justify-center h-full space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:[l.toFixed(0),"% completado"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["S/ ",((r.enrollment?.totalPaid||0)+(r.enrollment?.enrollment_fee||0)).toFixed(2)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${l===100?"bg-[#17BC91]":l>=50?"bg-[#073372]":"bg-[#F98613]"}`,style:{width:`${l}%`}})})]})}},{headerName:"Pendientes Pago",width:140,cellRenderer:s=>{const l=s.data.enrollment?.installments?.filter(d=>d.status==="pending"||d.status==="overdue").length||0;return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${l===0?"bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30":"bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30"}`,children:[l," ",l===1?"cuota":"cuotas"]})})}},{headerName:"Por Verificar",width:140,cellRenderer:s=>{const l=s.data.enrollment?.installments?.filter(d=>d.status==="paid").length||0;return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${l===0?"bg-gray-100 text-gray-600":"bg-[#073372]/10 text-[#073372] border border-[#073372]/30 animate-pulse"}`,children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),l," ",l===1?"voucher":"vouchers"]})})}},{headerName:"Acciones",width:120,sortable:!1,filter:!1,cellRenderer:s=>{const r=s.data;return e.jsx("div",{className:"flex items-center justify-center space-x-2 h-full",children:e.jsxs("button",{onClick:()=>P(r),className:"inline-flex items-center px-3 py-1.5 bg-[#073372] hover:bg-[#17BC91] text-white text-sm font-medium rounded-lg transition-colors",title:"Ver y verificar cronograma",children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Ver"]})})}}],[]),u=t.filter(s=>s.enrollmentVerified),a=u.filter(s=>s.enrollment&&(s.enrollment.paymentProgress||0)<100),m=u.filter(s=>s.enrollment&&s.enrollment.paymentProgress===100);return e.jsxs(ge,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Control de Pagos"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona y verifica los pagos de aprendices matriculados"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{type:"text",label:"Buscar por nombre, email, c√≥digo, plan...",value:b,onChange:s=>w(s.target.value),icon:e.jsx(ve,{className:"w-4 h-4"}),className:"pr-10"}),b&&e.jsx("button",{onClick:()=>w(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:e.jsx(z,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-1 inline-flex",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>S("all"),className:`px-6 py-3 rounded-lg font-medium transition-all ${h==="all"?"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{children:"Todos"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:u.length})]})}),e.jsx("button",{onClick:()=>S("pending"),className:`px-6 py-3 rounded-lg font-medium transition-all ${h==="pending"?"bg-gradient-to-r from-[#F98613] to-orange-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Con Pagos Pendientes"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:a.length})]})}),e.jsx("button",{onClick:()=>S("completed"),className:`px-6 py-3 rounded-lg font-medium transition-all ${h==="completed"?"bg-gradient-to-r from-[#17BC91] to-teal-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Pagos Completos"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:m.length})]})})]})}),e.jsx("div",{className:"ag-theme-quartz",style:{height:"600px",width:"100%"},children:e.jsx(be,{theme:je,rowData:_,columnDefs:j,quickFilterText:b,defaultColDef:{sortable:!0,filter:!0,resizable:!0,flex:1,minWidth:100},pagination:!0,paginationPageSize:10,paginationPageSizeSelector:[10,20,50,100],rowSelection:{mode:"singleRow"},animateRows:!0,domLayout:"normal",rowHeight:70,headerHeight:48,suppressCellFocus:!0,rowClass:"hover:bg-gray-50"})})]}),p&&n&&n.enrollment&&e.jsx(Be,{student:n,enrollment:n.enrollment,onClose:()=>N(!1),onVerifyVoucher:v,onViewInstallmentDetail:M}),y&&f&&n&&e.jsx(Fe,{installment:f,student:n,onClose:()=>{B(!1),x(null)},onVerifyVoucher:async(s,r,l)=>{await v(s,r,l);const d=await oe.get(`/cashier/students/${n.id}/enrollment`);if(d.data.success){i({...n,enrollment:d.data.enrollment});const V=d.data.enrollment.installments?.find(g=>g.id===f.id);V&&x(V)}}})]})};function Ve(c){return c.status==="pending"}export{lt as default};
