import{c as _e,r as l,j as e,a as Y,U as Fe}from"./app-BujC6CEz.js";import{t as u,U as se,A as he,F as pe,D as Le}from"./AuthenticatedLayout-BAEnKWwr.js";import{I as $e}from"./input-tIClW3GA.js";import{S as ne}from"./smartphone-BUPvTUS7.js";import{B as oe}from"./building-2-Gr2bjTzy.js";import{C as ie}from"./credit-card-DQ_pPCZq.js";import{X as re}from"./x-CjDij46P.js";import{c as xe}from"./createLucideIcon-VpHfxzLx.js";import{C as be}from"./circle-check-big-CDitYXKM.js";import{L as fe}from"./loader-circle-ogxkycS7.js";import{C as z}from"./circle-alert-DKUR2_I0.js";import{L as Ue}from"./lock-BN2vi1Of.js";import{C as ye}from"./chevron-right-BVawtyc9.js";import{P as Re}from"./plus-DRPlt6Mc.js";import{C as ce}from"./circle-check-DNw6ODOo.js";import{C as Me}from"./chevron-up-AbEmc9Kn.js";import{C as Ee}from"./chevron-down-COAeMWjZ.js";import{C as ge}from"./copy-DK-u7Xhd.js";import{C as ve}from"./check-CExyUcE1.js";import{D as Ce}from"./dollar-sign-B0VyIjGJ.js";import{T as ze}from"./trending-up-y62PhGNl.js";import{C as de}from"./clock-qmXHJHpx.js";import{C as Ye}from"./calendar-CYPzYWd1.js";/* empty css            */import"./button-dk7vWce7.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-JC055QFo.js";import"./index-B6GnYBrs.js";import"./index-f_69-RVw.js";import"./index-CbPsU9Z9.js";import"./badge-CWOCogCK.js";import"./triangle-alert-Dt0A5Rna.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],qe=xe("ArrowRight",Ve);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],Oe=xe("QrCode",Ge);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],Qe=xe("RefreshCcw",We);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Se=xe("Shield",Ke),Pe=i=>{const a=_e.c(41),{isOpen:g,onClose:A,onSelectMethod:f,installmentAmount:I}=i,[b,S]=l.useState(null);if(!g)return null;const N=He;let D;a[0]===Symbol.for("react.memo_cache_sentinel")?(D={id:"yape",name:"Yape",description:"Pago rÃ¡pido mediante aplicaciÃ³n Yape",icon:ne,color:"from-[#073372] to-[#17BC91]",bgColor:"bg-gradient-to-br from-[#073372]/5 to-[#17BC91]/5",borderColor:"border-[#17BC91]",hoverColor:"hover:border-[#073372]",enabled:!0},a[0]=D):D=a[0];let y;a[1]===Symbol.for("react.memo_cache_sentinel")?(y={id:"transfer",name:"Transferencia Bancaria",description:"Transferencia o depÃ³sito bancario interbancario",icon:oe,color:"from-[#073372] to-[#17BC91]",bgColor:"bg-gradient-to-br from-[#073372]/5 to-[#17BC91]/5",borderColor:"border-[#17BC91]",hoverColor:"hover:border-[#073372]",enabled:!0},a[1]=y):y=a[1];let F;a[2]===Symbol.for("react.memo_cache_sentinel")?(F=[D,y,{id:"card",name:"Tarjeta de CrÃ©dito/DÃ©bito",description:"Pago con tarjeta Visa, Mastercard, American Express",icon:ie,color:"from-[#073372] to-[#17BC91]",bgColor:"bg-gradient-to-br from-[#073372]/5 to-[#17BC91]/5",borderColor:"border-[#17BC91]",hoverColor:"hover:border-[#073372]",enabled:!0}],a[2]=F):F=a[2];const V=F;let L;a[3]!==f||a[4]!==b?(L=()=>{b&&f(b)},a[3]=f,a[4]=b,a[5]=L):L=a[5];const M=L;let G;a[6]===Symbol.for("react.memo_cache_sentinel")?(G=e.jsx("h2",{className:"text-2xl font-bold",children:"Selecciona tu mÃ©todo de pago"}),a[6]=G):G=a[6];let _;a[7]!==I?(_=N(I),a[7]=I,a[8]=_):_=a[8];let q;a[9]!==_?(q=e.jsxs("div",{children:[G,e.jsxs("p",{className:"text-white/90 text-sm mt-1",children:["Monto a pagar: ",e.jsx("span",{className:"font-bold text-lg",children:_})]})]}),a[9]=_,a[10]=q):q=a[10];let C;a[11]===Symbol.for("react.memo_cache_sentinel")?(C=e.jsx(re,{className:"w-6 h-6"}),a[11]=C):C=a[11];let w;a[12]!==A?(w=e.jsx("button",{onClick:A,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",children:C}),a[12]=A,a[13]=w):w=a[13];let d;a[14]!==q||a[15]!==w?(d=e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-8 py-6 rounded-t-2xl flex items-center justify-between flex-shrink-0",children:[q,w]}),a[14]=q,a[15]=w,a[16]=d):d=a[16];let v;a[17]!==b?(v=V.map(k=>{const te=k.icon,c=b===k.id,W=!k.enabled;return e.jsx("button",{onClick:()=>k.enabled&&S(k.id),disabled:W,className:`w-full text-left p-6 rounded-2xl border-2 transition-all ${W?"border-slate-200 hover:border-slate-300 ":c?`${k.borderColor} ${k.bgColor} shadow-lg scale-[1.02]`:`border-slate-200 ${k.hoverColor} hover:shadow-md`}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`p-4 rounded-xl bg-gradient-to-br ${k.color} flex-shrink-0`,children:e.jsx(te,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:k.name}),c&&!W&&e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-gradient-to-br from-[#17BC91] to-[#073372] flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),e.jsx("p",{className:"text-sm text-slate-600",children:k.description}),k.enabled&&e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-xs",children:[k.id==="card"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:"âœ“ AprobaciÃ³n InstantÃ¡nea"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-700 font-medium",children:"ðŸ’³ Guardar Tarjeta"})]}),(k.id==="yape"||k.id==="transfer")&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-[#F98613]/20 text-[#F98613] font-medium",children:"â³ Requiere VerificaciÃ³n"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-[#17BC91]/20 text-[#17BC91] font-medium",children:"ðŸ“± Subir Comprobante"})]})]})]})]})},k.id)}),a[17]=b,a[18]=v):v=a[18];let h;a[19]===Symbol.for("react.memo_cache_sentinel")?(h=e.jsx("div",{className:"flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-[#073372] to-[#17BC91] flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),a[19]=h):h=a[19];let E;a[20]===Symbol.for("react.memo_cache_sentinel")?(E=e.jsx("p",{className:"text-sm font-semibold text-[#073372] mb-1",children:"ðŸ“Œ InformaciÃ³n Importante"}),a[20]=E):E=a[20];let P;a[21]===Symbol.for("react.memo_cache_sentinel")?(P=e.jsx("strong",{className:"text-[#073372]",children:"Yape"}),a[21]=P):P=a[21];let r;a[22]===Symbol.for("react.memo_cache_sentinel")?(r=e.jsx("strong",{className:"text-[#073372]",children:"Transferencia Bancaria"}),a[22]=r):r=a[22];let t;a[23]===Symbol.for("react.memo_cache_sentinel")?(t=e.jsx("div",{className:"mt-6 p-5 bg-gradient-to-br from-[#073372]/10 to-[#17BC91]/10 border-2 border-[#17BC91]/30 rounded-xl",children:e.jsxs("div",{className:"flex items-start gap-3",children:[h,e.jsxs("div",{className:"flex-1",children:[E,e.jsxs("p",{className:"text-sm text-slate-700 leading-relaxed",children:["Para pagos con ",P," o ",r,", deberÃ¡s subir el comprobante despuÃ©s de realizar la operaciÃ³n. Nuestro equipo verificarÃ¡ tu pago en un plazo de ",e.jsx("strong",{className:"text-[#17BC91]",children:"24-48 horas"}),"."]})]})]})}),a[23]=t):t=a[23];let x;a[24]!==v?(x=e.jsxs("div",{className:"flex-1 overflow-y-auto p-8 space-y-4",children:[v,t]}),a[24]=v,a[25]=x):x=a[25];let T;a[26]!==A?(T=e.jsx("button",{onClick:A,className:"px-6 py-3 border-2 border-slate-300 text-slate-700 font-semibold rounded-xl hover:bg-slate-100 transition-colors",children:"Cancelar"}),a[26]=A,a[27]=T):T=a[27];const ae=!b,K=`px-8 py-3 rounded-xl font-semibold transition-all flex items-center space-x-2 ${b?"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white hover:shadow-lg hover:scale-105":"bg-slate-200 text-slate-400 cursor-not-allowed"}`;let $,J;a[28]===Symbol.for("react.memo_cache_sentinel")?($=e.jsx("span",{children:"Continuar"}),J=e.jsx(qe,{className:"w-5 h-5"}),a[28]=$,a[29]=J):($=a[28],J=a[29]);let O;a[30]!==M||a[31]!==ae||a[32]!==K?(O=e.jsxs("button",{onClick:M,disabled:ae,className:K,children:[$,J]}),a[30]=M,a[31]=ae,a[32]=K,a[33]=O):O=a[33];let H;a[34]!==T||a[35]!==O?(H=e.jsxs("div",{className:"bg-slate-50 px-8 py-6 rounded-b-2xl border-t border-slate-200 flex justify-end space-x-4 flex-shrink-0",children:[T,O]}),a[34]=T,a[35]=O,a[36]=H):H=a[36];let Z;return a[37]!==d||a[38]!==x||a[39]!==H?(Z=e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] flex flex-col",children:[d,x,H]})}),a[37]=d,a[38]=x,a[39]=H,a[40]=Z):Z=a[40],Z};function He(i){return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(i)}const ke=({isOpen:i,onClose:a,installment:g,onSuccess:A,isPartialPayment:f=!1})=>{const[I,b]=l.useState(!1),[S,N]=l.useState(!1),[D,y]=l.useState(!1),[F,V]=l.useState(""),[L,M]=l.useState(!1),[G,_]=l.useState(!1),[q,C]=l.useState(!1),[w,d]=l.useState(!1),[v,h]=l.useState(null),[E,P]=l.useState(null),[r,t]=l.useState([]),[x,T]=l.useState(null),[ae,K]=l.useState("select");l.useRef(null);const $=l.useRef(!1);l.useEffect(()=>{i&&((async()=>{try{b(!0),h(null);const[o,j]=await Promise.all([Y.get("/api/student/culqi/public-key"),Y.get("/api/student/payment-methods")]);o.data.public_key?V(o.data.public_key):h("No se pudo obtener la configuraciÃ³n de Culqi");const ee=j.data.payment_methods||[];t(ee.filter(s=>s.type==="card"));const p=ee.find(s=>s.isDefault&&s.type==="card"&&s.canCharge);p&&T(p);const le=ee.some(s=>s.type==="card"&&s.canCharge);K(le?"select":"new")}catch(o){console.error("Error loading initial data:",o),h("Error al cargar configuraciÃ³n de pagos")}finally{b(!1)}})(),C(!1),d(!1),h(null),P(null),y(!1),$.current=!1)},[i]),l.useEffect(()=>{if(!F||!i)return;const n=document.querySelector('script[src="https://checkout.culqi.com/js/v4"]');if(n&&window.Culqi)M(!0),J();else if(!n){const j=document.createElement("script");j.src="https://checkout.culqi.com/js/v4",j.async=!0,j.onload=()=>{M(!0),J()},j.onerror=()=>{h("Error al cargar el sistema de pagos")},document.head.appendChild(j)}const o=document.querySelector('script[src="https://3ds.culqi.com"]');if(o&&window.Culqi3DS)_(!0);else if(!o){const j=document.createElement("script");j.src="https://3ds.culqi.com",j.async=!0,j.onload=()=>{console.log("Culqi 3DS script loaded"),_(!0)},j.onerror=()=>{console.error("Error loading Culqi 3DS script")},document.head.appendChild(j)}},[F,i]),l.useEffect(()=>{const n=o=>{if(console.log("Message received:",o.data),!D||!E||$.current)return;let j=null;o.data&&o.data.parameters3DS?j=o.data.parameters3DS:o.data&&(o.data.eci||o.data.xid||o.data.cavv)&&(j=o.data),j&&(console.log("3DS parameters received:",j),$.current=!0,te(j))};return window.addEventListener("message",n),()=>window.removeEventListener("message",n)},[D,E]);const J=()=>{!window.Culqi||!F||(window.Culqi.publicKey=F,window.Culqi.settings({title:"UNCED - Pago de Cuota",currency:"PEN",amount:Math.round(g.amount*100)}),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!1,billetera:!1,bancaMovil:!1,agente:!1,cuotealo:!1},style:{bannerColor:"#073372",buttonBackground:"#17BC91",menuColor:"#073372",linksColor:"#17BC91",buttonText:"Pagar",buttonTextColor:"#ffffff",priceColor:"#073372"}}),window.culqi=()=>{try{window.Culqi.close()}catch(n){console.log("Error cerrando Culqi:",n)}window.Culqi.token?(console.log("Token recibido:",window.Culqi.token.id),C(!1),Z(window.Culqi.token.id)):window.Culqi.error&&(console.error("Culqi error:",window.Culqi.error),C(!1),h(window.Culqi.error.user_message||"Error al procesar la tarjeta"))})},O=()=>{if(!window.Culqi){u.error("Culqi no estÃ¡ listo. Por favor intenta de nuevo.");return}h(null),K("new"),window.Culqi.settings({title:"UNCED - Pago de Cuota",currency:"PEN",amount:Math.round(g.amount*100)}),C(!0),window.Culqi.open()},H=async()=>{if(!x){u.error("Selecciona una tarjeta vÃ¡lida");return}try{N(!0),h(null);const n=await Y.post("/api/student/culqi/process-payment-saved-card",{payment_method_id:x.id,installment_id:f?null:g.id,amount:g.amount,is_partial_payment:f});if(n.data.requires_3ds){N(!1),h(null),u.info("Tu banco requiere verificaciÃ³n adicional",{description:"Por seguridad, ingresa nuevamente los datos de tu tarjeta para completar el pago.",duration:6e3}),setTimeout(()=>{O()},1e3);return}n.data.success?(d(!0),u.success("Â¡Pago procesado exitosamente!",{description:f?`Pago parcial de S/ ${g.amount.toFixed(2)} procesado. Se distribuirÃ¡ a tus cuotas pendientes.`:`La cuota #${g.installment_number} ha sido pagada con tu tarjeta guardada`,duration:5e3}),setTimeout(()=>{A(),a()},2e3)):h(n.data.error||"Error al procesar el pago")}catch(n){if(console.error("Error processing payment with saved card:",n),n.response?.data?.requires_3ds){N(!1),u.info("Tu banco requiere verificaciÃ³n adicional",{description:"Por seguridad, ingresa nuevamente los datos de tu tarjeta.",duration:6e3}),setTimeout(()=>{O()},1e3);return}const o=n.response?.data?.error||"Error al procesar el pago con tarjeta guardada";h(o),u.error(o)}finally{N(!1)}},Z=async n=>{try{N(!0),h(null);const o=await Y.post("/api/student/culqi/process-payment",{token_id:n,installment_id:f?null:g.id,amount:g.amount,save_card:!1,auto_payment:!1,is_partial_payment:f});if(o.data.requires_3ds){console.log("3DS required, initializing 3DS flow"),N(!1),P({tokenId:n,amount:g.amount,email:o.data.email||"",chargeData:o.data.charge_data}),k(n,o.data.email,o.data.charge_data);return}o.data.success?(d(!0),u.success("Â¡Pago procesado exitosamente!",{description:f?`Pago parcial de S/ ${g.amount.toFixed(2)} procesado. Se distribuirÃ¡ a tus cuotas pendientes.`:`La cuota #${g.installment_number} ha sido pagada`,duration:5e3}),setTimeout(()=>{A(),a()},2e3)):h(o.data.error||"Error al procesar el pago")}catch(o){if(console.error("Error processing payment:",o),o.response?.data?.requires_3ds){console.log("3DS required from error response"),N(!1),P({tokenId:o.response.data.token_id,amount:g.amount,email:o.response.data.email||"",chargeData:o.response.data.charge_data}),k(o.response.data.token_id,o.response.data.email,o.response.data.charge_data);return}const j=o.response?.data?.error||"Error al procesar el pago";h(j),u.error(j)}finally{E||N(!1)}},k=(n,o,j)=>{if(!window.Culqi3DS){console.error("Culqi3DS not loaded"),h("Error: El mÃ³dulo de seguridad 3D Secure no estÃ¡ disponible. Por favor recarga la pÃ¡gina e intenta de nuevo.");return}try{y(!0),$.current=!1,console.log("Initializing Culqi3DS..."),window.Culqi3DS.publicKey=F,window.Culqi3DS.settings={charge:{totalAmount:Math.round(g.amount*100),returnUrl:window.location.href,currency:"PEN"},card:{email:o}},window.Culqi3DS.options={showModal:!0,showLoading:!0,showIcon:!0,closeModalAction:()=>{console.log("Modal 3DS cerrado por usuario"),y(!1),h("VerificaciÃ³n 3DS cancelada"),P(null)},style:{btnColor:"#17BC91",btnTextColor:"#FFFFFF"}},console.log("Culqi3DS configured, calling initAuthentication with token:",n),window.Culqi3DS.initAuthentication(n),u.info("Completa la verificaciÃ³n de seguridad",{description:"Se abrirÃ¡ una ventana de tu banco para verificar",duration:1e4}),setTimeout(()=>{D&&!$.current&&(y(!1),h("La verificaciÃ³n 3D Secure expirÃ³. Por favor intenta de nuevo."),P(null))},3e5)}catch(ee){console.error("Error initializing 3DS:",ee),y(!1),h("Error al iniciar la verificaciÃ³n 3D Secure: "+(ee.message||"Error desconocido"))}},te=async n=>{if(!E){h("Error: No hay datos de pago para procesar"),y(!1);return}try{N(!0),y(!1),h(null),console.log("Processing payment with 3DS parameters:",n),console.log("threeDSData:",E);const o=await Y.post("/api/student/culqi/process-payment-3ds",{token_id:E.tokenId,installment_id:f?null:g.id,amount:g.amount,parameters_3ds:n,save_card:!1,auto_payment:!1,is_partial_payment:f});o.data.success?(d(!0),u.success("Â¡Pago procesado exitosamente!",{description:f?`Pago parcial de S/ ${g.amount.toFixed(2)} procesado con verificaciÃ³n 3D Secure.`:`La cuota #${g.installment_number} ha sido pagada con verificaciÃ³n 3D Secure`,duration:5e3}),setTimeout(()=>{A(),a()},2e3)):h(o.data.error||"Error al procesar el pago con 3DS")}catch(o){console.error("Error processing 3DS payment:",o);const j=o.response?.data?.error||"Error al procesar el pago con 3D Secure";h(j),u.error(j)}finally{N(!1),P(null)}},c=n=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(n),W=()=>{if(q&&window.Culqi)try{window.Culqi.close()}catch{}C(!1),y(!1),P(null),K("select"),S||a()};if(!i||q)return null;const Q=r.filter(n=>n.type==="card"&&n.canCharge);return r.filter(n=>n.type==="card"&&!n.canCharge),e.jsxs("div",{className:"fixed inset-0 z-[9998] overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:W}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-lg transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all",children:[e.jsxs("div",{className:"relative bg-gradient-to-r from-[#073372] to-[#17BC91] px-6 py-5",children:[e.jsx("button",{onClick:W,disabled:S||D,className:"absolute right-4 top-4 rounded-full bg-white/20 p-2 text-white hover:bg-white/30 transition-colors disabled:opacity-50",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-full bg-white/20 p-3",children:e.jsx(ie,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Pagar con Tarjeta"}),e.jsx("p",{className:"text-sm text-white/90",children:f?`Pago Parcial - ${c(g.amount)}`:`Cuota #${g.installment_number} - ${c(g.amount)}`})]})]})]}),e.jsxs("div",{className:"px-6 py-5 space-y-5",children:[w&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(be,{className:"h-10 w-10 text-green-600"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Â¡Pago Exitoso!"}),e.jsx("p",{className:"text-gray-600",children:"Tu pago ha sido procesado correctamente."})]}),I&&!w&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"h-10 w-10 text-[#073372] animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando sistema de pagos..."})]}),D&&!w&&e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"relative mx-auto mb-4 w-16 h-16",children:[e.jsx(Se,{className:"h-16 w-16 text-[#073372] absolute"}),e.jsx(fe,{className:"h-8 w-8 text-[#17BC91] animate-spin absolute top-4 left-4"})]}),e.jsx("p",{className:"text-gray-600 font-medium",children:"VerificaciÃ³n 3D Secure en progreso..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Completa la verificaciÃ³n en la ventana de tu banco"}),e.jsx("p",{className:"text-xs text-gray-400 mt-4",children:"No cierres esta ventana"})]}),S&&!w&&!D&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(fe,{className:"h-10 w-10 text-[#17BC91] animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Procesando tu pago..."}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Por favor no cierres esta ventana"})]}),v&&!w&&!S&&!D&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(z,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"Error"}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:v})]})]})}),!I&&!w&&!S&&!D&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Se,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-green-900",children:"Pago 100% Seguro"}),e.jsx("p",{className:"text-xs text-green-700",children:"Tu informaciÃ³n estÃ¡ protegida con encriptaciÃ³n SSL"})]}),e.jsx(Ue,{className:"h-5 w-5 text-green-600"})]}),Q.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Tarjetas guardadas"}),Q.map(n=>e.jsxs("button",{onClick:()=>T(n),className:`w-full p-4 rounded-xl border-2 transition-all text-left flex items-center gap-4 ${x?.id===n.id?"border-[#17BC91] bg-green-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-8 bg-gradient-to-br from-gray-700 to-gray-900 rounded flex items-center justify-center text-white text-xs font-bold",children:n.cardBrand?.slice(0,4).toUpperCase()||"CARD"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ ",n.cardLast4]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[n.cardholderName||"Titular"," â€¢ Vence ",n.cardExpMonth,"/",n.cardExpYear]})]}),n.isDefault&&e.jsx("span",{className:"flex-shrink-0 px-2 py-1 bg-blue-100 text-blue-700 text-xs font-medium rounded",children:"Predeterminada"}),e.jsx(ye,{className:`h-5 w-5 flex-shrink-0 transition-colors ${x?.id===n.id?"text-[#17BC91]":"text-gray-400"}`})]},n.id))]}),e.jsxs("button",{onClick:O,disabled:!L,className:"w-full p-4 rounded-xl border-2 border-dashed border-gray-300 hover:border-[#073372] hover:bg-blue-50 transition-all text-left flex items-center gap-4 group",children:[e.jsx("div",{className:"flex-shrink-0 w-12 h-8 bg-gray-100 group-hover:bg-[#073372] rounded flex items-center justify-center transition-colors",children:e.jsx(Re,{className:"h-5 w-5 text-gray-400 group-hover:text-white transition-colors"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 group-hover:text-[#073372]",children:"Pagar con nueva tarjeta"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Ingresa los datos de otra tarjeta"})]}),e.jsx(ye,{className:"h-5 w-5 text-gray-400 group-hover:text-[#073372] transition-colors"})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:f?"Pago Parcial":`Cuota #${g.installment_number}`}),e.jsx("span",{className:"font-medium text-gray-900",children:c(g.amount)})]}),f&&e.jsx("p",{className:"text-xs text-blue-600 mb-2",children:"Se distribuirÃ¡ automÃ¡ticamente a tus cuotas mÃ¡s antiguas"}),e.jsx("div",{className:"border-t border-gray-300 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Total a Pagar"}),e.jsx("span",{className:"text-2xl font-bold text-[#073372]",children:c(g.amount)})]})})]})]})]}),!w&&!I&&!S&&!D&&e.jsxs("div",{className:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex gap-3",children:[e.jsx("button",{type:"button",onClick:W,className:"flex-1 px-4 py-3 border border-gray-300 rounded-xl text-gray-700 font-medium hover:bg-gray-100 transition-colors",children:"Cancelar"}),x&&e.jsxs("button",{type:"button",onClick:H,disabled:S,className:"flex-1 px-4 py-3 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-bold rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),e.jsxs("span",{children:["Pagar con â€¢â€¢â€¢â€¢ ",x.cardLast4]})]})]}),e.jsx("div",{className:"px-6 py-3 bg-gray-100 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-center text-gray-500",children:["Procesado de forma segura por ",e.jsx("span",{className:"font-semibold",children:"Culqi"})]})})]})})]})},De=({isOpen:i,onClose:a,onSuccess:g,installmentId:A,amount:f,isPartialPayment:I=!1})=>{const[b,S]=l.useState([]),[N,D]=l.useState(null),[y,F]=l.useState(null),[V,L]=l.useState(!1),[M,G]=l.useState(!0),[_,q]=l.useState(!1),[C,w]=l.useState(1),[d,v]=l.useState(null);l.useEffect(()=>{i&&(h(),w(1),D(null),F(null))},[i]);const h=async()=>{try{G(!0);const x=(await Y.get("/api/student/active-payment-methods")).data.yapes||[];S(x),x.length===1?v(x[0].id):v(null)}catch(t){console.error("Error fetching yape methods:",t),u.error("Error al cargar mÃ©todos Yape")}finally{G(!1)}},E=t=>{navigator.clipboard.writeText(t),q(!0),u.success("NÃºmero copiado"),setTimeout(()=>q(!1),2e3)},P=t=>{const x=t.target.files?.[0];if(x){if(!x.type.startsWith("image/")&&x.type!=="application/pdf"){u.error("Solo se permiten imÃ¡genes o archivos PDF");return}if(x.size>5*1024*1024){u.error("El archivo no debe superar 5MB");return}if(D(x),x.type.startsWith("image/")){const T=new FileReader;T.onloadend=()=>{F(T.result)},T.readAsDataURL(x)}else F(null)}},r=async()=>{if(b.length===0){u.error("No hay mÃ©todos Yape disponibles");return}if(!N){u.error("Debes subir el comprobante de pago");return}try{L(!0);const t=new FormData;t.append("voucher_file",N),I||t.append("installment_id",A),t.append("declared_amount",f.toString()),t.append("payment_date",new Date().toISOString().split("T")[0]),t.append("payment_method","yape"),I&&t.append("is_partial_payment","1"),await Y.post("/api/student/upload-voucher",t,{headers:{"Content-Type":"multipart/form-data"}}),u.success("Â¡Pago registrado exitosamente!",{description:"Tu comprobante estÃ¡ siendo verificado"}),g(),a()}catch(t){console.error("Error uploading voucher:",t);const T=t.response?.data?.message||"No se pudo procesar el pago";u.error("Error al subir comprobante",{description:T})}finally{L(!1)}};return i?e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-5 rounded-t-2xl flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(ne,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Pagar con Yape"}),e.jsxs("p",{className:"text-sm text-white/90",children:["Monto: ",e.jsx("span",{className:"font-bold",children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(f)})]})]})]}),e.jsx("button",{onClick:a,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",children:e.jsx(re,{className:"w-6 h-6"})})]}),M?e.jsx("div",{className:"flex-1 overflow-y-auto p-12 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#17BC91]"})}):b.length===0?e.jsxs("div",{className:"flex-1 overflow-y-auto p-12 text-center",children:[e.jsx(z,{className:"w-16 h-16 text-[#F98613] mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No hay mÃ©todos Yape disponibles"}),e.jsx("p",{className:"text-slate-600",children:"Por favor, contacta con administraciÃ³n"})]}):e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"mb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl p-4",children:e.jsx("div",{className:"flex items-center justify-between mb-3",children:[1,2,3].map(t=>e.jsxs(Fe.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-full font-bold transition-all ${C===t?"bg-gradient-to-br from-[#073372] to-[#17BC91] text-white shadow-lg ring-4 ring-[#17BC91]/20":C>t?"bg-[#17BC91] text-white":"bg-white border-2 border-slate-300 text-slate-400"}`,children:C>t?e.jsx(ce,{className:"w-6 h-6"}):t}),e.jsx("span",{className:`text-xs font-semibold ${C===t?"text-[#073372]":C>t?"text-[#17BC91]":"text-slate-400"}`,children:t===1?"Instrucciones":t===2?"Pagar":"Comprobante"})]}),t<3&&e.jsx("div",{className:"flex-1 h-1 mx-3 rounded-full transition-all",style:{background:C>t?"#17BC91":"#e2e8f0"}})]},t))})}),b.length>0&&C===1&&e.jsxs("div",{className:"bg-white border-2 border-[#17BC91]/20 rounded-xl p-5 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-200",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-[#073372] to-[#17BC91] rounded-lg",children:e.jsx(ne,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"CÃ³mo pagar con Yape"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Sigue estos pasos desde tu celular"})]})]}),e.jsx("div",{className:"bg-[#F98613]/5 border border-[#F98613]/30 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-[#F98613] flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-[#F98613] mb-1",children:"Â¿QuÃ© es Yape?"}),e.jsx("p",{className:"text-xs text-slate-700 leading-relaxed",children:"Yape es una app del BCP para hacer pagos desde tu celular de forma rÃ¡pida y segura."})]})]})}),e.jsxs("div",{className:"bg-[#17BC91]/5 border border-[#17BC91]/30 rounded-lg p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-[#073372] mb-2",children:"ðŸ“± PreparaciÃ³n:"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"1"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:["AsegÃºrate de tener la ",e.jsx("span",{className:"font-semibold text-[#073372]",children:"app de Yape"})," instalada en tu celular"]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"2"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:["Ten saldo disponible de ",e.jsx("span",{className:"font-bold text-[#F98613]",children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(f)})," en tu cuenta Yape"]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"3"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:"Abre la app de Yape en tu celular"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-slate-700 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Siguiente paso:"})," Te mostraremos el cÃ³digo QR o nÃºmero para realizar el pago."]})}),e.jsxs("button",{onClick:()=>w(2),className:"w-full py-2.5 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2",children:["Ver datos de pago",e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),b.length>0&&C===2&&e.jsxs("div",{className:"bg-white border-2 border-[#17BC91]/20 rounded-xl p-5 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-200",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-[#073372] to-[#17BC91] rounded-lg",children:e.jsx(Oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"Escanea y paga"}),e.jsx("p",{className:"text-xs text-slate-600",children:b.length>1?"Selecciona una cuenta y escanea el cÃ³digo":"Usa tu app de Yape para escanear"})]})]}),e.jsx("div",{className:"space-y-3",children:b.map(t=>{const x=d===t.id;return e.jsxs("div",{className:`bg-white border-2 rounded-xl overflow-hidden transition-all duration-300 ${x?"border-[#17BC91]/30 shadow-md":"border-slate-200 hover:border-slate-300"}`,children:[e.jsxs("button",{onClick:()=>v(x?null:t.id),className:"w-full flex items-center gap-3 p-4 text-left bg-slate-50/50 hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"p-2 bg-slate-200 rounded-lg",children:e.jsx(ne,{className:"w-5 h-5 text-slate-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-slate-900 text-sm",children:t.name}),t.description&&e.jsx("p",{className:"text-xs text-slate-600 line-clamp-1",children:t.description}),e.jsxs("p",{className:"text-xs text-slate-500 flex items-center gap-1 mt-0.5",children:[e.jsx(ne,{className:"w-3 h-3"})," ",t.phone_number]})]}),x?e.jsx(Me,{className:"w-5 h-5 text-slate-400"}):e.jsx(Ee,{className:"w-5 h-5 text-slate-400"})]}),x&&e.jsxs("div",{className:"p-4 border-t border-slate-100 bg-white animate-fadeIn",children:[e.jsx("div",{className:"flex flex-col items-center py-2",children:t.qr_image_url?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white p-3 rounded-lg border-2 border-[#17BC91]/30 shadow-md mb-3",children:e.jsx("img",{src:t.qr_image_url,alt:"QR Yape",className:"w-56 h-56 object-contain"})}),e.jsx("p",{className:"text-xs text-slate-600 text-center mb-2",children:"Escanea este cÃ³digo con tu app de Yape"})]}):e.jsxs("div",{className:"w-full bg-[#17BC91]/5 border-2 border-[#17BC91]/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-600 mb-2 text-center",children:"NÃºmero de Yape:"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("p",{className:"text-2xl font-bold text-[#073372]",children:t.phone_number}),e.jsx("button",{onClick:()=>E(t.phone_number),className:"p-1.5 hover:bg-[#073372]/10 rounded-md transition-colors",title:"Copiar nÃºmero",children:e.jsx(ge,{className:`w-4 h-4 ${_?"text-[#17BC91]":"text-[#073372]"}`})})]}),e.jsx("p",{className:"text-xs text-slate-600 text-center mt-2",children:"Ingresa este nÃºmero manualmente en Yape"})]})}),e.jsxs("div",{className:"bg-[#17BC91]/5 border border-[#17BC91]/30 rounded-lg p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-[#073372] mb-2",children:"ðŸ“± Pasos en Yape:"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"1"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:t.qr_image_url?"Escanea el cÃ³digo QR desde la app de Yape":`Ingresa el nÃºmero: ${t.phone_number}`})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"2"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:["Verifica que el monto sea ",e.jsx("span",{className:"font-bold text-[#F98613]",children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(f)})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"3"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:"Confirma y completa el pago"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#17BC91] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"4"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:[e.jsx("span",{className:"font-semibold text-[#17BC91]",children:"Â¡Importante!"})," Toma captura de pantalla del comprobante"]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 mt-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"No cierres Yape"})," hasta tomar la captura de pantalla del comprobante."]})]})})]})]},t.id)})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>w(1),className:"flex-1 py-2.5 border-2 border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",children:"Volver"}),e.jsx("button",{onClick:()=>w(3),className:"flex-1 py-2.5 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all",children:"Ya paguÃ©"})]})]}),b.length>0&&C===3&&e.jsxs("div",{className:"bg-white border-2 border-[#17BC91]/20 rounded-xl p-5 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-200",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-[#073372] to-[#17BC91] rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"Sube tu comprobante"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Carga la captura de pantalla del pago"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-slate-700 leading-relaxed",children:["Sube la captura de pantalla del comprobante de Yape. SerÃ¡ revisado por nuestro equipo en ",e.jsx("span",{className:"font-semibold text-[#073372]",children:"24-48 horas"}),"."]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Comprobante de pago ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:P,className:"hidden",id:"yape-voucher-upload"}),e.jsx("label",{htmlFor:"yape-voucher-upload",className:`block w-full px-4 py-6 border-2 border-dashed rounded-lg text-center cursor-pointer transition-all ${N?"border-[#17BC91] bg-[#17BC91]/5":"border-slate-300 hover:border-[#073372] hover:bg-slate-50"}`,children:y?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:y,alt:"Preview",className:"max-h-40 mx-auto rounded-md shadow-md border-2 border-[#17BC91]"}),e.jsx("div",{className:"absolute -top-1 -right-1 p-0.5 bg-[#17BC91] rounded-full",children:e.jsx(ce,{className:"w-4 h-4 text-white"})})]}),e.jsx("p",{className:"text-xs text-slate-700 font-medium",children:N?.name}),e.jsx("p",{className:"text-xs text-[#073372]",children:"âœ“ Listo | Click para cambiar"})]}):N?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-2 bg-[#17BC91]/10 rounded-full inline-block",children:e.jsx(se,{className:"w-6 h-6 text-[#17BC91]"})}),e.jsx("p",{className:"text-xs text-slate-900 font-medium",children:N.name}),e.jsx("p",{className:"text-xs text-[#073372]",children:"âœ“ Listo | Click para cambiar"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-full inline-block",children:e.jsx(se,{className:"w-6 h-6 text-slate-400"})}),e.jsx("p",{className:"text-sm text-slate-700 font-medium",children:"Click para subir el comprobante"}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG o PDF â€¢ MÃ¡x. 5MB"})]})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>w(2),disabled:V,className:"flex-1 py-2.5 border-2 border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50",children:"Volver"}),e.jsx("button",{onClick:r,disabled:V||!N,className:"flex-1 inline-flex items-center justify-center py-2.5 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:V?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Confirmar Pago"]})})]})]})]})]})}):null},Be=({isOpen:i,onClose:a,onSuccess:g,installmentId:A,amount:f,isPartialPayment:I=!1})=>{const[b,S]=l.useState(1),[N,D]=l.useState([]),[y,F]=l.useState(null),[V,L]=l.useState(null),[M,G]=l.useState(!1),[_,q]=l.useState(!0),[C,w]=l.useState(null);l.useEffect(()=>{i&&(d(),S(1),F(null),L(null))},[i]);const d=async()=>{try{q(!0);const t=(await Y.get("/api/student/active-payment-methods")).data.transfers||[];D(t),t.length===1?w(t[0].id):w(null)}catch(r){console.error("Error fetching transfer methods:",r),u.error("Error al cargar cuentas bancarias")}finally{q(!1)}},v=(r,t)=>{navigator.clipboard.writeText(r),u.success(`${t} copiado al portapapeles`,{duration:2e3})},h=r=>{const t=r.target.files?.[0];if(t){if(!t.type.startsWith("image/")&&t.type!=="application/pdf"){u.error("Solo se permiten imÃ¡genes o archivos PDF");return}if(t.size>5*1024*1024){u.error("El archivo no debe superar 5MB");return}if(F(t),t.type.startsWith("image/")){const x=new FileReader;x.onloadend=()=>{L(x.result)},x.readAsDataURL(t)}else L(null)}},E=async()=>{if(N.length===0){u.error("No hay cuentas bancarias disponibles");return}if(!y){u.error("Debes subir el comprobante de pago");return}try{G(!0);const r=new FormData;r.append("voucher_file",y),I||r.append("installment_id",A),r.append("declared_amount",f.toString()),r.append("payment_date",new Date().toISOString().split("T")[0]),r.append("payment_method","transfer"),I&&r.append("is_partial_payment","1"),await Y.post("/api/student/upload-voucher",r,{headers:{"Content-Type":"multipart/form-data"}}),u.success("Â¡Pago registrado exitosamente!",{description:"Tu comprobante estÃ¡ siendo verificado. RecibirÃ¡s una notificaciÃ³n pronto."}),g(),a()}catch(r){console.error("Error uploading voucher:",r);const t=r;u.error("Error al subir comprobante",{description:t.response?.data?.message||"No se pudo procesar el pago"})}finally{G(!1)}};if(!i)return null;const P=r=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(r);return e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-5 rounded-t-2xl flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(oe,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Transferencia Bancaria"}),e.jsxs("p",{className:"text-sm text-white/90",children:["Monto: ",e.jsx("span",{className:"font-bold",children:P(f)})]})]})]}),e.jsx("button",{onClick:a,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",disabled:M,children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:_?e.jsx("div",{className:"p-12 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#17BC91]"})}):N.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(z,{className:"w-16 h-16 text-[#F98613] mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No hay cuentas bancarias disponibles"}),e.jsx("p",{className:"text-slate-600 text-sm",children:"Por favor, contacta con administraciÃ³n"})]}):e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"mb-6 bg-gradient-to-r from-slate-50 to-slate-100 rounded-xl p-4",children:e.jsx("div",{className:"flex items-center justify-between mb-3",children:[1,2,3].map(r=>e.jsxs(Fe.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`flex items-center justify-center w-12 h-12 rounded-full font-bold transition-all ${b===r?"bg-gradient-to-br from-[#073372] to-[#17BC91] text-white shadow-lg ring-4 ring-[#17BC91]/20":b>r?"bg-[#17BC91] text-white":"bg-white border-2 border-slate-300 text-slate-400"}`,children:b>r?e.jsx(ve,{className:"w-6 h-6"}):r}),e.jsx("span",{className:`text-xs font-semibold ${b===r?"text-[#073372]":b>r?"text-[#17BC91]":"text-slate-400"}`,children:r===1?"Instrucciones":r===2?"Datos Bancarios":"Comprobante"})]}),r<3&&e.jsx("div",{className:"flex-1 h-1 mx-3 rounded-full transition-all",style:{background:b>r?"#17BC91":"#e2e8f0"}})]},r))})}),b===1&&e.jsxs("div",{className:"bg-white border-2 border-[#17BC91]/20 rounded-xl p-5 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-200",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-[#073372] to-[#17BC91] rounded-lg",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"CÃ³mo pagar con Transferencia"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Sigue estos pasos desde tu banco"})]})]}),e.jsx("div",{className:"bg-[#F98613]/5 border border-[#F98613]/30 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-[#F98613] flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-[#F98613] mb-1",children:"Â¿QuÃ© es una transferencia bancaria?"}),e.jsx("p",{className:"text-xs text-slate-700 leading-relaxed",children:"Es el envÃ­o de dinero desde tu cuenta bancaria a nuestra cuenta. Puedes hacerlo desde tu app mÃ³vil o banca por internet de forma segura."})]})]})}),e.jsxs("div",{className:"bg-[#17BC91]/5 border border-[#17BC91]/30 rounded-lg p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-[#073372] mb-2",children:"ðŸ“± PreparaciÃ³n:"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"1"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:["Ten acceso a tu ",e.jsx("span",{className:"font-semibold text-[#073372]",children:"app bancaria o banca por internet"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"2"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:["Verifica tener saldo disponible de ",e.jsx("span",{className:"font-bold text-[#F98613]",children:P(f)})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"3"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:"PrepÃ¡rate para capturar el comprobante de confirmaciÃ³n"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-slate-700 leading-relaxed",children:[e.jsx("span",{className:"font-semibold",children:"Siguiente paso:"})," Te mostraremos los datos de nuestra cuenta bancaria para que puedas realizar la transferencia."]})}),e.jsxs("button",{onClick:()=>S(2),className:"w-full py-2.5 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center justify-center gap-2",children:["Ver Datos Bancarios",e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]}),b===2&&N.length>0&&e.jsxs("div",{className:"bg-white border-2 border-[#17BC91]/20 rounded-xl p-5 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-200",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-[#073372] to-[#17BC91] rounded-lg",children:e.jsx(oe,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"Datos de nuestra cuenta"}),e.jsx("p",{className:"text-xs text-slate-600",children:N.length>1?"Selecciona una cuenta y usa los datos para transferir":"Usa estos datos para transferir"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-[#F98613]/10 to-[#F98613]/5 border border-[#F98613]/30 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-700 mb-1",children:"Monto exacto a transferir:"}),e.jsx("p",{className:"text-2xl font-bold text-[#F98613]",children:P(f)})]}),e.jsx("div",{className:"space-y-3",children:N.map(r=>{const t=C===r.id;return e.jsxs("div",{className:`bg-white border-2 rounded-xl overflow-hidden transition-all duration-300 ${t?"border-[#17BC91]/30 shadow-md":"border-slate-200 hover:border-slate-300"}`,children:[e.jsxs("button",{onClick:()=>w(t?null:r.id),className:"w-full flex items-center gap-3 p-4 text-left bg-slate-50/50 hover:bg-slate-50 transition-colors",children:[r.bank_logo_url?e.jsx("img",{src:r.bank_logo_url,alt:r.bank_name,className:"h-8 object-contain"}):e.jsx("div",{className:"p-2 bg-slate-200 rounded-lg",children:e.jsx(oe,{className:"w-5 h-5 text-slate-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-bold text-slate-900 text-sm",children:r.bank_name}),r.description&&e.jsx("p",{className:"text-xs text-slate-600 line-clamp-1",children:r.description})]}),t?e.jsx(Me,{className:"w-5 h-5 text-slate-400"}):e.jsx(Ee,{className:"w-5 h-5 text-slate-400"})]}),t&&e.jsxs("div",{className:"p-4 border-t border-slate-100 space-y-2.5 bg-white animate-fadeIn",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs font-medium text-slate-600 mb-1",children:"Titular de la cuenta:"}),e.jsx("p",{className:"text-sm font-bold text-slate-900",children:r.account_holder})]}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-blue-900",children:"NÃºmero de Cuenta:"}),e.jsx("button",{onClick:()=>v(r.account_number,"NÃºmero de cuenta"),className:"p-1.5 hover:bg-blue-100 rounded transition-colors",title:"Copiar",children:e.jsx(ge,{className:"w-4 h-4 text-blue-600"})})]}),e.jsx("p",{className:"text-base font-bold text-blue-700 tracking-wider font-mono",children:r.account_number}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1 capitalize",children:["Cuenta ",r.account_type]})]}),e.jsxs("div",{className:"bg-[#17BC91]/10 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-[#073372]",children:"CCI (Interbancario):"}),e.jsx("button",{onClick:()=>v(r.cci,"CCI"),className:"p-1.5 hover:bg-[#17BC91]/20 rounded transition-colors",title:"Copiar",children:e.jsx(ge,{className:"w-4 h-4 text-[#17BC91]"})})]}),e.jsx("p",{className:"text-base font-bold text-[#073372] tracking-wider font-mono",children:r.cci})]})]})]},r.id)})}),e.jsxs("div",{className:"bg-[#17BC91]/5 border border-[#17BC91]/30 rounded-lg p-4 space-y-3",children:[e.jsx("p",{className:"text-sm font-semibold text-[#073372] mb-2",children:"ðŸ“± Pasos para transferir:"}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"1"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:"Abre tu app bancaria o banca por internet"})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"2"}),e.jsx("p",{className:"text-sm text-slate-700 flex-1",children:'Selecciona "Transferir", elige el banco y copia los datos'})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#073372] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"3"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:["Ingresa el monto exacto: ",e.jsx("span",{className:"font-bold text-[#F98613]",children:P(f)})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"flex items-center justify-center w-6 h-6 bg-[#17BC91] text-white rounded-full text-xs font-bold flex-shrink-0 mt-0.5",children:"4"}),e.jsxs("p",{className:"text-sm text-slate-700 flex-1",children:[e.jsx("span",{className:"font-semibold text-[#17BC91]",children:"Â¡Importante!"})," Guarda o captura el comprobante de confirmaciÃ³n"]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("p",{className:"text-xs text-slate-700",children:[e.jsx("span",{className:"font-semibold",children:"No cierres tu app bancaria"})," hasta guardar el comprobante. Lo necesitarÃ¡s en el siguiente paso."]})]})}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>S(1),className:"flex-1 py-2.5 border-2 border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",children:"Volver"}),e.jsx("button",{onClick:()=>S(3),className:"flex-1 py-2.5 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all",children:"Ya transferÃ­"})]})]}),b===3&&e.jsxs("div",{className:"bg-white border-2 border-[#17BC91]/20 rounded-xl p-5 space-y-4 animate-fadeIn",children:[e.jsxs("div",{className:"flex items-center gap-3 pb-3 border-b border-slate-200",children:[e.jsx("div",{className:"p-2.5 bg-gradient-to-br from-[#073372] to-[#17BC91] rounded-lg",children:e.jsx(se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900",children:"Sube tu comprobante"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Carga la captura del comprobante"})]})]}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:e.jsxs("p",{className:"text-xs text-slate-700 leading-relaxed",children:["Sube la captura de pantalla del comprobante de transferencia. SerÃ¡ revisado por nuestro equipo en ",e.jsx("span",{className:"font-semibold text-[#073372]",children:"24-48 horas"}),"."]})}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-semibold text-slate-700 mb-2",children:["Comprobante de pago ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:h,className:"hidden",id:"transfer-voucher-upload"}),e.jsx("label",{htmlFor:"transfer-voucher-upload",className:`block w-full px-4 py-6 border-2 border-dashed rounded-lg text-center cursor-pointer transition-all ${y?"border-[#17BC91] bg-[#17BC91]/5":"border-slate-300 hover:border-[#073372] hover:bg-slate-50"}`,children:V?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:V,alt:"Preview",className:"max-h-40 mx-auto rounded-md shadow-md border-2 border-[#17BC91]"}),e.jsx("div",{className:"absolute -top-1 -right-1 p-0.5 bg-[#17BC91] rounded-full",children:e.jsx(ce,{className:"w-4 h-4 text-white"})})]}),e.jsx("p",{className:"text-xs text-slate-700 font-medium",children:y?.name}),e.jsx("p",{className:"text-xs text-[#073372]",children:"âœ“ Listo | Click para cambiar"})]}):y?e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-2 bg-[#17BC91]/10 rounded-full inline-block",children:e.jsx(se,{className:"w-6 h-6 text-[#17BC91]"})}),e.jsx("p",{className:"text-xs text-slate-900 font-medium",children:y.name}),e.jsx("p",{className:"text-xs text-[#073372]",children:"âœ“ Listo | Click para cambiar"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"p-2 bg-slate-100 rounded-full inline-block",children:e.jsx(se,{className:"w-6 h-6 text-slate-400"})}),e.jsx("p",{className:"text-sm text-slate-700 font-medium",children:"Click para subir el comprobante"}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG o PDF â€¢ MÃ¡x. 5MB"})]})})]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx("button",{onClick:()=>S(2),disabled:M,className:"flex-1 py-2.5 border-2 border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors disabled:opacity-50",children:"Volver"}),e.jsx("button",{onClick:E,disabled:M||!y,className:"flex-1 inline-flex items-center justify-center py-2.5 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Confirmar Pago"]})})]})]})]})})]})})},Bs=()=>{const[i,a]=l.useState(null),[g,A]=l.useState(!0),[f,I]=l.useState(null),[b,S]=l.useState(!1),[N,D]=l.useState([]),[y,F]=l.useState(!1),[V,L]=l.useState(""),[M,G]=l.useState(null),[_,q]=l.useState(!1),[C,w]=l.useState(!1),[d,v]=l.useState(""),[h,E]=l.useState(!1),[P,r]=l.useState(!1),[t,x]=l.useState(!1),[T,ae]=l.useState(!1),[K,$]=l.useState(!1),[J,O]=l.useState(!1),[H,Z]=l.useState(!1),[k,te]=l.useState(!1),[c,W]=l.useState(null);l.useEffect(()=>{Q(),n()},[]);const Q=async()=>{try{A(!0);const m=(await Y.get("/api/student/enrollment")).data.enrollment,U=m.paymentPlan.gracePeriodDays||0;m.installments=m.installments.map(B=>{const R=new Date,X=new Date(R.getFullYear(),R.getMonth(),R.getDate());console.log("ðŸ• Fecha del sistema:",R.toString()),console.log("ðŸ• Fecha local procesada:",X.toString()),console.log("ðŸ• Fecha ISO:",R.toISOString());const[me,Te,Ae]=B.dueDate.split("-").map(Number),je=new Date(me,Te-1,Ae),Ie=je.getTime()-X.getTime(),Ne=Math.round(Ie/(1e3*60*60*24)),ue=new Date(je);ue.setDate(ue.getDate()+U);const we=Math.round((ue.getTime()-X.getTime())/(1e3*60*60*24));return console.log("ðŸ“… Cuota #"+B.installmentNumber+":",{hoyLocal:X.toISOString().split("T")[0],fechaVencimiento:B.dueDate,diffDays:Ne,gracePeriodDays:U,daysUntilGraceLimit:we}),{...B,daysUntilDue:Ne,daysUntilGraceLimit:we,gracePeriodDays:U}}),a(m)}catch(s){console.error("Error fetching enrollment:",s);const m=s;u.error("Error al cargar informaciÃ³n de pagos",{description:m.response?.data?.message||"No se pudo obtener tu cronograma de pagos"})}finally{A(!1)}},n=async()=>{try{const s=await Y.get("/api/student/can-change-plan");if(F(s.data.can_change),s.data.can_change){const m=await Y.get("/api/student/available-plans");D(m.data.plans)}}catch(s){console.error("Error checking plan change eligibility:",s)}},o=async()=>{if(!M){u.error("Debes seleccionar un plan");return}try{q(!0),await Y.post("/api/student/change-plan",{new_plan_id:M,reason:V||"Cambio solicitado por el aprendiz"}),u.success("Plan de pago cambiado exitosamente",{description:"Tu cronograma de pagos ha sido actualizado"}),S(!1),await Q(),await n()}catch(s){const m=s;u.error("Error al cambiar plan de pago",{description:m.response?.data?.message||"No se pudo cambiar el plan"})}finally{q(!1)}},j=async(s,m,U)=>{try{I(m);const B=new FormData;B.append("voucher_file",U),B.append("declared_amount",String(i?.installments.find(R=>R.id===m)?.totalDue||i?.installments.find(R=>R.id===m)?.amount||0)),B.append("payment_date",new Date().toISOString().split("T")[0]),B.append("payment_method","transfer"),await Y.post(`/api/student/vouchers/${s}/replace`,B,{headers:{"Content-Type":"multipart/form-data"}}),u.success("Voucher reemplazado exitosamente",{description:"El nuevo comprobante estÃ¡ siendo verificado"}),await Q()}catch(B){console.error("Error replacing voucher:",B);const R=B;console.error("Server response:",R.response?.data);const X=R.response?.data,me=X&&typeof X=="object"&&"message"in X?X.message:String(X??"");u.error("Error al reemplazar voucher",{description:me||"No se pudo reemplazar el comprobante"})}finally{I(null)}},ee=s=>{if(s.status==="verified")return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30",children:[e.jsx(be,{className:"w-3 h-3 mr-1"}),"Verificado"]});if(s.status==="paid"){if(s.paymentType==="partial"||s.paymentType==="combined"){const R=s.paidAmount||0;return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-300",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Pago Parcial: ",p(R)," de ",p(s.totalDue)]})}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#073372]/10 text-[#073372] border border-[#073372]/30",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"En VerificaciÃ³n"]})}const m=s.daysUntilDue||0,U=s.daysUntilGraceLimit||0,B=s.gracePeriodDays||0;return m<0&&U>=0&&B>0?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 border border-orange-300",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"PerÃ­odo de Gracia (",U," dÃ­as restantes)"]}):s.isOverdue||U<0&&s.status==="pending"?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-300",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),"Vencido con Mora (",Math.abs(U)," dÃ­as)"]}):e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Pendiente (",m>0?`${m} dÃ­as`:"Vence hoy",")"]})},p=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),le=s=>new Date(s).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric"});return g?e.jsx(he,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Cargando informaciÃ³n de pagos..."})]})})}):i?e.jsx(he,{children:e.jsxs("div",{className:"p-8 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Control de Pagos"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Gestiona tus cuotas y comprobantes de pago"})]}),e.jsxs("div",{className:"flex gap-3",children:[y&&e.jsxs("button",{onClick:()=>S(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-all shadow-md hover:shadow-lg",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"Cambiar Plan"]}),e.jsxs("button",{onClick:()=>w(!0),className:"inline-flex items-center px-4 py-2 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white font-medium rounded-lg transition-all shadow-md hover:shadow-lg",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Pago Parcial"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#073372] to-[#17BC91] text-white rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Ce,{className:"w-8 h-8 opacity-80"}),e.jsx(ze,{className:"w-5 h-5 opacity-60"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Total a Pagar"}),e.jsx("p",{className:"text-2xl font-bold",children:p(i.paymentPlan.totalAmount)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(be,{className:"w-8 h-8 text-[#17BC91]"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Pagado"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:p(i.totalPaid)}),e.jsxs("p",{className:"text-xs text-[#17BC91] mt-1",children:[i.paymentProgress.toFixed(0),"% completado"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(de,{className:"w-8 h-8 text-[#F98613]"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Pendiente"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:p(i.totalPending)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(pe,{className:"w-8 h-8 text-[#073372]"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Plan de Pago"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900",children:[i.paymentPlan.installmentsCount," cuotas"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:i.paymentPlan.name})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Progreso de Pagos"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[i.paymentProgress.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 h-3 rounded-full transition-all duration-500",style:{width:`${i.paymentProgress}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Cronograma de Cuotas"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Administra tus pagos mensuales y sube tus comprobantes"})]}),e.jsx("div",{className:"divide-y divide-slate-200",children:i.installments.map(s=>e.jsxs("div",{className:"p-6 hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Cuota #",s.installmentNumber]}),ee(s)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Fecha de Vencimiento"}),e.jsxs("p",{className:"font-medium text-slate-900 flex items-center",children:[e.jsx(Ye,{className:"w-4 h-4 mr-1 text-blue-600"}),le(s.dueDate)]}),s.daysUntilDue!==void 0&&s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`text-xs mt-1 ${s.daysUntilDue<7&&s.daysUntilDue>=0?"text-orange-600 font-semibold":s.daysUntilDue<0?"text-red-600":"text-slate-500"}`,children:s.daysUntilDue>0?`Faltan ${s.daysUntilDue} dÃ­as`:s.daysUntilDue===0?"Â¡Vence hoy!":`Vencido hace ${Math.abs(s.daysUntilDue)} dÃ­as`}),s.daysUntilDue<0&&s.daysUntilGraceLimit!==void 0&&s.daysUntilGraceLimit>=0&&s.gracePeriodDays&&s.gracePeriodDays>0&&e.jsxs("p",{className:"text-xs mt-1 text-orange-600 font-semibold bg-orange-50 px-2 py-1 rounded inline-block",children:["âš ï¸ PerÃ­odo de gracia: ",s.daysUntilGraceLimit," dÃ­as restantes"]}),s.daysUntilGraceLimit!==void 0&&s.daysUntilGraceLimit<0&&e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("p",{className:"text-xs text-red-600 font-bold bg-red-50 px-2 py-1 rounded inline-block",children:["ðŸš¨ Mora aplicada (",Math.abs(s.daysUntilGraceLimit)," dÃ­as)"]}),s.lateFee>0&&e.jsxs("p",{className:"text-xs text-red-700 font-bold bg-red-100 px-2 py-1 rounded inline-block",children:["ðŸ’° Recargo por mora: ",p(s.lateFee)]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Monto"}),e.jsx("p",{className:"font-bold text-slate-900",children:p(s.amount)}),s.lateFee>0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 font-semibold",children:["+ ",p(s.lateFee)," mora"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Total a Pagar"}),e.jsx("p",{className:"font-bold text-blue-600",children:p(s.totalDue)}),s.lateFee>0&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"(Incluye mora)"}),(s.paymentType==="partial"||s.paymentType==="combined")&&s.remainingAmount&&s.remainingAmount>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-xs text-blue-600 font-semibold",children:["Pagado: ",p(s.paidAmount)]}),e.jsxs("p",{className:"text-xs text-orange-600 font-semibold",children:["Restante: ",p(s.remainingAmount)]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${s.paidAmount/s.totalDue*100}%`}})})]})]}),s.paidDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Fecha de Pago"}),e.jsx("p",{className:"font-medium text-green-600",children:le(s.paidDate)})]})]})]})}),s.vouchers.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Comprobantes Subidos:"}),s.vouchers.map(m=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(pe,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:p(m.declaredAmount)}),e.jsxs("p",{className:"text-xs text-slate-500",children:[le(m.paymentDate)," Â· ",m.paymentMethod]}),m.status==="rejected"&&m.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 italic",children:["Motivo: ",m.rejectionReason]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[m.status==="approved"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-green-100 text-green-800 rounded-full font-medium",children:"âœ“ Aprobado"}),m.receiptUrl&&e.jsxs("a",{href:m.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1.5 bg-[#073372] hover:bg-[#073372]/90 text-white text-xs font-medium rounded-lg transition-colors flex items-center space-x-1",title:"Descargar Boleta de Pago",children:[e.jsx(pe,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver Boleta"})]})]}),m.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-medium animate-pulse",children:"â³ En revisiÃ³n"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:U=>{const B=U.target.files?.[0];B&&j(m.id,s.id,B)},disabled:f===s.id,className:"hidden"}),e.jsxs("div",{className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center space-x-1",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:"Reemplazar"})]})]})]}),m.status==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-red-100 text-red-800 rounded-full font-medium",children:"âœ— Rechazado"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:U=>{const B=U.target.files?.[0];B&&j(m.id,s.id,B)},disabled:f===s.id,className:"hidden"}),e.jsxs("div",{className:"px-3 py-1.5 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white text-xs font-medium rounded-lg transition-colors flex items-center space-x-1",children:[e.jsx(se,{className:"w-3 h-3"}),e.jsx("span",{children:"Subir Nuevo"})]})]})]}),e.jsx("a",{href:m.voucherUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Descargar voucher",children:e.jsx(Le,{className:"w-4 h-4 text-blue-600"})})]})]},m.id))]}),((s.status==="pending"||s.status==="late"||s.isOverdue)&&(!s.vouchers.length||s.vouchers.every(m=>m.status==="rejected"))||s.status==="paid"&&(s.paymentType==="partial"||s.paymentType==="combined")&&s.remainingAmount&&s.remainingAmount>0)&&e.jsxs("div",{className:"mt-4",children:[s.vouchers.some(m=>m.status==="rejected")&&e.jsx("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 font-medium flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Tu voucher anterior fue rechazado. Por favor, realiza un nuevo pago."]})}),s.status==="paid"&&s.remainingAmount&&s.remainingAmount>0&&e.jsxs("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-blue-800 font-bold flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Tienes un saldo pendiente de ",p(s.remainingAmount)," en esta cuota"]}),e.jsxs("p",{className:"text-xs text-blue-700 mt-1",children:["Ya pagaste: ",p(s.paidAmount)," de ",p(s.totalDue)]})]}),s.lateFee>0&&s.status!=="paid"&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-orange-800 font-bold flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Esta cuota tiene mora. Debes pagar el total: ",p(s.totalDue)]}),e.jsxs("p",{className:"text-xs text-orange-700 mt-1",children:["Monto original: ",p(s.amount)," + Mora: ",p(s.lateFee)]})]}),e.jsx("button",{onClick:()=>{W(s),$(!0)},disabled:f===s.id,className:"w-full flex items-center justify-center px-6 py-4 bg-gradient-to-r from-[#073372] to-[#17BC91] hover:from-[#073372]/90 hover:to-[#17BC91]/90 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:f===s.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"w-5 h-5"}),e.jsx("span",{children:s.remainingAmount&&s.remainingAmount>0&&s.remainingAmount<s.totalDue?`Pagar Restante ${p(s.remainingAmount)}`:`Pagar ${p(s.totalDue)}`})]})})]})]},s.id))})]}),K&&c&&e.jsx(Pe,{isOpen:K,onClose:()=>{$(!1),W(null)},onSelectMethod:s=>{$(!1),s==="card"?O(!0):s==="yape"?Z(!0):s==="transfer"&&te(!0)},installmentAmount:c.remainingAmount&&c.remainingAmount>0&&c.remainingAmount<c.totalDue?c.remainingAmount:c.totalDue}),J&&c&&e.jsx(ke,{isOpen:J,onClose:()=>{O(!1),W(null)},onSuccess:()=>{Q()},installment:{id:Number(c.id),amount:c.remainingAmount&&c.remainingAmount>0&&c.remainingAmount<c.totalDue?c.remainingAmount:c.totalDue,installment_number:c.installmentNumber}}),H&&c&&e.jsx(De,{isOpen:H,onClose:()=>{Z(!1),W(null)},onSuccess:()=>{Q()},installmentId:c.id,amount:c.remainingAmount&&c.remainingAmount>0&&c.remainingAmount<c.totalDue?c.remainingAmount:c.totalDue}),k&&c&&e.jsx(Be,{isOpen:k,onClose:()=>{te(!1),W(null)},onSuccess:()=>{Q()},installmentId:c.id,amount:c.remainingAmount&&c.remainingAmount>0&&c.remainingAmount<c.totalDue?c.remainingAmount:c.totalDue}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Cambiar Plan de Pago"}),e.jsx("button",{onClick:()=>S(!1),className:"text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"Plan Actual:"}),e.jsx("p",{className:"text-lg font-bold text-blue-700",children:i.paymentPlan.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Total:"}),e.jsx("p",{className:"font-bold text-blue-900",children:p(i.paymentPlan.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Cuotas:"}),e.jsxs("p",{className:"font-bold text-blue-900",children:[i.paymentPlan.installmentsCount," mensuales"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Selecciona tu nuevo plan:"}),e.jsx("div",{className:"space-y-3",children:N.map(s=>e.jsxs("label",{className:`block p-4 border-2 rounded-lg cursor-pointer transition-all ${M===s.id?"border-[#17BC91] bg-[#17BC91]/5":"border-slate-200 hover:border-slate-300"}`,children:[e.jsx("input",{type:"radio",name:"new_plan",value:s.id,checked:M===s.id,onChange:()=>G(s.id),className:"hidden"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[s.installmentsCount," cuotas de ",p(s.monthlyAmount)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-[#073372]",children:p(s.totalAmount)})]})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"RazÃ³n del cambio (opcional):"}),e.jsx("textarea",{value:V,onChange:s=>L(s.target.value),placeholder:"Ej: Cambio por disponibilidad econÃ³mica",rows:3,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#17BC91] focus:border-transparent"})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-orange-900",children:[e.jsx("strong",{children:"âš ï¸ Importante:"})," Al cambiar de plan, tus cuotas pendientes serÃ¡n canceladas y se generarÃ¡n nuevas segÃºn el plan seleccionado."]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>S(!1),className:"px-6 py-2 border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:o,disabled:!M||_,className:"px-6 py-2 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:_?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Cambiando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qe,{className:"w-4 h-4 mr-2"}),"Confirmar Cambio"]})})]})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pago Parcial"}),e.jsx("button",{onClick:()=>{w(!1),v("")},className:"text-white/80 hover:text-white transition-colors",children:e.jsx(re,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-slate-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600",children:"Total del plan:"}),e.jsx("p",{className:"text-lg font-bold text-slate-900",children:p(i.paymentPlan.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600",children:"Pendiente:"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:p(i.totalPending)})]})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"relative",children:e.jsx($e,{label:"Monto a pagar",type:"number",value:d,onChange:s=>v(s.target.value),placeholder:"0.00",min:.01,max:i.totalPending,step:.01,icon:e.jsx("span",{className:"text-slate-500 font-medium",children:"S/"}),helperText:`Monto mÃ¡ximo: ${p(i.totalPending)}`,variant:"outlined"})}),d&&parseFloat(d)>i.totalPending&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 font-medium flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"El monto ingresado (",p(parseFloat(d)),") excede tu deuda pendiente (",p(i.totalPending),")"]})})]}),d&&parseFloat(d)>0&&parseFloat(d)<=i.totalPending&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 mb-2",children:"âœ… DistribuciÃ³n automÃ¡tica:"}),e.jsxs("p",{className:"text-xs text-green-700",children:["El monto de ",p(parseFloat(d))," se aplicarÃ¡ a tus cuotas mÃ¡s antiguas primero, cubriendo mora si existe."]})]}),e.jsxs("button",{onClick:()=>{if(!d||parseFloat(d)<=0){u.error("Ingresa un monto vÃ¡lido");return}if(parseFloat(d)>i.totalPending){u.error("El monto excede tu deuda pendiente");return}w(!1),E(!0)},disabled:!d||parseFloat(d)<=0||parseFloat(d)>i.totalPending,className:"w-full flex items-center justify-center px-6 py-4 bg-gradient-to-r from-[#073372] to-[#17BC91] hover:from-[#073372]/90 hover:to-[#17BC91]/90 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(ie,{className:"w-5 h-5 mr-2"}),e.jsxs("span",{children:["Pagar ",d&&parseFloat(d)>0?p(parseFloat(d)):""]})]})]})]})}),h&&d&&e.jsx(Pe,{isOpen:h,onClose:()=>{E(!1),v("")},onSelectMethod:s=>{E(!1),s==="card"?r(!0):s==="yape"?x(!0):s==="transfer"&&ae(!0)},installmentAmount:parseFloat(d)}),P&&d&&e.jsx(ke,{isOpen:P,onClose:()=>{r(!1),v("")},onSuccess:()=>{v(""),Q()},installment:{id:0,amount:parseFloat(d),installment_number:0},isPartialPayment:!0}),t&&d&&e.jsx(De,{isOpen:t,onClose:()=>{x(!1),v("")},onSuccess:()=>{v(""),Q()},installmentId:"",amount:parseFloat(d),isPartialPayment:!0}),T&&d&&e.jsx(Be,{isOpen:T,onClose:()=>{ae(!1),v("")},onSuccess:()=>{v(""),Q()},installmentId:"",amount:parseFloat(d),isPartialPayment:!0})]})}):e.jsx(he,{children:e.jsx("div",{className:"p-8 max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-6 text-center",children:[e.jsx(z,{className:"w-12 h-12 text-yellow-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No tienes matrÃ­cula activa"}),e.jsx("p",{className:"text-slate-600",children:"Contacta con el Ã¡rea de admisiones para mÃ¡s informaciÃ³n."})]})})})};export{Bs as default};
