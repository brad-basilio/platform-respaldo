import{r as t,a as i,j as e,H as M}from"./app-DBgbPuMu.js";import{t as r,A as T}from"./AuthenticatedLayout-CDC4-kpR.js";import{I as n}from"./input-BXTTnMh3.js";import{P as S}from"./plus-BVdoeRmv.js";import{C as F}from"./credit-card-BW6WK1lP.js";import{C as d}from"./check-DBqco0Sz.js";import{T as H}from"./trash-2-B0qvCXPz.js";import{L as b}from"./lock-q299_5iN.js";import{X as I}from"./dropdown-menu-DlG3qvZy.js";import{C as U}from"./circle-alert-Ddx8u-47.js";/* empty css            */import"./button-CHuyEkIG.js";import"./clsx-B-dksMZM.js";import"./badge-BQE-VrJN.js";import"./index-9QHdgY5P.js";import"./createLucideIcon-CARAMrd8.js";import"./file-text-BThQLhe7.js";import"./triangle-alert-CvHxaLUB.js";import"./circle-check-big-DFeh0OgZ.js";import"./clock-j7Zpjt81.js";import"./index-NvEw4eID.js";import"./index-BkMTO_VP.js";const pe=()=>{const[x,D]=t.useState([]),[L,j]=t.useState(!0),[B,l]=t.useState(!1),[c,f]=t.useState(!1),[m,N]=t.useState(""),[u,v]=t.useState(""),[h,w]=t.useState(""),[p,y]=t.useState(""),[C,k]=t.useState(""),[P,_]=t.useState(!1),[A,E]=t.useState(!1);t.useEffect(()=>{o()},[]);const o=async()=>{try{j(!0);const a=await i.get("/api/student/payment-methods");D(a.data.payment_methods||[])}catch(a){console.error("Error fetching payment methods:",a),r.error("Error al cargar los mÃ©todos de pago")}finally{j(!1)}},q=async a=>{try{await i.put(`/api/student/payment-methods/${a}`,{is_default:!0}),r.success("Tarjeta marcada como predeterminada"),o()}catch{r.error("Error al actualizar la tarjeta")}},$=async(a,s)=>{try{await i.put(`/api/student/payment-methods/${a}`,{auto_payment_enabled:!s}),r.success(s?"Pagos automÃ¡ticos deshabilitados":"Pagos automÃ¡ticos habilitados"),o()}catch{r.error("Error al actualizar configuraciÃ³n")}},Y=async a=>{if(confirm("Â¿EstÃ¡s seguro de eliminar esta tarjeta?"))try{await i.delete(`/api/student/payment-methods/${a}`),r.success("Tarjeta eliminada exitosamente"),o()}catch{r.error("Error al eliminar la tarjeta")}},z=async()=>{if(!m||!u||!h||!p||!C){r.error("Por favor, completa todos los campos");return}f(!0);try{const a=`tok_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;await i.post("/api/student/payment-methods",{kulki_card_token:a,kulki_customer_id:`cus_${Date.now()}`,card_brand:V(m),card_last4:m.slice(-4),card_exp_month:h.padStart(2,"0"),card_exp_year:p,cardholder_name:u,is_default:P,auto_payment_enabled:A}),r.success("Tarjeta guardada exitosamente"),l(!1),g(),o()}catch(a){const s=a;r.error(s.response?.data?.message||"Error al guardar la tarjeta")}finally{f(!1)}},V=a=>{const s=a.replace(/\s/g,"");return/^4/.test(s)?"visa":/^5[1-5]/.test(s)?"mastercard":/^3[47]/.test(s)?"amex":"unknown"},g=()=>{N(""),v(""),w(""),y(""),k(""),_(!1),E(!1)},G=a=>({visa:"ðŸ’³",mastercard:"ðŸ’³",amex:"ðŸ’³"})[a.toLowerCase()]||"ðŸ’³";return L?e.jsxs(T,{children:[e.jsx(M,{title:"MÃ©todos de Pago"}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Cargando mÃ©todos de pago..."})]})})]}):e.jsxs(T,{children:[e.jsx(M,{title:"MÃ©todos de Pago"}),e.jsxs("div",{className:"p-8 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"MÃ©todos de Pago"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Gestiona tus tarjetas y configuraciÃ³n de pagos"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:[e.jsx(S,{className:"w-5 h-5 mr-2"}),"Agregar Tarjeta"]})]}),x.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-12 text-center",children:[e.jsx(F,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No tienes tarjetas guardadas"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Agrega una tarjeta para realizar pagos mÃ¡s rÃ¡pidos"}),e.jsxs("button",{onClick:()=>l(!0),className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-xl hover:shadow-lg transition-all",children:[e.jsx(S,{className:"w-5 h-5 mr-2"}),"Agregar Primera Tarjeta"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x.map(a=>e.jsxs("div",{className:`bg-gradient-to-br rounded-2xl p-6 shadow-lg text-white relative overflow-hidden ${a.cardBrand==="visa"?"from-blue-600 to-blue-800":a.cardBrand==="mastercard"?"from-orange-500 to-red-600":"from-slate-700 to-slate-900"}`,children:[e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -mr-32 -mt-32"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full -ml-24 -mb-24"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsx("div",{className:"text-4xl",children:G(a.cardBrand)}),e.jsx("div",{className:"text-right",children:a.isDefault&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/20 backdrop-blur-sm",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),"Predeterminada"]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-white/70 mb-1",children:"NÃºmero de Tarjeta"}),e.jsxs("p",{className:"text-xl font-mono tracking-wider",children:["â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ ",a.cardLast4]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/70 mb-1",children:"Titular"}),e.jsx("p",{className:"text-sm font-medium truncate",children:a.cardholderName})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-white/70 mb-1",children:"Vence"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.cardExpMonth,"/",a.cardExpYear]})]})]}),a.autoPaymentEnabled&&e.jsx("div",{className:"mb-4",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 backdrop-blur-sm text-white",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),"Pagos AutomÃ¡ticos Activos"]})}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-white/20",children:[!a.isDefault&&e.jsx("button",{onClick:()=>q(a.id),className:"flex-1 px-3 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg text-xs font-medium transition-colors",children:"Marcar como Principal"}),e.jsx("button",{onClick:()=>$(a.id,a.autoPaymentEnabled),className:"flex-1 px-3 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg text-xs font-medium transition-colors",title:a.autoPaymentEnabled?"Desactivar autopago":"Activar autopago",children:a.autoPaymentEnabled?"Desactivar Autopago":"Activar Autopago"}),e.jsx("button",{onClick:()=>Y(a.id),className:"p-2 bg-red-500/20 hover:bg-red-500/30 backdrop-blur-sm rounded-lg transition-colors",title:"Eliminar tarjeta",children:e.jsx(H,{className:"w-4 h-4"})})]})]})]},a.id))}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(b,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"Seguridad de tus Datos"}),e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"Tus datos de tarjeta estÃ¡n protegidos con encriptaciÃ³n de nivel bancario. Nunca almacenamos el nÃºmero completo de tu tarjeta ni el CVV."}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2 text-green-600"}),"Los pagos son procesados de forma segura por Culqi"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2 text-green-600"}),"Puedes habilitar/deshabilitar pagos automÃ¡ticos en cualquier momento"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2 text-green-600"}),"Elimina tus tarjetas guardadas cuando lo desees"]})]})]})]})}),B&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-5 flex items-center justify-between flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Agregar Nueva Tarjeta"}),e.jsx("p",{className:"text-white/90 text-sm mt-1",children:"Guarda tu tarjeta para pagos futuros"})]}),e.jsx("button",{onClick:()=>{l(!1),g()},className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",children:e.jsx(I,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-slate-600 bg-slate-50 py-3 px-4 rounded-lg mb-6",children:[e.jsx(b,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"ConexiÃ³n segura - Tus datos estÃ¡n protegidos"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(n,{label:"NÃºmero de Tarjeta",type:"text",value:m,onChange:a=>N(a.target.value.replace(/\s/g,"")),placeholder:"4111 1111 1111 1111",maxLength:16,required:!0}),e.jsx(n,{label:"Nombre del Titular",type:"text",value:u,onChange:a=>v(a.target.value.toUpperCase()),placeholder:"Como aparece en la tarjeta",required:!0}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(n,{label:"Mes",type:"text",value:h,onChange:a=>w(a.target.value),placeholder:"MM",maxLength:2,required:!0}),e.jsx(n,{label:"AÃ±o",type:"text",value:p,onChange:a=>y(a.target.value),placeholder:"YYYY",maxLength:4,required:!0}),e.jsx(n,{label:"CVV",type:"text",value:C,onChange:a=>k(a.target.value),placeholder:"123",maxLength:4,required:!0})]}),e.jsxs("div",{className:"space-y-3 pt-4 border-t border-slate-200",children:[x.length>0&&e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:P,onChange:a=>_(a.target.checked),className:"mt-1 w-5 h-5 text-[#17BC91] border-slate-300 rounded focus:ring-[#17BC91] transition-all"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 group-hover:text-[#073372] transition-colors",children:"Marcar como predeterminada"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Esta serÃ¡ tu tarjeta principal para pagos"})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:a=>E(a.target.checked),className:"mt-1 w-5 h-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500 transition-all"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 group-hover:text-[#073372] transition-colors",children:"Habilitar Pagos AutomÃ¡ticos"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Tus cuotas se cobrarÃ¡n automÃ¡ticamente en la fecha de vencimiento"})]})]})]}),e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(U,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-900",children:"Al guardar tu tarjeta, aceptas que UNCED procese tus datos de forma segura para facilitar futuros pagos. Puedes eliminar esta tarjeta en cualquier momento."})]})})]})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 border-t border-slate-200 flex justify-end space-x-3 flex-shrink-0",children:[e.jsx("button",{onClick:()=>{l(!1),g()},disabled:c,className:"px-6 py-2.5 border-2 border-slate-300 text-slate-700 font-semibold rounded-lg hover:bg-slate-100 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:z,disabled:c,className:`px-8 py-2.5 rounded-lg font-semibold transition-all flex items-center space-x-2 ${c?"bg-slate-400 cursor-not-allowed":"bg-gradient-to-r from-[#073372] to-[#17BC91] hover:shadow-lg"} text-white`,children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{children:"Guardar Tarjeta"})]})})]})]})})]})]})};export{pe as default};
