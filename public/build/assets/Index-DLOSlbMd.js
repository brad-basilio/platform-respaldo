import{c as de,r as j,U as me,j as t,a as ue,b as V}from"./app-DloPvlvC.js";import{t as o,A as he}from"./AuthenticatedLayout-DgVN5Dag.js";import{I as c}from"./input-B9jnIT_9.js";import{B as pe}from"./button-CxJ5Uh1A.js";import{S as xe}from"./switch-D-s1wESu.js";import{T as fe}from"./textarea-Ckzm2tI1.js";import{M as ge,a as _e,A as ve,t as ye}from"./index.esm-D0xRZAVP.js";/* empty css                       */import{C as te}from"./credit-card-CgcSEmpl.js";import{S as be}from"./square-pen-DUWGh6Ls.js";import{T as je,P as Ne}from"./trash-2-Ch_TjCfz.js";import{S as we}from"./search-DjpqH3yk.js";import{C as Se}from"./circle-x-BngfkSnE.js";/* empty css            */import"./dropdown-menu-Dy9AY3D5.js";import"./createLucideIcon-isoGPNkP.js";import"./index-BJ4GAdsQ.js";import"./index-DAWLt_Y-.js";import"./badge-D7WurQdG.js";import"./index-HgIPsiiH.js";ge.registerModules([_e]);const lt=n=>{const e=de.c(52),{paymentPlans:N}=n,[u,le]=j.useState(N),[Y,d]=j.useState(!1),[i,ae]=j.useState(null),[m,se]=j.useState("");let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w={name:"",academic_level_id:void 0,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""},e[0]=w):w=e[0];const[s,r]=j.useState(w);let S;e[1]===Symbol.for("react.memo_cache_sentinel")?(S=async()=>{try{const l=(await ue.get("/api/admin/payment-plans")).data;Array.isArray(l)&&(le(l),console.log("✅ Planes de pago actualizados desde el servidor:",l.length,"planes"))}catch(a){console.error("❌ Error fetching payment plans:",a),o.error("Error al obtener planes de pago",{description:"No se pudo sincronizar con el servidor.",duration:5e3})}},e[1]=S):S=e[1];const h=S;let P,C;e[2]===Symbol.for("react.memo_cache_sentinel")?(P=()=>{h()},C=[h],e[2]=P,e[3]=C):(P=e[2],C=e[3]),me.useEffect(P,C);let E;e[4]===Symbol.for("react.memo_cache_sentinel")?(E=a=>{ae(a),r({name:a.name,academic_level_id:a.academic_level_id,installments_count:a.installments_count,monthly_amount:a.monthly_amount,total_amount:a.total_amount,discount_percentage:a.discount_percentage,duration_months:a.duration_months,late_fee_percentage:a.late_fee_percentage,grace_period_days:a.grace_period_days,is_active:a.is_active,description:a.description||""}),d(!0)},e[4]=E):E=e[4];const ne=E;let k;e[5]===Symbol.for("react.memo_cache_sentinel")?(k=a=>{confirm(`¿Estás seguro de eliminar el plan "${a.name}"?`)&&V.delete(`/admin/payment-plans/${a.id}`,{preserveScroll:!0,onSuccess:async()=>{o.success("Plan de pago eliminado exitosamente"),await h()},onError:Pe})},e[5]=k):k=e[5];const re=k;let F,A,z,R,M,T,D;e[6]===Symbol.for("react.memo_cache_sentinel")?(M={headerName:"Plan de Pago",field:"name",flex:1,minWidth:250,filter:"agTextColumnFilter",cellRenderer:Ce},T={headerName:"Cuotas",field:"installments_count",width:100,cellRenderer:Ee},D={headerName:"Mensualidad",field:"monthly_amount",width:140,cellRenderer:ke},F={headerName:"Total",field:"total_amount",width:140,cellRenderer:Fe},A={headerName:"Interés",field:"discount_percentage",width:120,cellRenderer:Ae},z={headerName:"Duración",field:"duration_months",width:110,cellRenderer:ze},R={headerName:"Estudiantes",field:"students_count",width:130,cellRenderer:Re},e[6]=F,e[7]=A,e[8]=z,e[9]=R,e[10]=M,e[11]=T,e[12]=D):(F=e[6],A=e[7],z=e[8],R=e[9],M=e[10],T=e[11],D=e[12]);let q;e[13]===Symbol.for("react.memo_cache_sentinel")?(q={headerName:"Estado",field:"is_active",width:120,cellRenderer:a=>{const l=a.data,b=a.value,ce=async ee=>{if(!l||!l.id){o.error("Error",{description:"No se pudo identificar el plan de pago",duration:3e3});return}V.put(`/admin/payment-plans/${l.id}`,{name:l.name,academic_level_id:l.academic_level_id,installments_count:l.installments_count,monthly_amount:l.monthly_amount,total_amount:l.total_amount,discount_percentage:l.discount_percentage,duration_months:l.duration_months,late_fee_percentage:l.late_fee_percentage,grace_period_days:l.grace_period_days,is_active:ee,description:l.description},{preserveScroll:!0,onSuccess:async()=>{await h(),o.success(ee?"Plan activado":"Plan desactivado",{description:`El plan "${l.name}" ha sido ${ee?"activado":"desactivado"}`,duration:3e3})},onError:Me})};return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(xe,{checked:b,onCheckedChange:ce})})}},e[13]=q):q=e[13];let I;e[14]===Symbol.for("react.memo_cache_sentinel")?(I=[M,T,D,F,A,z,R,q,{headerName:"Acciones",width:120,sortable:!1,filter:!1,cellRenderer:a=>{const l=a.data;return t.jsxs("div",{className:"flex items-center justify-center space-x-2 h-full",children:[t.jsx("button",{onClick:()=>ne(l),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded transition-colors",title:"Editar plan",children:t.jsx(be,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>re(l),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded transition-colors",title:"Eliminar plan",children:t.jsx(je,{className:"h-4 w-4"})})]})}}],e[14]=I):I=e[14];const oe=I;let $;e[15]===Symbol.for("react.memo_cache_sentinel")?($=()=>{ae(null),r({name:"",academic_level_id:void 0,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""}),d(!0)},e[15]=$):$=e[15];const ie=$;let B;e[16]!==i||e[17]!==s?(B=a=>{a.preventDefault();const{academic_level:l,...b}=s;i?V.put(`/admin/payment-plans/${i.id}`,b,{preserveScroll:!0,onSuccess:async()=>{o.success("Plan de pago actualizado exitosamente"),d(!1),await h()},onError:Te}):V.post("/admin/payment-plans",b,{preserveScroll:!0,onSuccess:async()=>{o.success("Plan de pago creado exitosamente"),d(!1),await h()},onError:De})},e[16]=i,e[17]=s,e[18]=B):B=e[18];const Z=B;let L;e[19]!==s?(L=()=>{const a=s.monthly_amount||0,l=s.installments_count||1,b=a*l;r({...s,total_amount:Math.round(b*100)/100})},e[19]=s,e[20]=L):L=e[20];const G=L;let H;e[21]===Symbol.for("react.memo_cache_sentinel")?(H=t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(te,{className:"w-7 h-7 text-blue-600"}),"Planes de Pago"]}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Configura los planes de pago disponibles para el curso"})]}),e[21]=H):H=e[21];let Q;e[22]===Symbol.for("react.memo_cache_sentinel")?(Q=t.jsxs("div",{className:"flex items-center justify-between",children:[H,t.jsxs(pe,{onClick:ie,className:"flex items-center gap-2",children:[t.jsx(Ne,{className:"w-4 h-4"}),"Nuevo Plan"]})]}),e[22]=Q):Q=e[22];let W,U;e[23]===Symbol.for("react.memo_cache_sentinel")?(W=a=>se(a.target.value),U=t.jsx(we,{className:"w-4 h-4"}),e[23]=W,e[24]=U):(W=e[23],U=e[24]);let p,x;e[25]!==m?(p=t.jsx(c,{type:"text",label:"Buscar por nombre, descripción...",value:m,onChange:W,icon:U,className:"pr-10"}),x=m&&t.jsx("button",{onClick:()=>se(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:t.jsx(Se,{className:"w-5 h-5"})}),e[25]=m,e[26]=p,e[27]=x):(p=e[26],x=e[27]);let f;e[28]!==p||e[29]!==x?(f=t.jsxs("div",{className:"relative",children:[p,x]}),e[28]=p,e[29]=x,e[30]=f):f=e[30];let X;e[31]===Symbol.for("react.memo_cache_sentinel")?(X={height:"calc(100vh - 350px)",width:"100%"},e[31]=X):X=e[31];let J;e[32]===Symbol.for("react.memo_cache_sentinel")?(J={sortable:!0,resizable:!0},e[32]=J):J=e[32];let K;e[33]===Symbol.for("react.memo_cache_sentinel")?(K=[10,20,50,100],e[33]=K):K=e[33];let g;e[34]!==u||e[35]!==m?(g=t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:t.jsx("div",{className:"ag-theme-quartz",style:X,children:t.jsx(ve,{rowData:u,columnDefs:oe,quickFilterText:m,defaultColDef:J,pagination:!0,paginationPageSize:20,paginationPageSizeSelector:K,animateRows:!0,rowHeight:70,headerHeight:50,theme:ye})})}),e[34]=u,e[35]=m,e[36]=g):g=e[36];let _;e[37]!==f||e[38]!==g?(_=t.jsxs("div",{className:"space-y-4",children:[f,g]}),e[37]=f,e[38]=g,e[39]=_):_=e[39];let v;e[40]!==u.length?(v=u.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(te,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 text-lg",children:"No hay planes de pago registrados"}),t.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Crea el primer plan para comenzar"})]}),e[40]=u.length,e[41]=v):v=e[41];let y;e[42]!==G||e[43]!==i||e[44]!==s||e[45]!==Z||e[46]!==Y?(y=Y&&t.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/75 backdrop-blur-sm animate-fade-in flex items-center justify-center p-4",onClick:()=>d(!1),style:{height:"100vh",width:"100vw"},children:t.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col animate-scale-in",onClick:qe,children:[t.jsx("div",{className:"relative bg-blue-600 px-8 py-6 rounded-t-3xl flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:i?"Editar Plan de Pago":"Nuevo Plan de Pago"}),t.jsx("p",{className:"text-blue-100",children:i?"Actualiza la información del plan":"Completa la información para crear un nuevo plan"})]}),t.jsx("button",{type:"button",onClick:()=>d(!1),className:"text-white/80 hover:text-white hover:bg-white/10 rounded-full p-2 transition-all duration-200",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),t.jsxs("form",{onSubmit:Z,className:"flex flex-col flex-1 overflow-hidden",children:[t.jsx("div",{className:"p-8 space-y-6 overflow-y-auto flex-1",children:t.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[t.jsx(c,{label:"Nombre del Plan",value:s.name,onChange:a=>r({...s,name:a.target.value}),placeholder:"Ej: Plan Premium, Plan Estándar",required:!0}),t.jsx("input",{type:"hidden",name:"academic_level_id",value:s.academic_level_id||""}),t.jsx(fe,{label:"Descripción",value:s.description,onChange:a=>r({...s,description:a.target.value}),placeholder:"Descripción opcional del plan",rows:2}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(c,{label:"Número de Cuotas",type:"number",value:s.installments_count,onChange:a=>r({...s,installments_count:parseInt(a.target.value)||1}),onBlur:G,min:1,max:12,required:!0})}),t.jsx("div",{children:t.jsx(c,{label:"Duración (meses)",type:"number",value:s.duration_months,onChange:a=>r({...s,duration_months:parseInt(a.target.value)||1}),min:1,required:!0})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(c,{label:"Monto Mensual (S/)",type:"number",step:"0.01",value:s.monthly_amount,onChange:a=>r({...s,monthly_amount:parseFloat(a.target.value)||0}),onBlur:G,min:0,required:!0})}),t.jsxs("div",{children:[t.jsx(c,{label:"Monto Total (S/)",type:"number",step:"0.01",value:s.total_amount,onChange:a=>r({...s,total_amount:parseFloat(a.target.value)||0}),min:0,required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Precio base S/ 1800. Al contado sin interés, fraccionado con interés."})]})]}),t.jsxs("div",{children:[s.total_amount>1800&&t.jsx("div",{className:"p-3 bg-orange-50 border border-orange-200 rounded-lg",children:t.jsxs("p",{className:"text-sm text-orange-800",children:[t.jsx("strong",{children:"Interés aplicado:"})," +",((s.total_amount-1800)/1800*100).toFixed(1),"% (S/ ",(s.total_amount-1800).toFixed(2)," sobre el precio base)"]})}),s.total_amount===1800&&s.installments_count===1&&t.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:t.jsxs("p",{className:"text-sm text-green-800",children:[t.jsx("strong",{children:"✓ Sin interés"})," - Pago al contado al precio base"]})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(c,{label:"Mora Mensual (%)",type:"number",step:"0.01",value:s.late_fee_percentage,onChange:a=>r({...s,late_fee_percentage:parseFloat(a.target.value)||0}),min:0,max:100})}),t.jsx("div",{children:t.jsx(c,{label:"Período de Gracia (días)",type:"number",value:s.grace_period_days,onChange:a=>r({...s,grace_period_days:parseInt(a.target.value)||0}),min:0})})]})]})}),t.jsx("div",{className:"bg-gray-50 px-8 py-6 rounded-b-3xl border-t-2 border-gray-200 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-6 py-3 text-gray-700 bg-white hover:bg-gray-100 border-2 border-gray-300 rounded-xl font-semibold transition-all duration-200",children:"Cancelar"}),t.jsx("button",{type:"submit",className:"px-6 py-3 rounded-xl font-semibold transition-all duration-200 shadow-sm bg-blue-600 hover:bg-blue-700 text-white",children:i?"Actualizar Plan":"Crear Plan"})]})})]})]})}),e[42]=G,e[43]=i,e[44]=s,e[45]=Z,e[46]=Y,e[47]=y):y=e[47];let O;return e[48]!==_||e[49]!==v||e[50]!==y?(O=t.jsx(he,{children:t.jsxs("div",{className:"p-6 space-y-6",children:[Q,_,v,y]})}),e[48]=_,e[49]=v,e[50]=y,e[51]=O):O=e[51],O};function Pe(){o.error("Error al eliminar plan de pago")}function Ce(n){const e=n.data;return t.jsxs("div",{className:"flex items-center py-2 h-full",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#3B82F6"},children:t.jsx(te,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.installments_count," ",e.installments_count===1?"cuota":"cuotas"," - S/ ",e.total_amount.toFixed(2)]})]})]})}function Ee(n){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800",children:n.value})})}function ke(n){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["S/ ",n.value.toFixed(2)]})})}function Fe(n){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["S/ ",n.value.toFixed(2)]})})}function Ae(n){const N=((n.data.total_amount-1800)/1800*100).toFixed(1);return t.jsx("div",{className:"flex items-center justify-center h-full",children:parseFloat(N)>0?t.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-orange-100 text-orange-800",children:["+",N,"%"]}):t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:"Sin interés"})})}function ze(n){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-sm text-gray-600",children:[n.value," meses"]})})}function Re(n){const e=n.value||0;return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${e>0?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-600"}`,children:[e," ",e===1?"estudiante":"estudiantes"]})})}function Me(n){console.error("❌ Error al cambiar estado:",n),o.error("Error al cambiar estado")}function Te(n){console.error(n),o.error("Error al actualizar plan de pago")}function De(n){console.error(n),o.error("Error al crear plan de pago")}function qe(n){return n.stopPropagation()}export{lt as default};
