import{r,j as e}from"./app-Bxyh8OL0.js";import{t as o,A as T}from"./AuthenticatedLayout-DhK1QQJ-.js";import{B as n}from"./button-DZIkm4B7.js";import{B as z}from"./badge-CJR3gome.js";import{A as P,a as F}from"./alert-CQD89lXO.js";import{T as R}from"./textarea-Bz4-4kBK.js";import{D as O,a as _,b as B,c as L,d as $}from"./dialog-C14Q7feu.js";import{L as p}from"./loader-circle-DpVwVdzv.js";import{F as q}from"./video-DQzu31qn.js";import{C as N}from"./circle-check-DeD6ovhL.js";import{U as X}from"./user-D4Yrr3Ad.js";import{C as I}from"./calendar-BhRRokpJ.js";import{C as K}from"./credit-card-flBPDk79.js";import{E}from"./eye-DiFzTBXP.js";import{C as A}from"./circle-x-BDXg8Kxt.js";import{C as U}from"./circle-alert-DMXqQEB2.js";import{f as H,p as J}from"./parseISO-5VixKeOm.js";import{e as G}from"./es-DyFI81h1.js";/* empty css            */import"./graduation-cap-D02The6k.js";import"./createLucideIcon-CaQHUElT.js";import"./settings-DzQ4O-6X.js";import"./users-CNbnt6wK.js";import"./chart-pie-CDOKF-lC.js";import"./book-open-jkftpfhm.js";import"./index-CRH1Xsgq.js";import"./utils-D0Zg16Wk.js";import"./index-hiVsCfsG.js";import"./index-BpzdfRDg.js";import"./index-BHXJgbm_.js";import"./index-B6RfrjzW.js";function De(){const[j,D]=r.useState([]),[y,b]=r.useState(!0),[t,i]=r.useState(null),[k,d]=r.useState(!1),[u,S]=r.useState("approve"),[m,f]=r.useState(""),[c,x]=r.useState(!1);r.useEffect(()=>{h()},[]);const h=async()=>{b(!0);try{const s=await fetch("/api/vouchers/pending");if(!s.ok)throw new Error("Error al cargar vouchers pendientes");const a=await s.json();D(a.data||[])}catch(s){console.error("Error loading vouchers:",s),o.error("Error al cargar vouchers pendientes")}finally{b(!1)}},V=async()=>{if(t){x(!0);try{const s=await fetch(`/api/vouchers/${t.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}});if(!s.ok){const a=await s.json();throw new Error(a.message||"Error al aprobar voucher")}o.success("Voucher aprobado exitosamente"),d(!1),i(null),h()}catch(s){console.error("Error approving voucher:",s),o.error(s instanceof Error?s.message:"Error al aprobar voucher")}finally{x(!1)}}},M=async()=>{if(!t||!m.trim()){o.error("Debes proporcionar un motivo de rechazo");return}x(!0);try{const s=await fetch(`/api/vouchers/${t.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({rejection_reason:m})});if(!s.ok){const a=await s.json();throw new Error(a.message||"Error al rechazar voucher")}o.success("Voucher rechazado"),d(!1),i(null),f(""),h()}catch(s){console.error("Error rejecting voucher:",s),o.error(s instanceof Error?s.message:"Error al rechazar voucher")}finally{x(!1)}},v=(s,a)=>{i(s),S(a),d(!0)},w=()=>{d(!1),i(null),f("")},l=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),g=s=>{try{return H(J(s),"d 'de' MMMM, yyyy",{locale:G})}catch{return s}},C=s=>({cash:"Efectivo",transfer:"Transferencia",deposit:"Depósito",card:"Tarjeta"})[s]||s;return e.jsxs(T,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Verificación de Vouchers"}),e.jsx("p",{className:"text-gray-600",children:"Revisa y aprueba los vouchers de pago de cuotas"})]}),e.jsxs(n,{onClick:h,variant:"outline",children:[e.jsx(p,{className:`w-4 h-4 mr-2 ${y?"animate-spin":""}`}),"Actualizar"]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"Vouchers Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:j.length})]}),e.jsx(q,{className:"w-8 h-8 text-blue-500"})]})})}),y?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(p,{className:"w-8 h-8 animate-spin text-primary"})}):j.length===0?e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-12 text-center",children:[e.jsx(N,{className:"w-16 h-16 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"¡Todo al día!"}),e.jsx("p",{className:"text-gray-600",children:"No hay vouchers pendientes de verificación en este momento."})]}):e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Estudiante"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Cuota"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Fecha de Pago"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-semibold text-gray-700",children:"Monto Declarado"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Método"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Subido Por"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:j.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium",children:s.installment?.enrollment?.student?.name||"N/A"})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:["Cuota ",s.installment?.installment_number]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Vence: ",s.installment?.due_date?g(s.installment.due_date):"N/A"]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3 text-gray-400"}),g(s.payment_date)]})}),e.jsxs("td",{className:"px-4 py-3 text-right",children:[e.jsx("p",{className:"text-sm font-semibold",children:l(s.declared_amount)}),s.installment?.totalDue&&s.declared_amount!==s.installment.totalDue&&e.jsxs("p",{className:"text-xs text-orange-600",children:["Esperado: ",l(s.installment.totalDue)]})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsxs(z,{variant:"outline",className:"text-xs",children:[e.jsx(K,{className:"w-3 h-3 mr-1"}),C(s.payment_method)]}),s.transaction_reference&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Op: ",s.transaction_reference]})]}),e.jsx("td",{className:"px-4 py-3 text-sm",children:s.uploadedBy?.name||"N/A"}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(n,{size:"sm",variant:"outline",onClick:()=>window.open(`/api/vouchers/${s.id}`,"_blank"),children:e.jsx(E,{className:"w-3 h-3"})}),e.jsxs(n,{size:"sm",onClick:()=>v(s,"approve"),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"Aprobar"]}),e.jsxs(n,{size:"sm",onClick:()=>v(s,"reject"),variant:"destructive",children:[e.jsx(A,{className:"w-3 h-3 mr-1"}),"Rechazar"]})]})})]},s.id))})]})})})]}),t&&e.jsx(O,{open:k,onOpenChange:w,children:e.jsxs(_,{className:"max-w-2xl",children:[e.jsx(B,{children:e.jsx(L,{children:u==="approve"?"Aprobar Voucher":"Rechazar Voucher"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Estudiante:"}),e.jsx("p",{className:"font-semibold",children:t.installment?.enrollment?.student?.name||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Cuota:"}),e.jsxs("p",{className:"font-semibold",children:["Cuota ",t.installment?.installment_number]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Monto Declarado:"}),e.jsx("p",{className:"font-semibold text-lg text-blue-600",children:l(t.declared_amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Monto a Pagar:"}),e.jsx("p",{className:"font-semibold text-lg",children:t.installment?.totalDue?l(t.installment.totalDue):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Método de Pago:"}),e.jsx("p",{className:"font-semibold",children:C(t.payment_method)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Fecha de Pago:"}),e.jsx("p",{className:"font-semibold",children:g(t.payment_date)})]})]}),t.transaction_reference&&e.jsxs("div",{className:"pt-2 border-t border-gray-200",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"N° de Operación:"}),e.jsx("p",{className:"font-semibold",children:t.transaction_reference})]})]}),t.installment?.totalDue&&t.declared_amount!==t.installment.totalDue&&e.jsxs(P,{variant:"destructive",children:[e.jsx(U,{className:"h-4 w-4"}),e.jsxs(F,{children:["El monto declarado (",l(t.declared_amount),") no coincide con el monto esperado (",l(t.installment.totalDue),")."]})]}),u==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"rejection_reason",className:"text-sm font-semibold text-gray-700",children:"Motivo del Rechazo *"}),e.jsx(R,{id:"rejection_reason",value:m,onChange:s=>f(s.target.value),placeholder:"Explica por qué se rechaza este voucher...",rows:4,required:!0})]}),e.jsxs(n,{variant:"outline",className:"w-full",onClick:()=>window.open(`/api/vouchers/${t.id}`,"_blank"),children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Ver Voucher en Nueva Pestaña"]})]}),e.jsxs($,{children:[e.jsx(n,{variant:"outline",onClick:w,disabled:c,children:"Cancelar"}),u==="approve"?e.jsx(n,{onClick:V,disabled:c,className:"bg-green-600 hover:bg-green-700",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}),"Aprobando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Confirmar Aprobación"]})}):e.jsx(n,{onClick:M,disabled:c||!m.trim(),variant:"destructive",children:c?e.jsxs(e.Fragment,{children:[e.jsx(p,{className:"w-4 h-4 mr-2 animate-spin"}),"Rechazando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Confirmar Rechazo"]})})]})]})})]})}export{De as default};
