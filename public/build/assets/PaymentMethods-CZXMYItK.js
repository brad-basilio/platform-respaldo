import{r,a as o,j as e,H as k}from"./app-DbGauczp.js";import{t}from"./DocumentConfirmationModal-CBO2LUiQ.js";import{A as _}from"./AuthenticatedLayout-CcOpJFtm.js";import{L as q}from"./loader-circle-Db594vCt.js";import{P as E}from"./plus-BRTndIVb.js";import{C as P}from"./credit-card-Brv9amPv.js";import{C as d}from"./check-Bw2tPKF6.js";import{T as $}from"./trash-2-KcsIx9MT.js";import{L as T}from"./lock-Cn0azPXH.js";import{X as H}from"./x-CaU8MqPZ.js";import{C as R}from"./circle-alert-CWcrbXkv.js";/* empty css            */import"./button-CTq9rhy_.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-uHHtlmE_.js";import"./createLucideIcon-El5PEAiD.js";import"./index-BV3GPBJK.js";import"./index-Czsmbtr5.js";import"./index-Ced-36WD.js";import"./badge-FEcguR_G.js";import"./triangle-alert-Bm1PLXca.js";import"./circle-check-big-DVBmLLUY.js";import"./clock-DUwasotU.js";const pe=()=>{const[p,A]=r.useState([]),[S,h]=r.useState(!0),[i,b]=r.useState(!1),[m,M]=r.useState(""),[u,g]=r.useState(!1),[B,f]=r.useState(!1),[j,w]=r.useState(!1),[N,y]=r.useState(!1),[L,n]=r.useState(!1),l=r.useRef(null);r.useEffect(()=>{c(),D()},[]);const D=async()=>{try{const a=await o.get("/api/student/culqi/public-key");a.data.public_key&&M(a.data.public_key)}catch(a){console.error("Error fetching Culqi public key:",a)}};r.useEffect(()=>{if(!m)return;const a=document.querySelector('script[src="https://checkout.culqi.com/js/v4"]');if(a&&window.Culqi)g(!0),v();else if(!a){const s=document.createElement("script");s.src="https://checkout.culqi.com/js/v4",s.async=!0,s.onload=()=>{g(!0),v()},s.onerror=()=>{t.error("Error al cargar el sistema de pagos")},document.head.appendChild(s)}},[m]);const v=()=>{!window.Culqi||!m||(window.Culqi.publicKey=m,window.Culqi.settings({title:"UNCED - Guardar Tarjeta",currency:"PEN",amount:0}),window.Culqi.options({lang:"es",installments:!1,paymentMethods:{tarjeta:!0,yape:!1,billetera:!1,bancaMovil:!1,agente:!1,cuotealo:!1},style:{bannerColor:"#073372",buttonBackground:"#17BC91",menuColor:"#073372",linksColor:"#17BC91",buttonText:"Guardar Tarjeta",buttonTextColor:"#ffffff",priceColor:"#073372"}}),window.culqi=()=>{try{window.Culqi.close()}catch(a){console.log("Error cerrando Culqi:",a)}f(!1),window.Culqi.token?(console.log("Token recibido:",window.Culqi.token),l.current=window.Culqi.token,n(!0)):window.Culqi.error&&(console.error("Culqi error:",window.Culqi.error),t.error(window.Culqi.error.user_message||"Error al procesar la tarjeta"))})},C=()=>{if(!window.Culqi||!u){t.error("El sistema de pagos aÃºn no estÃ¡ listo. Intenta de nuevo.");return}w(!1),y(!1),l.current=null,f(!0),window.Culqi.open()},z=async()=>{const a=l.current;if(!a){t.error("No se recibiÃ³ informaciÃ³n de la tarjeta"),n(!1);return}b(!0);try{const s=a.expiration_month?String(a.expiration_month).padStart(2,"0"):null,x=a.expiration_year?String(a.expiration_year):null;await o.post("/api/student/payment-methods",{token_id:a.id,card_brand:a.iin?.card_brand||null,card_last4:a.last_four||a.card_number?.slice(-4)||null,card_exp_month:s,card_exp_year:x,cardholder_name:a.email||null,is_default:j,auto_payment_enabled:N}),t.success("Tarjeta guardada exitosamente",{description:"Ya puedes usarla para pagar tus cuotas"}),n(!1),l.current=null,c()}catch(s){console.error("Error saving card:",s);const x=s.response?.data?.error||s.response?.data?.message||"Error al guardar la tarjeta";t.error(x)}finally{b(!1)}},c=async()=>{try{h(!0);const a=await o.get("/api/student/payment-methods");A(a.data.payment_methods||[])}catch(a){console.error("Error fetching payment methods:",a),t.error("Error al cargar los mÃ©todos de pago")}finally{h(!1)}},G=async a=>{try{await o.put(`/api/student/payment-methods/${a}`,{is_default:!0}),t.success("Tarjeta marcada como predeterminada"),c()}catch{t.error("Error al actualizar la tarjeta")}},O=async(a,s)=>{try{await o.put(`/api/student/payment-methods/${a}`,{auto_payment_enabled:!s}),t.success(s?"Pagos automÃ¡ticos deshabilitados":"Pagos automÃ¡ticos habilitados"),c()}catch{t.error("Error al actualizar configuraciÃ³n")}},F=async a=>{if(confirm("Â¿EstÃ¡s seguro de eliminar esta tarjeta?"))try{await o.delete(`/api/student/payment-methods/${a}`),t.success("Tarjeta eliminada exitosamente"),c()}catch{t.error("Error al eliminar la tarjeta")}},K=a=>({visa:"ðŸ’³",mastercard:"ðŸ’³",amex:"ðŸ’³"})[a.toLowerCase()]||"ðŸ’³";return S?e.jsxs(_,{children:[e.jsx(k,{title:"MÃ©todos de Pago"}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Cargando mÃ©todos de pago..."})]})})]}):e.jsxs(_,{children:[e.jsx(k,{title:"MÃ©todos de Pago"}),e.jsxs("div",{className:"p-8 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"MÃ©todos de Pago"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Gestiona tus tarjetas y configuraciÃ³n de pagos"})]}),e.jsx("button",{onClick:C,disabled:!u||B,className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:u?e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Agregar Tarjeta"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-5 h-5 mr-2 animate-spin"}),"Cargando..."]})})]}),p.length===0?e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200 p-12 text-center",children:[e.jsx(P,{className:"w-16 h-16 text-slate-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No tienes tarjetas guardadas"}),e.jsx("p",{className:"text-slate-600 mb-6",children:"Agrega una tarjeta para realizar pagos mÃ¡s rÃ¡pidos"}),e.jsxs("button",{onClick:C,disabled:!u,className:"inline-flex items-center px-6 py-3 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-semibold rounded-xl hover:shadow-lg transition-all disabled:opacity-50",children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"Agregar Primera Tarjeta"]})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.map(a=>e.jsxs("div",{className:`bg-gradient-to-br rounded-2xl p-6 shadow-lg text-white relative overflow-hidden ${a.cardBrand==="visa"?"from-blue-600 to-blue-800":a.cardBrand==="mastercard"?"from-orange-500 to-red-600":"from-slate-700 to-slate-900"}`,children:[e.jsxs("div",{className:"absolute inset-0 opacity-10",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-white rounded-full -mr-32 -mt-32"}),e.jsx("div",{className:"absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full -ml-24 -mb-24"})]}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsx("div",{className:"text-4xl",children:K(a.cardBrand)}),e.jsx("div",{className:"text-right",children:a.isDefault&&e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-white/20 backdrop-blur-sm",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),"Predeterminada"]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-sm text-white/70 mb-1",children:"NÃºmero de Tarjeta"}),e.jsxs("p",{className:"text-xl font-mono tracking-wider",children:["â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ ",a.cardLast4]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-white/70 mb-1",children:"Titular"}),e.jsx("p",{className:"text-sm font-medium truncate",children:a.cardholderName})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-white/70 mb-1",children:"Vence"}),e.jsxs("p",{className:"text-sm font-medium",children:[a.cardExpMonth,"/",a.cardExpYear]})]})]}),a.autoPaymentEnabled&&e.jsx("div",{className:"mb-4",children:e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 backdrop-blur-sm text-white",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),"Pagos AutomÃ¡ticos Activos"]})}),e.jsxs("div",{className:"flex items-center space-x-2 pt-4 border-t border-white/20",children:[!a.isDefault&&e.jsx("button",{onClick:()=>G(a.id),className:"flex-1 px-3 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg text-xs font-medium transition-colors",children:"Marcar como Principal"}),e.jsx("button",{onClick:()=>O(a.id,a.autoPaymentEnabled),className:"flex-1 px-3 py-2 bg-white/10 hover:bg-white/20 backdrop-blur-sm rounded-lg text-xs font-medium transition-colors",title:a.autoPaymentEnabled?"Desactivar autopago":"Activar autopago",children:a.autoPaymentEnabled?"Desactivar Autopago":"Activar Autopago"}),e.jsx("button",{onClick:()=>F(a.id),className:"p-2 bg-red-500/20 hover:bg-red-500/30 backdrop-blur-sm rounded-lg transition-colors",title:"Eliminar tarjeta",children:e.jsx($,{className:"w-4 h-4"})})]})]})]},a.id))}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-2xl p-6",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-xl",children:e.jsx(T,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-blue-900 mb-2",children:"Seguridad de tus Datos"}),e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:"Tus datos de tarjeta estÃ¡n protegidos con encriptaciÃ³n de nivel bancario. Nunca almacenamos el nÃºmero completo de tu tarjeta ni el CVV."}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2 text-green-600"}),"Los pagos son procesados de forma segura por Culqi"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2 text-green-600"}),"Puedes habilitar/deshabilitar pagos automÃ¡ticos en cualquier momento"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(d,{className:"w-4 h-4 mr-2 text-green-600"}),"Elimina tus tarjetas guardadas cuando lo desees"]})]})]})]})}),L&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Confirmar Tarjeta"}),e.jsxs("p",{className:"text-white/90 text-sm mt-1",children:[l.current?.iin?.card_brand?.toUpperCase()||"Tarjeta"," â€¢â€¢â€¢â€¢ ",l.current?.card_number?.slice(-4)||"****"]})]}),e.jsx("button",{onClick:()=>{n(!1),l.current=null},disabled:i,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg disabled:opacity-50",children:e.jsx(H,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-700 bg-green-50 py-3 px-4 rounded-lg",children:[e.jsx(T,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Tu tarjeta ha sido verificada de forma segura"})]}),e.jsxs("div",{className:"space-y-3",children:[p.length>0&&e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer group p-3 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:j,onChange:a=>w(a.target.checked),disabled:i,className:"mt-1 w-5 h-5 text-[#17BC91] border-slate-300 rounded focus:ring-[#17BC91] transition-all"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 group-hover:text-[#073372] transition-colors",children:"Marcar como predeterminada"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Esta serÃ¡ tu tarjeta principal para pagos"})]})]}),e.jsxs("label",{className:"flex items-start space-x-3 cursor-pointer group p-3 rounded-lg hover:bg-slate-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:a=>y(a.target.checked),disabled:i,className:"mt-1 w-5 h-5 text-blue-600 border-slate-300 rounded focus:ring-blue-500 transition-all"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-slate-900 group-hover:text-[#073372] transition-colors",children:"Habilitar Pagos AutomÃ¡ticos"}),e.jsx("p",{className:"text-xs text-slate-600",children:"Tus cuotas se cobrarÃ¡n automÃ¡ticamente en la fecha de vencimiento"})]})]})]}),e.jsx("div",{className:"p-4 bg-amber-50 border border-amber-200 rounded-xl",children:e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(R,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsx("p",{className:"text-sm text-amber-900",children:"Al guardar tu tarjeta, aceptas que UNCED procese tus datos de forma segura para facilitar futuros pagos."})]})})]}),e.jsxs("div",{className:"bg-slate-50 px-6 py-4 border-t border-slate-200 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{n(!1),l.current=null},disabled:i,className:"px-6 py-2.5 border-2 border-slate-300 text-slate-700 font-semibold rounded-lg hover:bg-slate-100 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:z,disabled:i,className:"px-8 py-2.5 rounded-lg font-semibold transition-all flex items-center space-x-2 bg-gradient-to-r from-[#073372] to-[#17BC91] hover:shadow-lg text-white disabled:opacity-50",children:i?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Guardando..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{children:"Guardar Tarjeta"})]})})]})]})})]})]})};export{pe as default};
