import{r as x,a as g,j as e}from"./app-Bl_RjgHS.js";import{t as n,A as f}from"./AuthenticatedLayout-D5IC8XT8.js";import{C as i}from"./circle-alert-1993Datb.js";import{D as G}from"./dollar-sign-CLH6XTWf.js";import{c as A}from"./createLucideIcon-DiS8mJ-D.js";import{C as D}from"./circle-check-big-CRg8a-hE.js";import{C as j}from"./clock-BysRlyLm.js";import{F as P}from"./video-Bjq2HmP6.js";import{C as O}from"./calendar-8_fvVunP.js";import{U}from"./upload-DLqzTt2f.js";import{D as R}from"./download-D6TtfOu0.js";/* empty css            */import"./button-CNIvniKO.js";import"./dropdown-menu-BcgbCA2r.js";import"./index-ubPrUiKJ.js";import"./index-CyXhfVNl.js";import"./badge-Ddd5e77Q.js";import"./graduation-cap-CE-TQzLf.js";import"./users-B-lAZpOl.js";import"./credit-card-DA7Bt271.js";import"./book-open-OIoOA8Zt.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]],$=A("TrendingUp",z),ie=()=>{const[o,C]=x.useState(null),[F,N]=x.useState(!0),[p,c]=x.useState(null);x.useEffect(()=>{u()},[]);const u=async()=>{try{N(!0);const t=(await g.get("/api/student/enrollment")).data.enrollment,a=t.paymentPlan.gracePeriodDays||0;t.installments=t.installments.map(r=>{const l=new Date,m=new Date(l.getFullYear(),l.getMonth(),l.getDate());console.log("üïê Fecha del sistema:",l.toString()),console.log("üïê Fecha local procesada:",m.toString()),console.log("üïê Fecha ISO:",l.toISOString());const[L,V,M]=r.dueDate.split("-").map(Number),y=new Date(L,V-1,M),k=y.getTime()-m.getTime(),v=Math.round(k/(1e3*60*60*24)),b=new Date(y);b.setDate(b.getDate()+a);const w=Math.round((b.getTime()-m.getTime())/(1e3*60*60*24));return console.log("üìÖ Cuota #"+r.installmentNumber+":",{hoyLocal:m.toISOString().split("T")[0],fechaVencimiento:r.dueDate,diffDays:v,gracePeriodDays:a,daysUntilGraceLimit:w}),{...r,daysUntilDue:v,daysUntilGraceLimit:w,gracePeriodDays:a}}),C(t)}catch(s){console.error("Error fetching enrollment:",s),n.error("Error al cargar informaci√≥n de pagos",{description:s.response?.data?.message||"No se pudo obtener tu cronograma de pagos"})}finally{N(!1)}},S=async(s,t)=>{try{c(s);const a=new FormData;a.append("voucher_file",t),a.append("installment_id",s),a.append("declared_amount",String(o?.installments.find(r=>r.id===s)?.amount||0)),a.append("payment_date",new Date().toISOString().split("T")[0]),a.append("payment_method","transfer"),await g.post("/api/student/upload-voucher",a,{headers:{"Content-Type":"multipart/form-data"}}),n.success("Voucher subido exitosamente",{description:"Tu comprobante est√° siendo verificado por el cajero"}),await u()}catch(a){console.error("Error uploading voucher:",a),n.error("Error al subir voucher",{description:a.response?.data?.message||"No se pudo subir el comprobante"})}finally{c(null)}},E=async(s,t,a)=>{try{c(t);const r=new FormData;r.append("voucher_file",a),r.append("declared_amount",String(o?.installments.find(l=>l.id===t)?.amount||0)),r.append("payment_date",new Date().toISOString().split("T")[0]),r.append("payment_method","transfer"),await g.post(`/api/student/vouchers/${s}/replace`,r,{headers:{"Content-Type":"multipart/form-data"}}),n.success("Voucher reemplazado exitosamente",{description:"El nuevo comprobante est√° siendo verificado"}),await u()}catch(r){console.error("Error replacing voucher:",r),n.error("Error al reemplazar voucher",{description:r.response?.data?.message||"No se pudo reemplazar el comprobante"})}finally{c(null)}},T=s=>{if(s.status==="verified")return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Verificado"]});if(s.status==="paid")return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"En Verificaci√≥n"]});const t=s.daysUntilDue||0,a=s.daysUntilGraceLimit||0,r=s.gracePeriodDays||0;return t<0&&a>=0&&r>0?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800",children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),"Per√≠odo de Gracia (",a," d√≠as restantes)"]}):s.isOverdue||a<0&&s.status==="pending"?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),"Vencido con Mora (",Math.abs(a)," d√≠as)"]}):e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),"Pendiente (",t>0?`${t} d√≠as`:"Vence hoy",")"]})},d=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),h=s=>new Date(s).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric"});return F?e.jsx(f,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Cargando informaci√≥n de pagos..."})]})})}):o?e.jsx(f,{children:e.jsxs("div",{className:"p-8 max-w-7xl mx-auto space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Control de Pagos"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Gestiona tus cuotas y comprobantes de pago"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(G,{className:"w-8 h-8 opacity-80"}),e.jsx($,{className:"w-5 h-5 opacity-60"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Total a Pagar"}),e.jsx("p",{className:"text-2xl font-bold",children:d(o.paymentPlan.totalAmount)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(D,{className:"w-8 h-8 text-green-600"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Pagado"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:d(o.totalPaid)}),e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[o.paymentProgress.toFixed(0),"% completado"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(j,{className:"w-8 h-8 text-orange-600"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Pendiente"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:d(o.totalPending)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(P,{className:"w-8 h-8 text-violet-600"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Plan de Pago"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900",children:[o.paymentPlan.installmentsCount," cuotas"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:o.paymentPlan.name})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Progreso de Pagos"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[o.paymentProgress.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 h-3 rounded-full transition-all duration-500",style:{width:`${o.paymentProgress}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Cronograma de Cuotas"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Administra tus pagos mensuales y sube tus comprobantes"})]}),e.jsx("div",{className:"divide-y divide-slate-200",children:o.installments.map(s=>e.jsxs("div",{className:"p-6 hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Cuota #",s.installmentNumber]}),T(s)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Fecha de Vencimiento"}),e.jsxs("p",{className:"font-medium text-slate-900 flex items-center",children:[e.jsx(O,{className:"w-4 h-4 mr-1 text-blue-600"}),h(s.dueDate)]}),s.daysUntilDue!==void 0&&s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`text-xs mt-1 ${s.daysUntilDue<7&&s.daysUntilDue>=0?"text-orange-600 font-semibold":s.daysUntilDue<0?"text-red-600":"text-slate-500"}`,children:s.daysUntilDue>0?`Faltan ${s.daysUntilDue} d√≠as`:s.daysUntilDue===0?"¬°Vence hoy!":`Vencido hace ${Math.abs(s.daysUntilDue)} d√≠as`}),s.daysUntilDue<0&&s.daysUntilGraceLimit!==void 0&&s.daysUntilGraceLimit>=0&&s.gracePeriodDays&&s.gracePeriodDays>0&&e.jsxs("p",{className:"text-xs mt-1 text-orange-600 font-semibold bg-orange-50 px-2 py-1 rounded inline-block",children:["‚ö†Ô∏è Per√≠odo de gracia: ",s.daysUntilGraceLimit," d√≠as restantes"]}),s.daysUntilGraceLimit!==void 0&&s.daysUntilGraceLimit<0&&e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("p",{className:"text-xs text-red-600 font-bold bg-red-50 px-2 py-1 rounded inline-block",children:["üö® Mora aplicada (",Math.abs(s.daysUntilGraceLimit)," d√≠as)"]}),s.lateFee>0&&e.jsxs("p",{className:"text-xs text-red-700 font-bold bg-red-100 px-2 py-1 rounded inline-block",children:["üí∞ Recargo por mora: ",d(s.lateFee)]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Monto"}),e.jsx("p",{className:"font-bold text-slate-900",children:d(s.amount)}),s.lateFee>0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 font-semibold",children:["+ ",d(s.lateFee)," mora"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Total a Pagar"}),e.jsx("p",{className:"font-bold text-blue-600",children:d(s.totalDue)}),s.lateFee>0&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"(Incluye mora)"})]}),s.paidDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Fecha de Pago"}),e.jsx("p",{className:"font-medium text-green-600",children:h(s.paidDate)})]})]})]})}),s.vouchers.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Comprobantes Subidos:"}),s.vouchers.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(P,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:d(t.declaredAmount)}),e.jsxs("p",{className:"text-xs text-slate-500",children:[h(t.paymentDate)," ¬∑ ",t.paymentMethod]}),t.status==="rejected"&&t.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 italic",children:["Motivo: ",t.rejectionReason]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.status==="approved"&&e.jsx("span",{className:"text-xs px-3 py-1 bg-green-100 text-green-800 rounded-full font-medium",children:"‚úì Aprobado"}),t.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-medium animate-pulse",children:"‚è≥ En revisi√≥n"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:a=>{const r=a.target.files?.[0];r&&E(t.id,s.id,r)},disabled:p===s.id,className:"hidden"}),e.jsxs("div",{className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center space-x-1",children:[e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{children:"Reemplazar"})]})]})]}),t.status==="rejected"&&e.jsx("span",{className:"text-xs px-3 py-1 bg-red-100 text-red-800 rounded-full font-medium",children:"‚úó Rechazado"}),e.jsx("a",{href:t.voucherUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Descargar voucher",children:e.jsx(R,{className:"w-4 h-4 text-blue-600"})})]})]},t.id))]}),(s.status==="pending"||s.status==="late"||s.isOverdue)&&(!s.vouchers.length||s.vouchers.every(t=>t.status==="rejected"))&&e.jsxs("div",{className:"mt-4",children:[s.vouchers.some(t=>t.status==="rejected")&&e.jsx("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 font-medium flex items-center",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Tu voucher anterior fue rechazado. Por favor, sube un nuevo comprobante v√°lido."]})}),s.lateFee>0&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-orange-800 font-bold flex items-center",children:[e.jsx(i,{className:"w-4 h-4 mr-2"}),"Esta cuota tiene mora. Debes pagar el total: ",d(s.totalDue)]}),e.jsxs("p",{className:"text-xs text-orange-700 mt-1",children:["Monto original: ",d(s.amount)," + Mora: ",d(s.lateFee)]})]}),e.jsxs("label",{className:"block",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:t=>{const a=t.target.files?.[0];a&&S(s.id,a)},disabled:p===s.id,className:"hidden"}),e.jsx("div",{className:"flex items-center justify-center px-4 py-3 border-2 border-dashed border-slate-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 cursor-pointer transition-all",children:p===s.id?e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Subiendo..."})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-slate-600",children:[e.jsx(U,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:s.vouchers.some(t=>t.status==="rejected")?"Subir Nuevo Comprobante":"Subir Comprobante de Pago"})]})})]})]})]},s.id))})]})]})}):e.jsx(f,{children:e.jsx("div",{className:"p-8 max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-6 text-center",children:[e.jsx(i,{className:"w-12 h-12 text-yellow-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No tienes matr√≠cula activa"}),e.jsx("p",{className:"text-slate-600",children:"Contacta con el √°rea de admisiones para m√°s informaci√≥n."})]})})})};export{ie as default};
