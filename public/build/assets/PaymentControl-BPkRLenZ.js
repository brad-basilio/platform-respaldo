import{r as i,j as e,a as F}from"./app-CYOTHieD.js";import{A as B}from"./AuthenticatedLayout-WkZe10rA.js";import{A,t as R,M as T,a as D}from"./ag-grid-custom-CEIpcEiT.js";import{S as b}from"./sweetalert2.esm.all-NNS-RXd7.js";import{I as M}from"./input-DfKpObuK.js";import{C}from"./clock-BkESBG-B.js";import{E as $}from"./eye-DfgV6eO8.js";import{U as E}from"./users-DrJIUr_I.js";import{C as N}from"./circle-alert-xyV01Pfp.js";import{C as u}from"./circle-check-big-BePMCcpY.js";import{S as z}from"./search-DbPDDk5o.js";import{C as P}from"./circle-x-DsOg0Ebq.js";import{F as q}from"./video-ByaLj_aO.js";import{D as I}from"./dollar-sign-B-K8_4zU.js";import{C as L}from"./calendar-DgGrQw4H.js";import{D as U}from"./download-whR9dXDf.js";/* empty css            */import"./graduation-cap-CMPY-iVt.js";import"./createLucideIcon-B7vbpu5k.js";import"./settings-BmNrsN2X.js";import"./credit-card-vEuapQyv.js";import"./chart-pie-DGxbwwQq.js";import"./book-open-JJG70YtR.js";import"./award-p91ygj1v.js";import"./user-check-DYEvbguf.js";import"./index-CKUYwlSa.js";import"./utils-D0Zg16Wk.js";T.registerModules([D]);const G=({student:p,enrollment:l,onClose:n,onVerifyInstallment:f})=>{const[g,m]=i.useState(null),x=async r=>{m(r);try{await f(r)}finally{m(null)}},j=r=>{switch(r.status){case"verified":return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Verificado"]});case"paid":return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 animate-pulse",children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),"Pendiente VerificaciÃ³n"]});case"overdue":return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Vencido"]});default:return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"Pendiente"]})}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-600 to-teal-600 px-8 py-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Cronograma de Pagos"}),e.jsxs("p",{className:"text-emerald-100 text-sm",children:[p.name," - ",p.enrollmentCode]})]}),e.jsx("button",{onClick:n,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:e.jsx(P,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"p-8 overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 font-semibold uppercase",children:"Total Plan"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900 mt-1",children:["S/ ",((l.enrollment_fee||0)+(l.totalPending||0)+(l.totalPaid||0)).toFixed(2)]})]}),e.jsx(q,{className:"h-8 w-8 text-blue-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl p-4 border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600 font-semibold uppercase",children:"Pagado"}),e.jsxs("p",{className:"text-2xl font-bold text-green-900 mt-1",children:["S/ ",((l.enrollment_fee||0)+(l.totalPaid||0)).toFixed(2)]})]}),e.jsx(u,{className:"h-8 w-8 text-green-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-xl p-4 border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-yellow-600 font-semibold uppercase",children:"Pendiente"}),e.jsxs("p",{className:"text-2xl font-bold text-yellow-900 mt-1",children:["S/ ",(l.totalPending||0).toFixed(2)]})]}),e.jsx(N,{className:"h-8 w-8 text-yellow-600 opacity-50"})]})}),e.jsx("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl p-4 border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-purple-600 font-semibold uppercase",children:"Progreso"}),e.jsxs("p",{className:"text-2xl font-bold text-purple-900 mt-1",children:[(l.paymentProgress||0).toFixed(2),"%"]})]}),e.jsx(I,{className:"h-8 w-8 text-purple-600 opacity-50"})]})})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-4 border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Cuotas del Plan"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Cuota"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fecha Vencimiento"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Monto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Pagado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Estado"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Voucher"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:l.installments&&l.installments.length>0?l.installments.map(r=>{const o=r.installment_number||r.installmentNumber||0,w=r.due_date||r.dueDate||"",v=r.paid_amount||r.paidAmount||0,y=r.verifiedBy||r.verified_by,d=r.vouchers||[];return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold text-sm",children:o})}),e.jsxs("span",{className:"ml-3 text-sm font-medium text-gray-900",children:["Cuota ",o]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-900",children:[e.jsx(L,{className:"w-4 h-4 mr-2 text-gray-400"}),new Date(w).toLocaleDateString("es-PE",{year:"numeric",month:"short",day:"numeric"})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["S/ ",r.amount.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:"text-sm font-semibold text-green-600",children:["S/ ",v.toFixed(2)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:j(r)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:d&&d.length>0?e.jsxs("a",{href:d[0].voucher_url||d[0].voucherUrl||"#",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-sm text-blue-600 hover:text-blue-800",children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Ver Voucher"]}):e.jsx("span",{className:"text-sm text-gray-400",children:"Sin voucher"})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.status==="paid"&&e.jsx("button",{onClick:()=>x(r.id),disabled:g===r.id,className:"inline-flex items-center px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:g===r.id?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Verificando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(u,{className:"w-4 h-4 mr-1"}),"Verificar"]})}),r.status==="verified"&&y&&e.jsxs("div",{className:"text-xs text-gray-500",children:[e.jsx("div",{children:"Verificado por:"}),e.jsx("div",{className:"font-medium text-gray-700",children:y.name})]})]})]},r.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-8 text-center text-gray-500",children:"No hay cuotas registradas"})})})]})})]})]}),e.jsx("div",{className:"bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-end",children:e.jsx("button",{onClick:n,className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2.5 rounded-xl font-medium transition-colors",children:"Cerrar"})})]})})},ge=({students:p=[]})=>{const[l]=i.useState(p??[]),[n,f]=i.useState(null),[g,m]=i.useState(!1),[x,j]=i.useState(""),[r,o]=i.useState("all"),w=async t=>{try{console.log("ðŸ“‹ Abriendo cronograma para estudiante:",t.id,t.name);const s=await F.get(`/cashier/students/${t.id}/enrollment`);if(console.log("âœ… Respuesta del servidor:",s.data),s.data.success)f({...t,enrollment:s.data.enrollment}),m(!0);else throw new Error(s.data.message||"No se pudo cargar el cronograma")}catch(s){console.error("âŒ Error al cargar cronograma:",s),console.error("Error response:",s.response?.data),await b.fire({title:"Error",text:s.response?.data?.message||"No se pudo cargar el cronograma de pagos",icon:"error",confirmButtonColor:"#ef4444"})}},v=async t=>{if((await b.fire({title:"Â¿Verificar Pago?",html:`
        <div class="text-left">
          <p class="text-gray-700 mb-3">Â¿Confirmas que el voucher de pago es vÃ¡lido?</p>
          <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
            <p class="text-sm text-blue-800">
              <strong>Importante:</strong> Al verificar este pago:
            </p>
            <ul class="text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside">
              <li>Se marcarÃ¡ como cuota verificada</li>
              <li>Se actualizarÃ¡ el progreso del estudiante</li>
              <li>Se registrarÃ¡ tu nombre como verificador</li>
            </ul>
          </div>
        </div>
      `,icon:"question",showCancelButton:!0,confirmButtonColor:"#10b981",cancelButtonColor:"#6b7280",confirmButtonText:"SÃ­, Verificar",cancelButtonText:"Cancelar",reverseButtons:!0})).isConfirmed)try{const a=await F.post(`/cashier/installments/${t}/verify`);if(a.data.success){if(n?.enrollment){const c=n.enrollment.installments?.map(k=>k.id===t?a.data.installment:k);f({...n,enrollment:{...n.enrollment,installments:c,totalPaid:a.data.enrollment.totalPaid,totalPending:a.data.enrollment.totalPending,paymentProgress:a.data.enrollment.paymentProgress}})}await b.fire({title:"Â¡Verificado!",text:"El pago ha sido verificado exitosamente",icon:"success",confirmButtonColor:"#10b981",timer:2e3,timerProgressBar:!0})}}catch(a){console.error("Error al verificar pago:",a),await b.fire({title:"Error",text:"No se pudo verificar el pago",icon:"error",confirmButtonColor:"#ef4444"})}},y=i.useMemo(()=>{let t=l.filter(s=>s.enrollmentVerified);return r==="pending"?t=t.filter(s=>s.enrollment&&(s.enrollment.paymentProgress||0)<100):r==="completed"&&(t=t.filter(s=>s.enrollment&&s.enrollment.paymentProgress===100)),t},[l,r]),d=i.useMemo(()=>[{headerName:"Estudiante",field:"name",minWidth:300,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.data;return e.jsxs("div",{className:"flex items-center py-2 w-full h-full",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-emerald-500 to-teal-600 rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-sm font-semibold",children:s.name.split(" ").map(a=>a[0]).join("")})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email})]})]})}},{headerName:"CÃ³digo",field:"enrollmentCode",width:150,filter:"agTextColumnFilter",cellRenderer:t=>e.jsx("div",{className:"flex items-center h-full",children:e.jsx("span",{className:"text-sm font-mono text-gray-900",children:t.value})})},{headerName:"Plan",width:200,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.data;return e.jsx("div",{className:"flex items-center h-full",children:e.jsx("span",{className:"text-sm text-gray-900",children:s.paymentPlan?.name||s.enrollment?.paymentPlan?.name||"Sin plan"})})}},{headerName:"Progreso de Pagos",width:250,cellRenderer:t=>{const s=t.data,a=s.enrollment?.paymentProgress||0;return e.jsxs("div",{className:"flex flex-col justify-center h-full space-y-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-600",children:[a.toFixed(0),"% completado"]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["S/ ",((s.enrollment?.totalPaid||0)+(s.enrollment?.enrollment_fee||0)).toFixed(2)]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all ${a===100?"bg-green-500":a>=50?"bg-blue-500":"bg-yellow-500"}`,style:{width:`${a}%`}})})]})}},{headerName:"Pendientes Pago",width:140,cellRenderer:t=>{const a=t.data.enrollment?.installments?.filter(c=>c.status==="pending"||c.status==="overdue").length||0;return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${a===0?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"}`,children:[a," ",a===1?"cuota":"cuotas"]})})}},{headerName:"Por Verificar",width:140,cellRenderer:t=>{const a=t.data.enrollment?.installments?.filter(c=>c.status==="paid").length||0;return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${a===0?"bg-gray-100 text-gray-600":"bg-blue-100 text-blue-800 animate-pulse"}`,children:[e.jsx(C,{className:"w-3 h-3 mr-1"}),a," ",a===1?"voucher":"vouchers"]})})}},{headerName:"Acciones",width:120,sortable:!1,filter:!1,cellRenderer:t=>{const s=t.data;return e.jsx("div",{className:"flex items-center justify-center space-x-2 h-full",children:e.jsxs("button",{onClick:()=>w(s),className:"inline-flex items-center px-3 py-1.5 bg-emerald-600 hover:bg-emerald-700 text-white text-sm font-medium rounded-lg transition-colors",title:"Ver cronograma",children:[e.jsx($,{className:"h-4 w-4 mr-1"}),"Cronograma"]})})}}],[]),h=l.filter(t=>t.enrollmentVerified),S=h.filter(t=>t.enrollment&&(t.enrollment.paymentProgress||0)<100),V=h.filter(t=>t.enrollment&&t.enrollment.paymentProgress===100);return e.jsxs(B,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Control de Pagos"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona y verifica los pagos de estudiantes matriculados"})]}),e.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-600 text-white px-6 py-3 rounded-xl shadow-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold",children:h.length}),e.jsx("div",{className:"text-sm opacity-90",children:"Estudiantes"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Total Estudiantes"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:h.length})]}),e.jsx(E,{className:"h-10 w-10 text-emerald-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Pagos Pendientes"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 mt-1",children:S.length})]}),e.jsx(N,{className:"h-10 w-10 text-yellow-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Pagos Completos"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-1",children:V.length})]}),e.jsx(u,{className:"h-10 w-10 text-green-600"})]})}),e.jsx("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"Por Verificar"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:l.reduce((t,s)=>t+(s.enrollment?.installments?.filter(a=>a.status==="paid").length||0),0)})]}),e.jsx(C,{className:"h-10 w-10 text-blue-600"})]})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(M,{type:"text",label:"Buscar por nombre, email, cÃ³digo, plan...",value:x,onChange:t=>j(t.target.value),icon:e.jsx(z,{className:"w-4 h-4"}),className:"pr-10"}),x&&e.jsx("button",{onClick:()=>j(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:e.jsx(P,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-1 inline-flex",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>o("all"),className:`px-6 py-3 rounded-lg font-medium transition-all ${r==="all"?"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(E,{className:"h-4 w-4"}),e.jsx("span",{children:"Todos"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:h.length})]})}),e.jsx("button",{onClick:()=>o("pending"),className:`px-6 py-3 rounded-lg font-medium transition-all ${r==="pending"?"bg-gradient-to-r from-yellow-500 to-orange-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(N,{className:"h-4 w-4"}),e.jsx("span",{children:"Con Pagos Pendientes"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:S.length})]})}),e.jsx("button",{onClick:()=>o("completed"),className:`px-6 py-3 rounded-lg font-medium transition-all ${r==="completed"?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(u,{className:"h-4 w-4"}),e.jsx("span",{children:"Pagos Completos"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:V.length})]})})]})}),e.jsx("div",{className:"ag-theme-quartz",style:{height:"600px",width:"100%"},children:e.jsx(A,{theme:R,rowData:y,columnDefs:d,quickFilterText:x,defaultColDef:{sortable:!0,filter:!0,resizable:!0,flex:1,minWidth:100},pagination:!0,paginationPageSize:10,paginationPageSizeSelector:[10,20,50,100],rowSelection:{mode:"singleRow"},animateRows:!0,domLayout:"normal",rowHeight:70,headerHeight:48,suppressCellFocus:!0,rowClass:"hover:bg-gray-50"})})]}),g&&n&&n.enrollment&&e.jsx(G,{student:n,enrollment:n.enrollment,onClose:()=>m(!1),onVerifyInstallment:v})]})};export{ge as default};
