import{c as de,r as j,U as me,j as t,a as ue,b as V}from"./app-zpXMIoUn.js";import{t as o,C as pe,A as he}from"./AuthenticatedLayout-TfChqMWe.js";import{I as c}from"./input-Dr7Mj_Ly.js";import{B as xe}from"./button-BxcqdOSQ.js";import{S as fe}from"./switch-CtSYnngu.js";import{T as _e}from"./textarea-CIfG14kS.js";import{M as ge,a as ve,A as ye,t as be}from"./index.esm-DBApmx5E.js";/* empty css                       */import{C as te}from"./credit-card-W6zbpbwc.js";import{S as je}from"./square-pen-aw-KIggg.js";import{T as Ne}from"./trash-2-C1IoiWgP.js";import{P as we}from"./plus-CqvzMClV.js";import{S as Se}from"./search-CNxhi7Sw.js";/* empty css            */import"./dropdown-menu-BarZ9bm-.js";import"./createLucideIcon-VLvOGG_6.js";import"./index-Cnj8kRy9.js";import"./index-7KTMkzZ9.js";import"./index-s2wWA58c.js";import"./badge-ubGZJW5Q.js";import"./x-bnMbtnbo.js";import"./triangle-alert-Cz9QSMLd.js";import"./circle-check-big-CqClQ5nE.js";import"./clock-DA0Pfxqg.js";import"./clsx-B-dksMZM.js";import"./index-Vec50618.js";ge.registerModules([ve]);const dt=l=>{const e=de.c(52),{paymentPlans:N}=l,[u,re]=j.useState(N),[Y,d]=j.useState(!1),[i,ae]=j.useState(null),[m,se]=j.useState("");let w;e[0]===Symbol.for("react.memo_cache_sentinel")?(w={name:"",academic_level_id:void 0,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""},e[0]=w):w=e[0];const[s,n]=j.useState(w);let S;e[1]===Symbol.for("react.memo_cache_sentinel")?(S=async()=>{try{const r=(await ue.get("/api/admin/payment-plans")).data;Array.isArray(r)&&(re(r),console.log("✅ Planes de pago actualizados desde el servidor:",r.length,"planes"))}catch(a){console.error("❌ Error fetching payment plans:",a),o.error("Error al obtener planes de pago",{description:"No se pudo sincronizar con el servidor.",duration:5e3})}},e[1]=S):S=e[1];const p=S;let C,P;e[2]===Symbol.for("react.memo_cache_sentinel")?(C=()=>{p()},P=[p],e[2]=C,e[3]=P):(C=e[2],P=e[3]),me.useEffect(C,P);let E;e[4]===Symbol.for("react.memo_cache_sentinel")?(E=a=>{ae(a),n({name:a.name,academic_level_id:a.academic_level_id,installments_count:a.installments_count,monthly_amount:a.monthly_amount,total_amount:a.total_amount,discount_percentage:a.discount_percentage,duration_months:a.duration_months,late_fee_percentage:a.late_fee_percentage,grace_period_days:a.grace_period_days,is_active:a.is_active,description:a.description||""}),d(!0)},e[4]=E):E=e[4];const le=E;let F;e[5]===Symbol.for("react.memo_cache_sentinel")?(F=a=>{confirm(`¿Estás seguro de eliminar el plan "${a.name}"?`)&&V.delete(`/admin/payment-plans/${a.id}`,{preserveScroll:!0,onSuccess:async()=>{o.success("Plan de pago eliminado exitosamente"),await p()},onError:Ce})},e[5]=F):F=e[5];const ne=F;let k,A,B,z,R,M,T;e[6]===Symbol.for("react.memo_cache_sentinel")?(R={headerName:"Plan de Pago",field:"name",flex:1,minWidth:250,filter:"agTextColumnFilter",cellRenderer:Pe},M={headerName:"Cuotas",field:"installments_count",width:100,cellRenderer:Ee},T={headerName:"Mensualidad",field:"monthly_amount",width:140,cellRenderer:Fe},k={headerName:"Total",field:"total_amount",width:140,cellRenderer:ke},A={headerName:"Interés",field:"discount_percentage",width:120,cellRenderer:Ae},B={headerName:"Duración",field:"duration_months",width:110,cellRenderer:Be},z={headerName:"Aprendices",field:"students_count",width:130,cellRenderer:ze},e[6]=k,e[7]=A,e[8]=B,e[9]=z,e[10]=R,e[11]=M,e[12]=T):(k=e[6],A=e[7],B=e[8],z=e[9],R=e[10],M=e[11],T=e[12]);let D;e[13]===Symbol.for("react.memo_cache_sentinel")?(D={headerName:"Estado",field:"is_active",width:120,cellRenderer:a=>{const r=a.data,b=a.value,ce=async ee=>{if(!r||!r.id){o.error("Error",{description:"No se pudo identificar el plan de pago",duration:3e3});return}V.put(`/admin/payment-plans/${r.id}`,{name:r.name,academic_level_id:r.academic_level_id,installments_count:r.installments_count,monthly_amount:r.monthly_amount,total_amount:r.total_amount,discount_percentage:r.discount_percentage,duration_months:r.duration_months,late_fee_percentage:r.late_fee_percentage,grace_period_days:r.grace_period_days,is_active:ee,description:r.description},{preserveScroll:!0,onSuccess:async()=>{await p(),o.success(ee?"Plan activado":"Plan desactivado",{description:`El plan "${r.name}" ha sido ${ee?"activado":"desactivado"}`,duration:3e3})},onError:Re})};return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(fe,{checked:b,onCheckedChange:ce})})}},e[13]=D):D=e[13];let q;e[14]===Symbol.for("react.memo_cache_sentinel")?(q=[R,M,T,k,A,B,z,D,{headerName:"Acciones",width:120,sortable:!1,filter:!1,cellRenderer:a=>{const r=a.data;return t.jsxs("div",{className:"flex items-center justify-center space-x-2 h-full",children:[t.jsx("button",{onClick:()=>le(r),className:"text-[#073372] hover:text-[#17BC91] p-1 hover:bg-[#17BC91]/10 rounded transition-colors",title:"Editar plan",children:t.jsx(je,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>ne(r),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded transition-colors",title:"Eliminar plan",children:t.jsx(Ne,{className:"h-4 w-4"})})]})}}],e[14]=q):q=e[14];const oe=q;let I;e[15]===Symbol.for("react.memo_cache_sentinel")?(I=()=>{ae(null),n({name:"",academic_level_id:void 0,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""}),d(!0)},e[15]=I):I=e[15];const ie=I;let $;e[16]!==i||e[17]!==s?($=a=>{a.preventDefault();const{academic_level:r,...b}=s;i?V.put(`/admin/payment-plans/${i.id}`,b,{preserveScroll:!0,onSuccess:async()=>{o.success("Plan de pago actualizado exitosamente"),d(!1),await p()},onError:Me}):V.post("/admin/payment-plans",b,{preserveScroll:!0,onSuccess:async()=>{o.success("Plan de pago creado exitosamente"),d(!1),await p()},onError:Te})},e[16]=i,e[17]=s,e[18]=$):$=e[18];const Z=$;let L;e[19]!==s?(L=()=>{const a=s.monthly_amount||0,r=s.installments_count||1,b=a*r;n({...s,total_amount:Math.round(b*100)/100})},e[19]=s,e[20]=L):L=e[20];const G=L;let H;e[21]===Symbol.for("react.memo_cache_sentinel")?(H=t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(te,{className:"w-7 h-7 text-[#073372]"}),"Planes de Pago"]}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Configura los planes de pago disponibles para el curso"})]}),e[21]=H):H=e[21];let Q;e[22]===Symbol.for("react.memo_cache_sentinel")?(Q=t.jsxs("div",{className:"flex items-center justify-between",children:[H,t.jsxs(xe,{onClick:ie,className:"flex items-center gap-2",children:[t.jsx(we,{className:"w-4 h-4"}),"Nuevo Plan"]})]}),e[22]=Q):Q=e[22];let W,U;e[23]===Symbol.for("react.memo_cache_sentinel")?(W=a=>se(a.target.value),U=t.jsx(Se,{className:"w-4 h-4"}),e[23]=W,e[24]=U):(W=e[23],U=e[24]);let h,x;e[25]!==m?(h=t.jsx(c,{type:"text",label:"Buscar por nombre, descripción...",value:m,onChange:W,icon:U,className:"pr-10"}),x=m&&t.jsx("button",{onClick:()=>se(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:t.jsx(pe,{className:"w-5 h-5"})}),e[25]=m,e[26]=h,e[27]=x):(h=e[26],x=e[27]);let f;e[28]!==h||e[29]!==x?(f=t.jsxs("div",{className:"relative",children:[h,x]}),e[28]=h,e[29]=x,e[30]=f):f=e[30];let X;e[31]===Symbol.for("react.memo_cache_sentinel")?(X={height:"calc(100vh - 350px)",width:"100%"},e[31]=X):X=e[31];let J;e[32]===Symbol.for("react.memo_cache_sentinel")?(J={sortable:!0,resizable:!0},e[32]=J):J=e[32];let K;e[33]===Symbol.for("react.memo_cache_sentinel")?(K=[10,20,50,100],e[33]=K):K=e[33];let _;e[34]!==u||e[35]!==m?(_=t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:t.jsx("div",{className:"ag-theme-quartz",style:X,children:t.jsx(ye,{rowData:u,columnDefs:oe,quickFilterText:m,defaultColDef:J,pagination:!0,paginationPageSize:20,paginationPageSizeSelector:K,animateRows:!0,rowHeight:70,headerHeight:50,theme:be})})}),e[34]=u,e[35]=m,e[36]=_):_=e[36];let g;e[37]!==f||e[38]!==_?(g=t.jsxs("div",{className:"space-y-4",children:[f,_]}),e[37]=f,e[38]=_,e[39]=g):g=e[39];let v;e[40]!==u.length?(v=u.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(te,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 text-lg",children:"No hay planes de pago registrados"}),t.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Crea el primer plan para comenzar"})]}),e[40]=u.length,e[41]=v):v=e[41];let y;e[42]!==G||e[43]!==i||e[44]!==s||e[45]!==Z||e[46]!==Y?(y=Y&&t.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/75 backdrop-blur-sm animate-fade-in flex items-center justify-center p-4",onClick:()=>d(!1),style:{height:"100vh",width:"100vw"},children:t.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col animate-scale-in",onClick:De,children:[t.jsx("div",{className:"relative bg-gradient-to-r from-[#073372] to-[#17BC91] px-8 py-6 rounded-t-3xl flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:i?"Editar Plan de Pago":"Nuevo Plan de Pago"}),t.jsx("p",{className:"text-blue-100",children:i?"Actualiza la información del plan":"Completa la información para crear un nuevo plan"})]}),t.jsx("button",{type:"button",onClick:()=>d(!1),className:"text-white/80 hover:text-white hover:bg-white/10 rounded-full p-2 transition-all duration-200",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),t.jsxs("form",{onSubmit:Z,className:"flex flex-col flex-1 overflow-hidden",children:[t.jsx("div",{className:"p-8 space-y-6 overflow-y-auto flex-1",children:t.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[t.jsx(c,{label:"Nombre del Plan",value:s.name,onChange:a=>n({...s,name:a.target.value}),placeholder:"Ej: Plan Premium, Plan Estándar",required:!0}),t.jsx("input",{type:"hidden",name:"academic_level_id",value:s.academic_level_id||""}),t.jsx(_e,{label:"Descripción",value:s.description,onChange:a=>n({...s,description:a.target.value}),placeholder:"Descripción opcional del plan",rows:2}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(c,{label:"Número de Cuotas",type:"number",value:s.installments_count,onChange:a=>n({...s,installments_count:parseInt(a.target.value)||1}),onBlur:G,min:1,max:12,required:!0})}),t.jsx("div",{children:t.jsx(c,{label:"Duración (meses)",type:"number",value:s.duration_months,onChange:a=>n({...s,duration_months:parseInt(a.target.value)||1}),min:1,required:!0})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(c,{label:"Monto Mensual (S/)",type:"number",step:"0.01",value:s.monthly_amount,onChange:a=>n({...s,monthly_amount:parseFloat(a.target.value)||0}),onBlur:G,min:0,required:!0})}),t.jsxs("div",{children:[t.jsx(c,{label:"Monto Total (S/)",type:"number",step:"0.01",value:s.total_amount,onChange:a=>n({...s,total_amount:parseFloat(a.target.value)||0}),min:0,required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Precio base S/ 1800. Al contado sin interés, fraccionado con interés."})]})]}),t.jsxs("div",{children:[s.total_amount>1800&&t.jsx("div",{className:"p-3 bg-[#F98613]/10 border border-[#F98613]/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-[#F98613]",children:[t.jsx("strong",{children:"Interés aplicado:"})," +",((s.total_amount-1800)/1800*100).toFixed(1),"% (S/ ",(s.total_amount-1800).toFixed(2)," sobre el precio base)"]})}),s.total_amount===1800&&s.installments_count===1&&t.jsx("div",{className:"p-3 bg-[#17BC91]/10 border border-[#17BC91]/30 rounded-lg",children:t.jsxs("p",{className:"text-sm text-[#17BC91]",children:[t.jsx("strong",{children:"✓ Sin interés"})," - Pago al contado al precio base"]})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(c,{label:"Mora Mensual (%)",type:"number",step:"0.01",value:s.late_fee_percentage,onChange:a=>n({...s,late_fee_percentage:parseFloat(a.target.value)||0}),min:0,max:100})}),t.jsx("div",{children:t.jsx(c,{label:"Período de Gracia (días)",type:"number",value:s.grace_period_days,onChange:a=>n({...s,grace_period_days:parseInt(a.target.value)||0}),min:0})})]})]})}),t.jsx("div",{className:"bg-gray-50 px-8 py-6 rounded-b-3xl border-t-2 border-gray-200 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:()=>d(!1),className:"px-6 py-3 text-gray-700 bg-white hover:bg-gray-100 border-2 border-gray-300 rounded-xl font-semibold transition-all duration-200",children:"Cancelar"}),t.jsx("button",{type:"submit",className:"px-6 py-3 rounded-xl font-semibold transition-all duration-200 shadow-sm bg-[#073372] hover:bg-[#17BC91] text-white",children:i?"Actualizar Plan":"Crear Plan"})]})})]})]})}),e[42]=G,e[43]=i,e[44]=s,e[45]=Z,e[46]=Y,e[47]=y):y=e[47];let O;return e[48]!==g||e[49]!==v||e[50]!==y?(O=t.jsx(he,{children:t.jsxs("div",{className:"p-6 space-y-6",children:[Q,g,v,y]})}),e[48]=g,e[49]=v,e[50]=y,e[51]=O):O=e[51],O};function Ce(){o.error("Error al eliminar plan de pago")}function Pe(l){const e=l.data;return t.jsxs("div",{className:"flex items-center py-2 h-full",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#073372"},children:t.jsx(te,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsxs("div",{className:"text-xs text-gray-500",children:[e.installments_count," ",e.installments_count===1?"cuota":"cuotas"," - S/ ",e.total_amount.toFixed(2)]})]})]})}function Ee(l){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-[#073372]/10 text-[#073372] border border-[#073372]/30",children:l.value})})}function Fe(l){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["S/ ",l.value.toFixed(2)]})})}function ke(l){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["S/ ",l.value.toFixed(2)]})})}function Ae(l){const N=((l.data.total_amount-1800)/1800*100).toFixed(1);return t.jsx("div",{className:"flex items-center justify-center h-full",children:parseFloat(N)>0?t.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30",children:["+",N,"%"]}):t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30",children:"Sin interés"})})}function Be(l){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-sm text-gray-600",children:[l.value," meses"]})})}function ze(l){const e=l.value||0;return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${e>0?"bg-[#073372]/10 text-[#073372] border border-[#073372]/30":"bg-gray-100 text-gray-600"}`,children:[e," ",e===1?"aprendiz":"aprendices"]})})}function Re(l){console.error("❌ Error al cambiar estado:",l),o.error("Error al cambiar estado")}function Me(l){console.error(l),o.error("Error al actualizar plan de pago")}function Te(l){console.error(l),o.error("Error al crear plan de pago")}function De(l){return l.stopPropagation()}export{dt as default};
