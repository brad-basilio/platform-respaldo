import{c as Ne,r as F,U as we,j as t,a as Se,b as ie}from"./app-hW54b2m8.js";import{t as c,A as Ce}from"./AuthenticatedLayout-Bwri7box.js";import{I as u}from"./input-C3iNj-_x.js";import{B as Pe}from"./button-8NPOaCQ9.js";import{T as Ee,S as ke,a as Fe}from"./textarea-Lou_H1c0.js";import{S as ze}from"./Select2-tOA01fGG.js";import{M as De,a as Me,C as Re,A as Te,t as Ae}from"./ag-grid-custom-CnKfFux3.js";import{C as ue}from"./credit-card-BAaKkVV6.js";import{T as $e,P as Be}from"./trash-2-c6qhF5AZ.js";import{S as qe}from"./search-0dZtgwJC.js";/* empty css            */import"./graduation-cap-BvamBiDK.js";import"./createLucideIcon-CSdYPDo0.js";import"./settings-B4nssNGI.js";import"./video-DlKByeY0.js";import"./chart-pie-dO89Ilc1.js";import"./users-BsfwygRU.js";import"./book-open-BLHfpvN1.js";import"./award-n0sY9Rj_.js";import"./user-check-CGVRoBgV.js";import"./index-CIB2YEI_.js";import"./utils-D0Zg16Wk.js";import"./index-oB3nBBh0.js";import"./index-KE3fx69O.js";import"./index-DWcieX1M.js";import"./floating-ui.dom-l_pIkl4b.js";De.registerModules([Me]);const St=n=>{const e=Ne.c(79),{paymentPlans:ge,academicLevels:d,selectedLevelId:_e}=n,[o,ve]=F.useState(ge),[r,pe]=F.useState(_e),[oe,h]=F.useState(!1),[m,he]=F.useState(null),[x,xe]=F.useState("");let M;e[0]===Symbol.for("react.memo_cache_sentinel")?(M={name:"",academic_level_id:void 0,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""},e[0]=M):M=e[0];const[s,i]=F.useState(M);let R;e[1]===Symbol.for("react.memo_cache_sentinel")?(R=async()=>{try{const l=(await Se.get("/api/admin/payment-plans")).data;Array.isArray(l)&&(ve(l),console.log("✅ Planes de pago actualizados desde el servidor:",l.length,"planes"))}catch(a){console.error("❌ Error fetching payment plans:",a),c.error("Error al obtener planes de pago",{description:"No se pudo sincronizar con el servidor.",duration:5e3})}},e[1]=R):R=e[1];const f=R;let T,A;e[2]===Symbol.for("react.memo_cache_sentinel")?(T=()=>{f()},A=[f],e[2]=T,e[3]=A):(T=e[2],A=e[3]),we.useEffect(T,A);let $;e[4]!==o||e[5]!==r?($=r?o.filter(a=>a.academic_level_id===r):o,e[4]=o,e[5]=r,e[6]=$):$=e[6];const g=$;let B;e[7]===Symbol.for("react.memo_cache_sentinel")?(B=a=>{he(a),i({name:a.name,academic_level_id:a.academic_level_id,installments_count:a.installments_count,monthly_amount:a.monthly_amount,total_amount:a.total_amount,discount_percentage:a.discount_percentage,duration_months:a.duration_months,late_fee_percentage:a.late_fee_percentage,grace_period_days:a.grace_period_days,is_active:a.is_active,description:a.description||""}),h(!0)},e[7]=B):B=e[7];const ye=B;let q;e[8]===Symbol.for("react.memo_cache_sentinel")?(q=a=>{confirm(`¿Estás seguro de eliminar el plan "${a.name}"?`)&&ie.delete(`/admin/payment-plans/${a.id}`,{preserveScroll:!0,onSuccess:async()=>{c.success("Plan de pago eliminado exitosamente"),await f()},onError:Ie})},e[8]=q):q=e[8];const be=q;let I,L,G,H,Q,W,U;e[9]===Symbol.for("react.memo_cache_sentinel")?(W={headerName:"Plan de Pago",field:"name",flex:1,minWidth:250,filter:"agTextColumnFilter",cellRenderer:Le},U={headerName:"Cuotas",field:"installments_count",width:100,cellRenderer:Ge},I={headerName:"Mensualidad",field:"monthly_amount",width:140,cellRenderer:He},L={headerName:"Total",field:"total_amount",width:140,cellRenderer:Qe},G={headerName:"Descuento",field:"discount_percentage",width:120,cellRenderer:We},H={headerName:"Duración",field:"duration_months",width:110,cellRenderer:Ue},Q={headerName:"Estudiantes",field:"students_count",width:130,cellRenderer:Xe},e[9]=I,e[10]=L,e[11]=G,e[12]=H,e[13]=Q,e[14]=W,e[15]=U):(I=e[9],L=e[10],G=e[11],H=e[12],Q=e[13],W=e[14],U=e[15]);let X;e[16]===Symbol.for("react.memo_cache_sentinel")?(X={headerName:"Estado",field:"is_active",width:120,cellRenderer:a=>{const l=a.data,p=a.value,fe=async D=>{if(!l||!l.id){c.error("Error",{description:"No se pudo identificar el plan de pago",duration:3e3});return}ie.put(`/admin/payment-plans/${l.id}`,{name:l.name,academic_level_id:l.academic_level_id,installments_count:l.installments_count,monthly_amount:l.monthly_amount,total_amount:l.total_amount,discount_percentage:l.discount_percentage,duration_months:l.duration_months,late_fee_percentage:l.late_fee_percentage,grace_period_days:l.grace_period_days,is_active:D,description:l.description},{preserveScroll:!0,onSuccess:async()=>{await f(),c.success(D?"Plan activado":"Plan desactivado",{description:`El plan "${l.name}" ha sido ${D?"activado":"desactivado"}`,duration:3e3})},onError:Je})};return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx(ke,{checked:p,onCheckedChange:fe})})}},e[16]=X):X=e[16];let J;e[17]===Symbol.for("react.memo_cache_sentinel")?(J=[W,U,I,L,G,H,Q,X,{headerName:"Acciones",width:120,sortable:!1,filter:!1,cellRenderer:a=>{const l=a.data;return t.jsxs("div",{className:"flex items-center justify-center space-x-2 h-full",children:[t.jsx("button",{onClick:()=>ye(l),className:"text-blue-600 hover:text-blue-900 p-1 hover:bg-blue-50 rounded transition-colors",title:"Editar plan",children:t.jsx(Fe,{className:"h-4 w-4"})}),t.jsx("button",{onClick:()=>be(l),className:"text-red-600 hover:text-red-900 p-1 hover:bg-red-50 rounded transition-colors",title:"Eliminar plan",children:t.jsx($e,{className:"h-4 w-4"})})]})}}],e[17]=J):J=e[17];const je=J;let K;e[18]!==d[0]?.id||e[19]!==r?(K=()=>{he(null),i({name:"",academic_level_id:r||d[0]?.id,installments_count:1,monthly_amount:0,total_amount:0,discount_percentage:0,duration_months:1,late_fee_percentage:5,grace_period_days:5,is_active:!0,description:""}),h(!0)},e[18]=d[0]?.id,e[19]=r,e[20]=K):K=e[20];const ce=K;let O;e[21]!==m||e[22]!==s?(O=a=>{a.preventDefault();const{academic_level:l,...p}=s;m?ie.put(`/admin/payment-plans/${m.id}`,p,{preserveScroll:!0,onSuccess:async()=>{c.success("Plan de pago actualizado exitosamente"),h(!1),await f()},onError:Ke}):ie.post("/admin/payment-plans",p,{preserveScroll:!0,onSuccess:async()=>{c.success("Plan de pago creado exitosamente"),h(!1),await f()},onError:Oe})},e[21]=m,e[22]=s,e[23]=O):O=e[23];const de=O;let V;e[24]!==s?(V=()=>{const a=s.monthly_amount||0,l=s.installments_count||1,p=s.discount_percentage||0,D=a*l*(1-p/100);i({...s,total_amount:Math.round(D*100)/100})},e[24]=s,e[25]=V):V=e[25];const z=V;let Y;e[26]===Symbol.for("react.memo_cache_sentinel")?(Y=t.jsxs("div",{children:[t.jsxs("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[t.jsx(ue,{className:"w-7 h-7 text-blue-600"}),"Planes de Pago"]}),t.jsx("p",{className:"text-gray-600 mt-1",children:"Configura los planes de pago por nivel académico"})]}),e[26]=Y):Y=e[26];let Z;e[27]===Symbol.for("react.memo_cache_sentinel")?(Z=t.jsx(Be,{className:"w-4 h-4"}),e[27]=Z):Z=e[27];let _;e[28]!==ce?(_=t.jsxs("div",{className:"flex items-center justify-between",children:[Y,t.jsxs(Pe,{onClick:ce,className:"flex items-center gap-2",children:[Z,"Nuevo Plan"]})]}),e[28]=ce,e[29]=_):_=e[29];let ee,te;e[30]===Symbol.for("react.memo_cache_sentinel")?(ee=a=>xe(a.target.value),te=t.jsx(qe,{className:"w-4 h-4"}),e[30]=ee,e[31]=te):(ee=e[30],te=e[31]);let v,y;e[32]!==x?(v=t.jsx(u,{type:"text",label:"Buscar por nombre, nivel, descripción...",value:x,onChange:ee,icon:te,className:"pr-10"}),y=x&&t.jsx("button",{onClick:()=>xe(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:t.jsx(Re,{className:"w-5 h-5"})}),e[32]=x,e[33]=v,e[34]=y):(v=e[33],y=e[34]);let b;e[35]!==v||e[36]!==y?(b=t.jsxs("div",{className:"relative",children:[v,y]}),e[35]=v,e[36]=y,e[37]=b):b=e[37];let ae;e[38]===Symbol.for("react.memo_cache_sentinel")?(ae=()=>pe(void 0),e[38]=ae):ae=e[38];const me=`px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${r?"text-gray-600 hover:bg-gray-50":"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-md"}`;let j;e[39]!==o.length?(j=t.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-white/20",children:o.length}),e[39]=o.length,e[40]=j):j=e[40];let N;e[41]!==me||e[42]!==j?(N=t.jsxs("button",{onClick:ae,className:me,children:["Todos los Planes",j]}),e[41]=me,e[42]=j,e[43]=N):N=e[43];let w;if(e[44]!==d||e[45]!==o||e[46]!==r){let a;e[48]!==o||e[49]!==r?(a=l=>t.jsxs("button",{onClick:()=>pe(l.id),className:`px-6 py-3 rounded-lg font-medium transition-all whitespace-nowrap ${r===l.id?"text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,style:r===l.id?{background:`linear-gradient(to right, ${l.color||"#3B82F6"}, ${l.color||"#3B82F6"}dd)`}:{},children:[l.name,t.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-white/20",children:o.filter(p=>p.academic_level_id===l.id).length})]},l.id),e[48]=o,e[49]=r,e[50]=a):a=e[50],w=d.map(a),e[44]=d,e[45]=o,e[46]=r,e[47]=w}else w=e[47];let S;e[51]!==N||e[52]!==w?(S=t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-1 inline-flex overflow-x-auto",children:t.jsxs("div",{className:"flex space-x-2",children:[N,w]})}),e[51]=N,e[52]=w,e[53]=S):S=e[53];let le;e[54]===Symbol.for("react.memo_cache_sentinel")?(le={height:"calc(100vh - 400px)",width:"100%"},e[54]=le):le=e[54];let se;e[55]===Symbol.for("react.memo_cache_sentinel")?(se={sortable:!0,resizable:!0},e[55]=se):se=e[55];let ne;e[56]===Symbol.for("react.memo_cache_sentinel")?(ne=[10,20,50,100],e[56]=ne):ne=e[56];let C;e[57]!==g||e[58]!==x?(C=t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:t.jsx("div",{className:"ag-theme-quartz",style:le,children:t.jsx(Te,{rowData:g,columnDefs:je,quickFilterText:x,defaultColDef:se,pagination:!0,paginationPageSize:20,paginationPageSizeSelector:ne,animateRows:!0,rowHeight:70,headerHeight:50,theme:Ae})})}),e[57]=g,e[58]=x,e[59]=C):C=e[59];let P;e[60]!==b||e[61]!==S||e[62]!==C?(P=t.jsxs("div",{className:"space-y-4",children:[b,S,C]}),e[60]=b,e[61]=S,e[62]=C,e[63]=P):P=e[63];let E;e[64]!==g.length||e[65]!==r?(E=g.length===0&&t.jsxs("div",{className:"text-center py-12",children:[t.jsx(ue,{className:"w-16 h-16 text-gray-300 mx-auto mb-4"}),t.jsx("p",{className:"text-gray-500 text-lg",children:r?"No hay planes de pago para este nivel académico":"No hay planes de pago registrados"}),t.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Crea el primer plan para comenzar"})]}),e[64]=g.length,e[65]=r,e[66]=E):E=e[66];let k;e[67]!==d||e[68]!==z||e[69]!==m||e[70]!==s||e[71]!==de||e[72]!==oe?(k=oe&&t.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/75 backdrop-blur-sm animate-fade-in flex items-center justify-center p-4",onClick:()=>h(!1),style:{height:"100vh",width:"100vw"},children:t.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col animate-scale-in",onClick:Ve,children:[t.jsx("div",{className:"relative bg-blue-600 px-8 py-6 rounded-t-3xl flex-shrink-0",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"text-2xl font-bold text-white mb-1",children:m?"Editar Plan de Pago":"Nuevo Plan de Pago"}),t.jsx("p",{className:"text-blue-100",children:m?"Actualiza la información del plan":"Completa la información para crear un nuevo plan"})]}),t.jsx("button",{type:"button",onClick:()=>h(!1),className:"text-white/80 hover:text-white hover:bg-white/10 rounded-full p-2 transition-all duration-200",children:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),t.jsxs("form",{onSubmit:de,className:"flex flex-col flex-1 overflow-hidden",children:[t.jsx("div",{className:"p-8 space-y-6 overflow-y-auto flex-1",children:t.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[t.jsx(u,{label:"Nombre del Plan",value:s.name,onChange:a=>i({...s,name:a.target.value}),placeholder:"Ej: Plan Premium, Plan Estándar",required:!0}),t.jsxs("div",{children:[t.jsx(ze,{value:s.academic_level_id,onChange:a=>i({...s,academic_level_id:a}),options:d.map(Ye),label:"Selecciona un nivel académico"}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Nivel académico al que pertenece el plan"})]}),t.jsx(Ee,{label:"Descripción",value:s.description,onChange:a=>i({...s,description:a.target.value}),placeholder:"Descripción opcional del plan",rows:2}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(u,{label:"Número de Cuotas",type:"number",value:s.installments_count,onChange:a=>i({...s,installments_count:parseInt(a.target.value)||1}),onBlur:z,min:1,max:12,required:!0})}),t.jsx("div",{children:t.jsx(u,{label:"Duración (meses)",type:"number",value:s.duration_months,onChange:a=>i({...s,duration_months:parseInt(a.target.value)||1}),min:1,required:!0})})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(u,{label:"Monto Mensual (S/)",type:"number",step:"0.01",value:s.monthly_amount,onChange:a=>i({...s,monthly_amount:parseFloat(a.target.value)||0}),onBlur:z,min:0,required:!0})}),t.jsx("div",{children:t.jsx(u,{label:"Descuento (%)",type:"number",step:"0.01",value:s.discount_percentage,onChange:a=>i({...s,discount_percentage:parseFloat(a.target.value)||0}),onBlur:z,min:0,max:100})})]}),t.jsxs("div",{children:[t.jsx(u,{label:"Monto Total (S/)",type:"number",step:"0.01",value:s.total_amount,onChange:a=>i({...s,total_amount:parseFloat(a.target.value)||0}),min:0,required:!0}),t.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se calcula automáticamente: (Mensualidad × Cuotas) - Descuento"})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsx("div",{children:t.jsx(u,{label:"Mora Mensual (%)",type:"number",step:"0.01",value:s.late_fee_percentage,onChange:a=>i({...s,late_fee_percentage:parseFloat(a.target.value)||0}),min:0,max:100})}),t.jsx("div",{children:t.jsx(u,{label:"Período de Gracia (días)",type:"number",value:s.grace_period_days,onChange:a=>i({...s,grace_period_days:parseInt(a.target.value)||0}),min:0})})]})]})}),t.jsx("div",{className:"bg-gray-50 px-8 py-6 rounded-b-3xl border-t-2 border-gray-200 flex-shrink-0",children:t.jsxs("div",{className:"flex justify-end gap-4",children:[t.jsx("button",{type:"button",onClick:()=>h(!1),className:"px-6 py-3 text-gray-700 bg-white hover:bg-gray-100 border-2 border-gray-300 rounded-xl font-semibold transition-all duration-200",children:"Cancelar"}),t.jsx("button",{type:"submit",className:"px-6 py-3 rounded-xl font-semibold transition-all duration-200 shadow-sm bg-blue-600 hover:bg-blue-700 text-white",children:m?"Actualizar Plan":"Crear Plan"})]})})]})]})}),e[67]=d,e[68]=z,e[69]=m,e[70]=s,e[71]=de,e[72]=oe,e[73]=k):k=e[73];let re;return e[74]!==_||e[75]!==P||e[76]!==E||e[77]!==k?(re=t.jsx(Ce,{children:t.jsxs("div",{className:"p-6 space-y-6",children:[_,P,E,k]})}),e[74]=_,e[75]=P,e[76]=E,e[77]=k,e[78]=re):re=e[78],re};function Ie(){c.error("Error al eliminar plan de pago")}function Le(n){const e=n.data;return t.jsxs("div",{className:"flex items-center py-2 h-full",children:[t.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:e.academic_level?.color||"#3B82F6"},children:t.jsx(ue,{className:"w-5 h-5 text-white"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("div",{className:"text-sm font-medium text-gray-900",children:e.name}),t.jsx("div",{className:"text-xs text-gray-500",children:e.academic_level?.name})]})]})}function Ge(n){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-blue-100 text-blue-800",children:n.value})})}function He(n){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["S/ ",n.value.toFixed(2)]})})}function Qe(n){return t.jsx("div",{className:"flex items-center justify-end h-full",children:t.jsxs("span",{className:"text-sm font-bold text-gray-900",children:["S/ ",n.value.toFixed(2)]})})}function We(n){const e=n.value||0;return t.jsx("div",{className:"flex items-center justify-center h-full",children:e>0?t.jsxs("span",{className:"px-3 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-800",children:[e,"%"]}):t.jsx("span",{className:"text-xs text-gray-400",children:"Sin descuento"})})}function Ue(n){return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:"text-sm text-gray-600",children:[n.value," meses"]})})}function Xe(n){const e=n.value||0;return t.jsx("div",{className:"flex items-center justify-center h-full",children:t.jsxs("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${e>0?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-600"}`,children:[e," ",e===1?"estudiante":"estudiantes"]})})}function Je(n){console.error("❌ Error al cambiar estado:",n),c.error("Error al cambiar estado")}function Ke(n){console.error(n),c.error("Error al actualizar plan de pago")}function Oe(n){console.error(n),c.error("Error al crear plan de pago")}function Ve(n){return n.stopPropagation()}function Ye(n){return{value:n.id,label:n.name}}export{St as default};
