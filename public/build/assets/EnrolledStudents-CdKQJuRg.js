import{r as m,U as j,j as e,a as v}from"./app-C7xbGE3V.js";import{A as ee,S as b}from"./AuthenticatedLayout-DulERFOG.js";import{A as te,t as se,M as ae,a as re}from"./index.esm-FgHZqrN8.js";import{I as n}from"./input-BYOcq91F.js";/* empty css                       */import{U as le}from"./user-check-DeR_l6fE.js";import{U as ie}from"./user-x-BjEiBz35.js";import{C as D}from"./circle-check-big-C7BpfSOo.js";import{C as M}from"./circle-alert-DnYaTYSK.js";import{C as U}from"./clock-C17k-a-0.js";import{E as _}from"./eye-BgT0FRlo.js";import{S as ne}from"./search-CFuwhtv1.js";import{C as O}from"./circle-x-Cl1JanC6.js";import{U as y}from"./users-C08Z0R4W.js";import{M as H}from"./mail-DvB_dMTr.js";import{P as I,M as oe}from"./phone-BN1jRgQK.js";import{C as x}from"./calendar-BUFLG4Fm.js";import{F as h}from"./file-text-BwiQdvZi.js";import{C as P}from"./credit-card-CotQcfwM.js";import{G as $}from"./graduation-cap-CsIqfELI.js";import{B as de}from"./book-open-onhe2X_2.js";/* empty css            */import"./button-kIf0lNrh.js";import"./clsx-B-dksMZM.js";import"./dropdown-menu-YYxChlG9.js";import"./createLucideIcon-Dh3pbmn4.js";import"./index-BcccK9P4.js";import"./index-C6GVuuCn.js";import"./index-Bi6uqHWl.js";import"./badge-8ryLBQP9.js";ae.registerModules([re]);const ce=({student:a,onClose:p,groups:L})=>{const[o,S]=j.useState([]),[E,B]=j.useState(!0),[k,N]=j.useState(!1),w=r=>{if(!r)return"Sin asignar";const d=L.find(C=>C.id===r);return d?d.name:"Grupo desconocido"};return j.useEffect(()=>{(async()=>{try{B(!0);const d=await v.get(`/admin/students/${a.id}/enrollment-documents`);S(d.data.documents||[]),N(d.data.has_pending_documents||!1)}catch(d){console.error("Error al cargar documentos:",d),S([]),N(!1)}finally{B(!1)}})()},[a.id]),j.useEffect(()=>{const r=window.scrollY;return document.body.style.position="fixed",document.body.style.top=`-${r}px`,document.body.style.width="100%",document.body.style.overflow="hidden",()=>{document.body.style.position="",document.body.style.top="",document.body.style.width="",document.body.style.overflow="",window.scrollTo(0,r)}},[]),e.jsx("div",{className:"fixed inset-0 z-[9999] bg-black/50 backdrop-blur-sm animate-fade-in flex items-center justify-center p-4",onClick:p,style:{height:"100vh",width:"100vw"},children:e.jsxs("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col animate-scale-in",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] px-8 py-6 flex items-center justify-between rounded-t-3xl",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Información del Estudiante"}),e.jsx("p",{className:"text-blue-100 text-sm",children:"Todos los datos del estudiante matriculado (Solo lectura)"})]}),e.jsx("button",{onClick:p,className:"text-white hover:bg-white/20 rounded-full p-2 transition-colors",children:e.jsx(O,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-8",children:e.jsxs("form",{className:"space-y-6",children:[e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx(y,{className:"h-5 w-5 mr-2 text-blue-600"}),"Datos Personales"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(n,{label:"Nombres",type:"text",value:a.firstName||"",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Apellido Paterno",type:"text",value:a.paternalLastName||"",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Apellido Materno",type:"text",value:a.maternalLastName||"",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Email",type:"email",value:a.email||"",disabled:!0,variant:"filled",icon:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(n,{label:"Teléfono",type:"text",value:a.phoneNumber||"",disabled:!0,variant:"filled",icon:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(n,{label:"Género",type:"text",value:a.gender==="male"?"Masculino":a.gender==="female"?"Femenino":"Otro",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Fecha de Nacimiento",type:"date",value:a.birthDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Tipo de Documento",type:"text",value:a.documentType?.toUpperCase()||"",disabled:!0,variant:"filled",icon:e.jsx(h,{className:"w-4 h-4"})}),e.jsx(n,{label:"Número de Documento",type:"text",value:a.documentNumber||"",disabled:!0,variant:"filled",icon:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(n,{label:"Nivel Educativo",type:"text",value:a.educationLevel||"",disabled:!0,variant:"filled",icon:e.jsx($,{className:"w-4 h-4"})})})]})]}),e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx(de,{className:"h-5 w-5 mr-2 text-purple-600"}),"Datos Académicos"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(n,{label:"Código de Matrícula",type:"text",value:a.enrollmentCode||"",disabled:!0,variant:"filled",icon:e.jsx(h,{className:"w-4 h-4"})}),e.jsx(n,{label:"Fecha de Pago",type:"date",value:a.paymentDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Fecha de Matrícula",type:"date",value:a.enrollmentDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Nivel Académico",type:"text",value:a.level==="basic"?"Básico":a.level==="intermediate"?"Intermedio":a.level==="advanced"?"Avanzado":"No asignado",disabled:!0,variant:"filled",icon:e.jsx($,{className:"w-4 h-4"})}),e.jsx(n,{label:"Plan Contratado",type:"text",value:a.contractedPlan||"Sin plan",disabled:!0,variant:"filled",icon:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(n,{label:"Grupo Asignado",type:"text",value:w(a.assignedGroupId),disabled:!0,variant:"filled",icon:e.jsx(y,{className:"w-4 h-4"})}),e.jsx(n,{label:"Tipo de Clase",type:"text",value:a.classType==="theoretical"?"Teórico":"Práctico",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Pago Verificado",type:"text",value:a.paymentVerified?"✅ Sí":"❌ No",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Estado",type:"text",value:a.status==="active"?"✅ Activo":"❌ Inactivo",disabled:!0,variant:"filled"})]})]}),e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx($,{className:"h-5 w-5 mr-2 text-orange-600"}),"Examen de Categorización"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(n,{label:"¿Realizó examen?",type:"text",value:a.hasPlacementTest?"Sí":"No",disabled:!0,variant:"filled"}),a.hasPlacementTest&&e.jsxs(e.Fragment,{children:[e.jsx(n,{label:"Fecha del Examen",type:"date",value:a.testDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Puntaje",type:"text",value:a.testScore||"",disabled:!0,variant:"filled",icon:e.jsx(h,{className:"w-4 h-4"})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx(y,{className:"h-5 w-5 mr-2 text-green-600"}),"Datos del Apoderado / Titular"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"Nombre Completo",type:"text",value:a.guardianName||"No registrado",disabled:!0,variant:"filled"}),e.jsx(n,{label:"Número de Documento",type:"text",value:a.guardianDocumentNumber||"No registrado",disabled:!0,variant:"filled",icon:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(n,{label:"Email",type:"email",value:a.guardianEmail||"No registrado",disabled:!0,variant:"filled",icon:e.jsx(H,{className:"w-4 h-4"})}),e.jsx(n,{label:"Teléfono",type:"text",value:a.guardianPhone||"No registrado",disabled:!0,variant:"filled",icon:e.jsx(I,{className:"w-4 h-4"})}),e.jsx(n,{label:"Fecha de Nacimiento",type:"date",value:a.guardianBirthDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Dirección",type:"text",value:a.guardianAddress||"No registrado",disabled:!0,variant:"filled",icon:e.jsx(oe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx(x,{className:"h-5 w-5 mr-2 text-indigo-600"}),"Fechas Importantes"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(n,{label:"Fecha de Registro",type:"date",value:a.registrationDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Fecha de Pago",type:"date",value:a.paymentDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})}),e.jsx(n,{label:"Fecha de Matrícula",type:"date",value:a.enrollmentDate||"",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})})]})]}),a.enrollmentVerified&&e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx(D,{className:"h-5 w-5 mr-2 text-emerald-600"}),"Información de Verificación"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(n,{label:"Verificado por",type:"text",value:a.verifiedEnrollmentBy?.name||"No disponible",disabled:!0,variant:"filled",icon:e.jsx(y,{className:"w-4 h-4"})}),e.jsx(n,{label:"Fecha de Verificación",type:"text",value:a.enrollmentVerifiedAt?new Date(a.enrollmentVerifiedAt).toLocaleString("es-ES"):"No disponible",disabled:!0,variant:"filled",icon:e.jsx(x,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"border border-gray-200 p-6 rounded-xl bg-white shadow-sm",children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900 mb-4 flex items-center border-b border-gray-200 pb-3",children:[e.jsx(h,{className:"h-5 w-5 mr-2 text-indigo-600"}),"Documentos de Matrícula",o.length>0&&e.jsxs("span",{className:"ml-auto text-xs bg-indigo-100 text-indigo-700 px-2.5 py-1 rounded-full font-medium",children:[o.length," documento(s)"]})]}),k&&e.jsx("div",{className:"mb-4 bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(M,{className:"h-5 w-5 text-yellow-600 mr-2"}),e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Atención:"})," Hay documentos enviados al estudiante pendientes de confirmación. No se puede enviar más documentos hasta que confirme los actuales."]})]})}),E?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Cargando documentos..."})]}):o.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(h,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No hay documentos de matrícula"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"El estudiante debe subir su contrato y voucher de pago, o puedes enviarle documentos adicionales"})]}):e.jsxs("div",{className:"space-y-3",children:[o.some(r=>r.is_student_upload)&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[e.jsx(y,{className:"h-4 w-4 mr-2 text-blue-600"}),"Documentos del Estudiante"]}),e.jsx("div",{className:"space-y-3",children:o.filter(r=>r.is_student_upload).map((r,d)=>e.jsx("div",{className:"border border-blue-200 bg-blue-50 rounded-lg p-4 hover:bg-blue-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(h,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:r.document_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Subido por el estudiante • ",r.document_type==="contract"?"Contrato":r.document_type==="payment"?"Voucher de Pago":"Documento"]})]})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 ml-14",children:r.description}),e.jsxs("div",{className:"flex items-center gap-4 ml-14 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3"}),"Subido: ",new Date(r.uploaded_at).toLocaleDateString("es-ES")]}),e.jsxs("span",{className:"flex items-center gap-1 px-2 py-1 rounded-full bg-green-100 text-green-700",children:[e.jsx(D,{className:"h-3 w-3"}),"Confirmado"]})]})]}),e.jsxs("a",{href:r.document_type==="contract"?`/admin/students/${a.id}/contract`:`/storage/${r.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(_,{className:"h-4 w-4"}),"Ver"]})]})},`student-${d}`))})]}),o.some(r=>!r.is_student_upload)&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center",children:[e.jsx(h,{className:"h-4 w-4 mr-2 text-purple-600"}),"Documentos Enviados al Estudiante"]}),e.jsx("div",{className:"space-y-3",children:o.filter(r=>!r.is_student_upload).map((r,d)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 bg-purple-50 rounded-lg",children:e.jsx(h,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:r.document_name}),e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Tipo: ",r.document_type==="contract"?"Contrato":r.document_type==="regulation"?"Reglamento":r.document_type==="terms"?"Términos y Condiciones":"Otro",r.uploaded_by_name&&` • Enviado por: ${r.uploaded_by_name}`]})]})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-2 ml-14",children:r.description}),e.jsxs("div",{className:"flex items-center gap-4 ml-14 text-xs text-gray-500",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"h-3 w-3"}),"Enviado: ",new Date(r.uploaded_at).toLocaleDateString("es-ES")]}),r.requires_signature&&e.jsx("span",{className:`flex items-center gap-1 px-2 py-1 rounded-full ${r.student_confirmed?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"}`,children:r.student_confirmed?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-3 w-3"}),"Confirmado por estudiante"]}):e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"h-3 w-3"}),"Pendiente de confirmación"]})}),r.confirmed_at&&e.jsxs("span",{className:"flex items-center gap-1",children:["Confirmado: ",new Date(r.confirmed_at).toLocaleDateString("es-ES")]})]})]}),e.jsxs("a",{href:`/storage/${r.file_path}`,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-sm rounded-lg transition-colors",children:[e.jsx(_,{className:"h-4 w-4"}),"Ver"]})]})},`verifier-${d}`))})]})]})]})]})}),e.jsx("div",{className:"bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-end rounded-b-3xl",children:e.jsx("button",{onClick:p,className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2.5 rounded-xl font-medium transition-colors",children:"Cerrar"})})]})})},qe=({students:a=[],groups:p=[],userRole:L=""})=>{const[o,S]=m.useState(a??[]),[E,B]=m.useState(null),[k,N]=m.useState(!1),[w,r]=m.useState(""),[d,C]=m.useState("verified"),[V,R]=m.useState(new Set),[W,A]=m.useState(!1),[f,T]=m.useState(null),[c,u]=m.useState([]);j.useEffect(()=>{const t=async()=>{const s=new Set;for(const l of o)try{(await v.get(`/admin/students/${l.id}/enrollment-documents`)).data.has_pending_documents&&s.add(l.id)}catch(i){console.error(`Error checking documents for student ${l.id}:`,i)}R(s)};o.length>0&&t()},[o]);const Q=()=>{const t=document.createElement("input");t.type="file",t.accept=".pdf,.doc,.docx,.png,.jpg,.jpeg",t.multiple=!0,t.onchange=async s=>{const i=s.target.files;if(i){const F=Array.from(i).map(g=>({file:g,document_type:"contract",document_name:g.name.replace(/\.[^/.]+$/,""),description:"",requires_signature:!0}));u([...c,...F])}},t.click()},X=t=>{u(c.filter((s,l)=>l!==t))},z=async t=>{if(V.has(t.id)){await b.fire({title:"Documentos Pendientes",html:`
          <p class="text-gray-700">Este estudiante tiene documentos pendientes de confirmación.</p>
          <p class="text-sm text-yellow-600 mt-2">⏳ Debe confirmar los documentos actuales antes de poder enviar más.</p>
        `,icon:"warning",confirmButtonColor:"#f59e0b",confirmButtonText:"Entendido",customClass:{confirmButton:"px-6 py-2.5 rounded-xl font-medium"}});return}T(t),u([]),A(!0)},Y=async()=>{if(f)try{const t=new FormData;c.forEach((l,i)=>{t.append(`documents[${i}][file]`,l.file),t.append(`documents[${i}][document_type]`,l.document_type),t.append(`documents[${i}][document_name]`,l.document_name),t.append(`documents[${i}][description]`,l.description),t.append(`documents[${i}][requires_signature]`,l.requires_signature?"1":"0")});const s=await v.post(`/admin/students/${f.id}/verify-enrollment`,t,{headers:{"Content-Type":"multipart/form-data"}});s.data.success&&(R(l=>new Set(l).add(f.id)),A(!1),T(null),u([]),await b.fire({title:"¡Documentos Enviados!",html:`
            <p>Los documentos han sido enviados al estudiante exitosamente</p>
            ${s.data.documents_uploaded>0?`<p class="text-sm text-gray-600 mt-2">Se enviaron ${s.data.documents_uploaded} documento(s)</p>`:""}
            <p class="text-sm text-orange-600 mt-3">⏳ La matrícula se verificará cuando el estudiante confirme todos los documentos</p>
          `,icon:"success",confirmButtonColor:"#10b981",confirmButtonText:"Entendido",timer:3e3,timerProgressBar:!0,customClass:{confirmButton:"px-6 py-2.5 rounded-xl font-medium"}}))}catch(t){console.error("Error al verificar matrícula:",t);const s=v.isAxiosError(t)&&t.response?.data?.message||"Error al verificar la matrícula";await b.fire({title:"Error",text:s,icon:"error",confirmButtonColor:"#ef4444",confirmButtonText:"Cerrar",customClass:{confirmButton:"px-6 py-2.5 rounded-xl font-medium"}})}},q=async t=>{if((await b.fire({title:"¿Remover Verificación?",html:`
        <div class="text-left">
          <p class="text-gray-700 mb-3">¿Estás seguro de que quieres remover la verificación de esta matrícula?</p>
          <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded">
            <p class="text-sm text-yellow-800">
              <strong>Advertencia:</strong> Al remover la verificación:
            </p>
            <ul class="text-sm text-yellow-700 mt-2 space-y-1 list-disc list-inside">
              <li>NO contará para la comisión del asesor</li>
              <li>Se marcará como pendiente de verificación</li>
              <li>Se eliminará el registro de verificación</li>
            </ul>
          </div>
        </div>
      `,icon:"warning",showCancelButton:!0,confirmButtonColor:"#ef4444",cancelButtonColor:"#6b7280",confirmButtonText:'<i class="fas fa-times-circle"></i> Sí, Remover',cancelButtonText:'<i class="fas fa-ban"></i> Cancelar',reverseButtons:!0,customClass:{confirmButton:"px-6 py-2.5 rounded-xl font-medium",cancelButton:"px-6 py-2.5 rounded-xl font-medium"}})).isConfirmed)try{const l=await v.post(`/admin/students/${t}/unverify-enrollment`);if(l.data.success){S(F=>F.map(g=>g.id===t?{...g,enrollmentVerified:!1,enrollmentVerifiedAt:void 0,verifiedEnrollmentBy:void 0}:g));const i=l.data.documents_deleted||0;await b.fire({title:"Verificación Removida",html:`
            <p>La verificación ha sido removida exitosamente</p>
            ${i>0?`<p class="text-sm text-gray-600 mt-2">✅ Se eliminaron ${i} documento(s) anterior(es)</p>`:""}
          `,icon:"success",confirmButtonColor:"#10b981",confirmButtonText:"Entendido",timer:3e3,timerProgressBar:!0,customClass:{confirmButton:"px-6 py-2.5 rounded-xl font-medium"}})}}catch(l){console.error("Error al remover verificación:",l);const i=v.isAxiosError(l)&&l.response?.data?.message||"Error al remover la verificación";await b.fire({title:"Error",text:i,icon:"error",confirmButtonColor:"#ef4444",confirmButtonText:"Cerrar",customClass:{confirmButton:"px-6 py-2.5 rounded-xl font-medium"}})}},J=m.useCallback(t=>{if(!t)return"Sin asignar";const s=p.find(l=>l.id===t);return s?s.name:"Grupo desconocido"},[p]),K=m.useMemo(()=>{let t=o;return d==="pending"?t=o.filter(s=>!s.enrollmentVerified):d==="verified"&&(t=o.filter(s=>s.enrollmentVerified)),t},[o,d]),G=t=>{B(t),N(!0)},Z=m.useMemo(()=>[{headerName:"Alumno",field:"name",width:280,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.data,l=s.avatar;return e.jsx("div",{className:"flex items-center justify-between py-2 w-full h-full group",children:e.jsxs("div",{className:"flex items-center",children:[l?e.jsx("img",{src:`/storage/${s.avatar}`,alt:s.name,className:"w-10 h-10 rounded-full object-cover flex-shrink-0 border-2 border-white shadow-md"}):e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-[#073372] to-[#17BC91] rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-white text-sm font-semibold",children:s.name.split(" ").map(i=>i[0]).join("")})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email}),e.jsx("div",{className:"text-xs text-gray-400",children:s.phoneNumber})]})]})})}},{headerName:"Código",field:"enrollmentCode",width:150,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.data;return e.jsxs("div",{className:"w-full h-full flex flex-col justify-center",children:[e.jsx("div",{className:"text-sm font-mono text-gray-900",children:t.value}),e.jsx("div",{className:"text-xs text-gray-500",children:s.enrollmentDate})]})}},{headerName:"Estado",field:"status",width:110,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.value;return e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium ${s==="active"?"bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30":"bg-red-100 text-red-800"}`,children:[s==="active"?e.jsx(le,{className:"w-3 h-3 mr-1"}):e.jsx(ie,{className:"w-3 h-3 mr-1"}),s==="active"?"Activo":"Inactivo"]})})}},{headerName:"Nivel",field:"level",width:130,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.value;if(!s)return e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("span",{className:"text-xs text-gray-400",children:"N/A"})});const l=s==="basic"?"bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30":s==="intermediate"?"bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30":"bg-[#073372]/10 text-[#073372] border border-[#073372]/30";return e.jsx("div",{className:"flex items-center justify-center w-full h-full",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l}`,children:s==="basic"?"Básico":s==="intermediate"?"Intermedio":"Avanzado"})})}},{headerName:"Verificación",field:"enrollmentVerified",width:180,filter:"agTextColumnFilter",cellRenderer:t=>{const s=t.data,l=s.enrollmentVerified,i=V.has(s.id);return e.jsxs("div",{className:"flex items-center gap-2 h-full",children:[l?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Verificado"]}):i?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700 border border-orange-300",children:[e.jsx(M,{className:"w-3 h-3 mr-1"}),"En proceso"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30",children:[e.jsx(U,{className:"w-3 h-3 mr-1"}),"Pendiente"]}),e.jsx("button",{onClick:()=>l?q(s.id):z(s),disabled:!l&&i,className:`relative inline-flex h-5 w-9 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 ${l?"bg-[#17BC91] focus:ring-[#17BC91]":i?"bg-gray-200 cursor-not-allowed opacity-50":"bg-gray-300 focus:ring-gray-400"}`,title:l?"Clic para desverificar":i?"Hay documentos pendientes de confirmación":"Clic para verificar",children:e.jsx("span",{className:`inline-block h-3.5 w-3.5 transform rounded-full bg-white transition-transform ${l?"translate-x-5":"translate-x-0.5"}`})})]})}},{headerName:"Plan",field:"contractedPlan",width:200,filter:"agTextColumnFilter",cellRenderer:t=>{t.data;const s=t.value||"Sin plan";return e.jsx("div",{className:"w-full h-full flex flex-col items-start justify-center",children:e.jsx("div",{className:"text-sm text-gray-900",children:s})})}},{headerName:"Acciones",width:100,cellRenderer:t=>{const s=t.data;return e.jsx("div",{className:"flex items-center justify-center h-full gap-2",children:e.jsx("button",{onClick:()=>G(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Ver detalles",children:e.jsx(_,{className:"h-4 w-4"})})})}}],[J,V,z,q,G]);return e.jsxs(ee,{children:[e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Alumnos Matriculados"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona los estudiantes que ya han completado su matrícula"})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{type:"text",label:"Buscar por nombre, email, código, teléfono, nivel, plan...",value:w,onChange:t=>r(t.target.value),icon:e.jsx(ne,{className:"w-4 h-4"}),className:"pr-10"}),w&&e.jsx("button",{onClick:()=>r(""),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors z-20",children:e.jsx(O,{className:"h-5 w-5"})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-1 inline-flex",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>C("verified"),className:`px-6 py-3 rounded-lg font-medium transition-all ${d==="verified"?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{children:"Verificados"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:o.filter(t=>t.enrollmentVerified).length})]})}),e.jsx("button",{onClick:()=>C("pending"),className:`px-6 py-3 rounded-lg font-medium transition-all ${d==="pending"?"bg-gradient-to-r from-yellow-500 to-orange-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"No Verificados"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:o.filter(t=>!t.enrollmentVerified).length})]})}),e.jsx("button",{onClick:()=>C("all"),className:`px-6 py-3 rounded-lg font-medium transition-all ${d==="all"?"bg-gradient-to-r from-blue-500 to-purple-500 text-white shadow-md":"text-gray-600 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{children:"Todos"}),e.jsx("span",{className:"bg-white/20 px-2 py-0.5 rounded-full text-xs",children:o.length})]})})]})}),e.jsx("div",{className:"ag-theme-quartz",style:{height:"600px",width:"100%"},children:e.jsx(te,{theme:se,rowData:K,columnDefs:Z,quickFilterText:w,defaultColDef:{sortable:!0,filter:!0,resizable:!0,flex:1,minWidth:100},pagination:!0,paginationPageSize:10,paginationPageSizeSelector:[5,10,20,50],rowSelection:{mode:"singleRow"},animateRows:!0,domLayout:"normal",rowHeight:70,headerHeight:48,suppressCellFocus:!0,rowClass:"hover:bg-gray-50"})})]}),k&&E&&e.jsx(ce,{student:E,onClose:()=>N(!1),groups:p}),W&&f&&e.jsx("div",{className:"fixed inset-0 bg-black/50  flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden shadow-2xl",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] px-8 py-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Enviar Documentos para Verificación"}),e.jsxs("p",{className:"text-white/90 text-sm mt-1",children:[f.name," - ",f.enrollmentCode]})]}),e.jsxs("div",{className:"p-8 overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-6",children:[e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("strong",{children:"Importante:"})," Al enviar documentos al estudiante:"]}),e.jsxs("ul",{className:"text-sm text-blue-700 mt-2 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Los documentos se enviarán por email al estudiante"}),e.jsx("li",{children:"El estudiante debe confirmar/firmar cada documento"}),e.jsx("li",{children:"La matrícula se verificará automáticamente cuando confirme todos"}),c.length>0&&e.jsxs("li",{children:["Se enviarán ",c.length," documento(s) que requieren confirmación"]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Documentos para el Estudiante"}),e.jsxs("button",{onClick:Q,className:"flex items-center gap-2 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white px-4 py-2 rounded-lg font-medium transition-colors",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Agregar Documentos"]})]}),c.length===0?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:'No hay documentos agregados. Haz clic en "Agregar Documentos" para subir contratos, reglamentos, etc.'}),e.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Los documentos se enviarán al estudiante por email y deberá confirmarlos/firmarlos."})]}):e.jsx("div",{className:"space-y-3",children:c.map((t,s)=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("span",{className:"font-medium text-gray-900",children:t.file.name}),e.jsxs("span",{className:"text-xs text-gray-500",children:["(",(t.file.size/1024/1024).toFixed(2)," MB)"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 mt-3",children:[e.jsx("input",{type:"text",value:t.document_name,onChange:l=>{const i=[...c];i[s].document_name=l.target.value,u(i)},placeholder:"Nombre del documento",className:"px-3 py-2 border border-gray-300 rounded-lg text-sm"}),e.jsxs("select",{value:t.document_type,onChange:l=>{const i=[...c];i[s].document_type=l.target.value,u(i)},className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[e.jsx("option",{value:"contract",children:"Contrato"}),e.jsx("option",{value:"regulation",children:"Reglamento"}),e.jsx("option",{value:"terms",children:"Términos y Condiciones"}),e.jsx("option",{value:"other",children:"Otro"})]})]}),e.jsx("textarea",{value:t.description,onChange:l=>{const i=[...c];i[s].description=l.target.value,u(i)},placeholder:"Descripción o instrucciones para el estudiante (opcional)",className:"mt-2 w-full px-3 py-2 border border-gray-300 rounded-lg text-sm resize-none",rows:2}),e.jsxs("label",{className:"flex items-center gap-2 mt-2",children:[e.jsx("input",{type:"checkbox",checked:t.requires_signature,onChange:l=>{const i=[...c];i[s].requires_signature=l.target.checked,u(i)},className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Requiere firma del estudiante"})]})]}),e.jsx("button",{onClick:()=>X(s),className:"text-red-600 hover:bg-red-50 p-2 rounded-lg transition-colors",title:"Eliminar documento",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},s))})]})]}),e.jsxs("div",{className:"bg-gray-50 px-8 py-4 border-t border-gray-200 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{A(!1),T(null),u([])},className:"bg-gray-600 hover:bg-gray-700 text-white px-6 py-2.5 rounded-xl font-medium transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:Y,className:"bg-gradient-to-r from-[#073372] to-[#17BC91] hover:opacity-90 text-white px-6 py-2.5 rounded-xl font-medium transition-opacity",children:["✉️ Enviar Documentos al Estudiante",c.length>0&&` (${c.length})`]})]})]})})]})};export{qe as default};
