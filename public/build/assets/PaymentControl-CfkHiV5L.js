import{c as ye,r as o,j as e,a as q}from"./app-BKB5QTos.js";import{t as d,e as O,A as se,D as ve}from"./AuthenticatedLayout-L5PB5Xk-.js";import{I as we}from"./input-BY-DcWeT.js";import{c as H}from"./createLucideIcon-D0VNQUuH.js";import{B as xe}from"./building-2-I-90C319.js";import{C as te}from"./credit-card-CJK27LEV.js";import{X as K}from"./dropdown-menu-Cn8w9y5o.js";import{L as Ce}from"./lock-CdQ1CDxn.js";import{C as R}from"./circle-alert-Bb3-IZb5.js";import{C as J}from"./check-CXkTNZ7S.js";import{C as ie}from"./copy-D5vk8eAq.js";import{D as ce}from"./dollar-sign-CL77vSf5.js";import{T as Pe}from"./trending-up-CVa7ffm-.js";import{C as de}from"./circle-check-big-DaSvys1g.js";import{C as Q}from"./clock-BM7haLlh.js";import{F as me}from"./file-text-DZuXzpvx.js";import{C as Se}from"./calendar-BkgCgcm_.js";/* empty css            */import"./button-C5cvAwwv.js";import"./clsx-B-dksMZM.js";import"./badge-CRTJGp5c.js";import"./index-BgHS2JAi.js";import"./triangle-alert-B0bDoXby.js";import"./index-B_RXRVii.js";import"./index-C6r5wEow.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ue=H("ArrowRight",ke);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],Fe=H("RefreshCcw",De);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],Ee=H("Shield",Me);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]],pe=H("Smartphone",Te),Be=l=>{const t=ye.c(37),{isOpen:v,onClose:D,onSelectMethod:g,installmentAmount:j}=l,[N,i]=o.useState(null);if(!v)return null;const E=_e;let f;t[0]===Symbol.for("react.memo_cache_sentinel")?(f={id:"yape",name:"Yape",description:"Pago mediante Yape - Requiere subir comprobante",icon:pe,color:"from-purple-500 to-pink-500",bgColor:"bg-purple-50",borderColor:"border-purple-200",hoverColor:"hover:border-purple-400"},t[0]=f):f=t[0];let S;t[1]===Symbol.for("react.memo_cache_sentinel")?(S={id:"transfer",name:"Transferencia Bancaria",description:"Transferencia o dep√≥sito bancario - Requiere subir comprobante",icon:xe,color:"from-blue-500 to-cyan-500",bgColor:"bg-blue-50",borderColor:"border-blue-200",hoverColor:"hover:border-blue-400"},t[1]=S):S=t[1];let M;t[2]===Symbol.for("react.memo_cache_sentinel")?(M=[f,S,{id:"card",name:"Tarjeta de Cr√©dito",description:"Pago inmediato con tarjeta - Aprobaci√≥n autom√°tica",icon:te,color:"from-green-500 to-emerald-500",bgColor:"bg-green-50",borderColor:"border-green-200",hoverColor:"hover:border-green-400"}],t[2]=M):M=t[2];const T=M;let k;t[3]!==g||t[4]!==N?(k=()=>{N&&g(N)},t[3]=g,t[4]=N,t[5]=k):k=t[5];const w=k;let B;t[6]===Symbol.for("react.memo_cache_sentinel")?(B=e.jsx("h2",{className:"text-2xl font-bold",children:"Selecciona tu m√©todo de pago"}),t[6]=B):B=t[6];let C;t[7]!==j?(C=E(j),t[7]=j,t[8]=C):C=t[8];let m;t[9]!==C?(m=e.jsxs("div",{children:[B,e.jsxs("p",{className:"text-white/90 text-sm mt-1",children:["Monto a pagar: ",e.jsx("span",{className:"font-bold text-lg",children:C})]})]}),t[9]=C,t[10]=m):m=t[10];let b;t[11]===Symbol.for("react.memo_cache_sentinel")?(b=e.jsx(K,{className:"w-6 h-6"}),t[11]=b):b=t[11];let y;t[12]!==D?(y=e.jsx("button",{onClick:D,className:"text-white/80 hover:text-white transition-colors p-2 hover:bg-white/10 rounded-lg",children:b}),t[12]=D,t[13]=y):y=t[13];let r;t[14]!==m||t[15]!==y?(r=e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-8 py-6 rounded-t-3xl flex items-center justify-between",children:[m,y]}),t[14]=m,t[15]=y,t[16]=r):r=t[16];let a;t[17]!==N?(a=T.map(p=>{const V=p.icon,A=N===p.id;return e.jsx("button",{onClick:()=>i(p.id),className:`w-full text-left p-6 rounded-2xl border-2 transition-all ${A?`${p.borderColor} ${p.bgColor} shadow-lg scale-[1.02]`:"border-slate-200 hover:border-slate-300 hover:shadow-md"}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:`p-4 rounded-xl bg-gradient-to-br ${p.color} flex-shrink-0`,children:e.jsx(V,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:p.name}),A&&e.jsx("div",{className:"flex-shrink-0 w-6 h-6 rounded-full bg-gradient-to-br from-[#17BC91] to-[#073372] flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})]}),e.jsx("p",{className:"text-sm text-slate-600",children:p.description}),e.jsxs("div",{className:"mt-3 flex items-center space-x-4 text-xs",children:[p.id==="card"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-green-100 text-green-700 font-medium",children:"‚úì Aprobaci√≥n Instant√°nea"}),e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-blue-100 text-blue-700 font-medium",children:"üí≥ Guardar Tarjeta"})]}),(p.id==="yape"||p.id==="transfer")&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full bg-orange-100 text-orange-700 font-medium",children:"‚è≥ Requiere Verificaci√≥n"})]})]})]})},p.id)}),t[17]=N,t[18]=a):a=t[18];let c;t[19]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-xl",children:e.jsxs("p",{className:"text-sm text-blue-900",children:[e.jsx("strong",{className:"font-semibold",children:"üí° Nota:"})," Para pagos con Yape o Transferencia, deber√°s subir el comprobante despu√©s de realizar la operaci√≥n. El cajero verificar√° tu pago en un plazo de 24-48 horas."]})}),t[19]=c):c=t[19];let F;t[20]!==a?(F=e.jsxs("div",{className:"p-8 space-y-4",children:[a,c]}),t[20]=a,t[21]=F):F=t[21];let _;t[22]!==D?(_=e.jsx("button",{onClick:D,className:"px-6 py-3 border-2 border-slate-300 text-slate-700 font-semibold rounded-xl hover:bg-slate-100 transition-colors",children:"Cancelar"}),t[22]=D,t[23]=_):_=t[23];const $=!N,W=`px-8 py-3 rounded-xl font-semibold transition-all flex items-center space-x-2 ${N?"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white hover:shadow-lg hover:scale-105":"bg-slate-200 text-slate-400 cursor-not-allowed"}`;let z,Y;t[24]===Symbol.for("react.memo_cache_sentinel")?(z=e.jsx("span",{children:"Continuar"}),Y=e.jsx(ue,{className:"w-5 h-5"}),t[24]=z,t[25]=Y):(z=t[24],Y=t[25]);let L;t[26]!==w||t[27]!==$||t[28]!==W?(L=e.jsxs("button",{onClick:w,disabled:$,className:W,children:[z,Y]}),t[26]=w,t[27]=$,t[28]=W,t[29]=L):L=t[29];let U;t[30]!==_||t[31]!==L?(U=e.jsxs("div",{className:"sticky bottom-0 bg-slate-50 px-8 py-6 rounded-b-3xl border-t border-slate-200 flex justify-end space-x-4",children:[_,L]}),t[30]=_,t[31]=L,t[32]=U):U=t[32];let G;return t[33]!==r||t[34]!==F||t[35]!==U?(G=e.jsx("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-3xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[r,F,U]})}),t[33]=r,t[34]=F,t[35]=U,t[36]=G):G=t[36],G};function _e(l){return new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(l)}const qe=({isOpen:l,onClose:t,installment:v,onSuccess:D})=>{const[g,j]=o.useState(!1),[N,i]=o.useState(!1),[E,f]=o.useState(!1),[S,M]=o.useState(""),[T,k]=o.useState(!1);o.useEffect(()=>{l&&(async()=>{try{const b=await q.get("/api/student/culqi/public-key");M(b.data.public_key)}catch(b){console.error("Error loading Culqi public key:",b),d.error("Error al cargar configuraci√≥n de pagos")}})()},[l]),o.useEffect(()=>{if(!S)return;const m=document.createElement("script");return m.src="https://js.culqi.com/checkout-js",m.async=!0,m.onload=()=>{k(!0),w()},document.body.appendChild(m),()=>{document.body.removeChild(m)}},[S]);const w=()=>{if(!window.CulqiCheckout||!S)return;const m={title:"ANCED - Pago de Cuota",currency:"PEN",amount:Math.round(v.amount*100)},b={email:""},y={lang:"es",installments:!1,modal:!0,container:"#culqi-container",paymentMethods:{tarjeta:!0,yape:!1,billetera:!1,bancaMovil:!1,agente:!1,cuotealo:!1}},r={theme:"default",hiddenCulqiLogo:!1,menuType:"sidebar",buttonCardPayText:`Pagar S/. ${v.amount.toFixed(2)}`,logo:null,defaultStyle:{bannerColor:"#073372",buttonBackground:"#17BC91",menuColor:"#073372",linksColor:"#17BC91",buttonTextColor:"#ffffff",priceColor:"#073372"}},a={settings:m,client:b,options:y,appearance:r},c=new window.CulqiCheckout(S,a),F=()=>{if(window.Culqi.token){const _=window.Culqi.token;console.log("Token creado:",_.id),c.close(),C(_.id)}else window.Culqi.order?(c.close(),console.log("Order created:",window.Culqi.order)):(console.error("Culqi error:",window.Culqi.error),d.error(window.Culqi.error.user_message||"Error al procesar el pago"),j(!1))};c.culqi=F,window.Culqi=c},B=()=>{if(!window.Culqi){d.error("Culqi no est√° listo. Por favor intenta de nuevo.");return}j(!0),window.Culqi.open()},C=async m=>{try{j(!0);const b=await q.post("/api/student/culqi/process-payment",{token_id:m,installment_id:v.id,amount:v.amount,save_card:N,auto_payment:E});b.data.success?(d.success("¬°Pago procesado exitosamente!",{description:`La cuota #${v.installment_number} ha sido pagada`,duration:5e3}),D(),t()):d.error("Error al procesar el pago",{description:b.data.error||"Intenta nuevamente"})}catch(b){console.error("Error processing payment:",b);const y=b.response?.data?.error||"Error al procesar el pago";d.error(y)}finally{j(!1)}};return l?e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm transition-opacity",onClick:t}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs("div",{className:"relative w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white shadow-2xl transition-all",children:[e.jsxs("div",{className:"relative bg-gradient-to-r from-[#073372] to-[#17BC91] px-8 py-6",children:[e.jsx("button",{onClick:t,className:"absolute right-4 top-4 rounded-full bg-white/20 p-2 text-white hover:bg-white/30 transition-colors",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-full bg-white/20 p-3",children:e.jsx(te,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Pagar con Tarjeta"}),e.jsxs("p",{className:"text-sm text-white/90",children:["Cuota #",v.installment_number," - S/. ",v.amount.toFixed(2)]})]})]})]}),e.jsxs("div",{className:"px-8 py-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsx(Ee,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold text-green-900",children:"Pago 100% Seguro"}),e.jsx("p",{className:"text-xs text-green-700",children:"Tu informaci√≥n est√° protegida con encriptaci√≥n SSL"})]}),e.jsx(Ce,{className:"h-5 w-5 text-green-600"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600",children:'Al hacer clic en "Pagar con Tarjeta", se abrir√° el formulario seguro de Culqi donde podr√°s ingresar los datos de tu tarjeta.'}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:N,onChange:m=>i(m.target.checked),className:"mt-1 w-4 h-4 text-[#17BC91] border-gray-300 rounded focus:ring-[#17BC91]"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900 group-hover:text-[#17BC91] transition-colors",children:"Guardar tarjeta para futuros pagos"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Podr√°s pagar m√°s r√°pido en tu pr√≥xima cuota"})]})]}),N&&e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer group ml-7 p-3 bg-blue-50 rounded-lg border border-blue-200",children:[e.jsx("input",{type:"checkbox",checked:E,onChange:m=>f(m.target.checked),className:"mt-1 w-4 h-4 text-blue-600 border-blue-300 rounded focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm font-medium text-blue-900 group-hover:text-blue-700 transition-colors",children:"Habilitar pagos autom√°ticos"}),e.jsx("p",{className:"text-xs text-blue-700 mt-1",children:"Tus cuotas futuras se pagar√°n autom√°ticamente en la fecha de vencimiento"})]})]})]})]}),e.jsxs("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-gray-100 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Cuota"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["S/. ",v.amount.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm mb-2",children:[e.jsx("span",{className:"text-gray-600",children:"Comisi√≥n"}),e.jsx("span",{className:"font-medium text-gray-900",children:"S/. 0.00"})]}),e.jsx("div",{className:"border-t border-gray-300 pt-2 mt-2",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-bold text-gray-900",children:"Total a Pagar"}),e.jsxs("span",{className:"text-2xl font-bold text-[#073372]",children:["S/. ",v.amount.toFixed(2)]})]})})]}),e.jsx("div",{id:"culqi-container"})]}),e.jsxs("div",{className:"px-8 py-6 bg-gray-50 border-t border-gray-200 flex gap-3",children:[e.jsx("button",{type:"button",onClick:t,disabled:g,className:"flex-1 px-6 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-100 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{type:"button",onClick:B,disabled:g||!T||!S,className:"flex-1 px-6 py-3 bg-gradient-to-r from-[#073372] to-[#17BC91] text-white font-medium rounded-lg hover:shadow-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:g?"Procesando...":"Pagar con Tarjeta"})]}),e.jsx("div",{className:"px-8 py-3 bg-gray-100 border-t border-gray-200",children:e.jsxs("p",{className:"text-xs text-center text-gray-500",children:["Procesado de forma segura por ",e.jsx("span",{className:"font-semibold",children:"Culqi"})]})})]})})]}):null},Ae=({isOpen:l,onClose:t,onSuccess:v,installmentId:D,amount:g})=>{const[j,N]=o.useState([]),[i,E]=o.useState(null),[f,S]=o.useState(null),[M,T]=o.useState(null),[k,w]=o.useState(!1),[B,C]=o.useState(!0);o.useEffect(()=>{l&&m()},[l]);const m=async()=>{try{C(!0);const a=(await q.get("/api/student/active-payment-methods")).data.yapes||[];N(a),a.length>0&&E(a[0])}catch(r){console.error("Error fetching yape methods:",r),d.error("Error al cargar m√©todos Yape")}finally{C(!1)}},b=r=>{const a=r.target.files?.[0];if(a){if(!a.type.startsWith("image/")&&a.type!=="application/pdf"){d.error("Solo se permiten im√°genes o archivos PDF");return}if(a.size>5*1024*1024){d.error("El archivo no debe superar 5MB");return}if(S(a),a.type.startsWith("image/")){const c=new FileReader;c.onloadend=()=>{T(c.result)},c.readAsDataURL(a)}else T(null)}},y=async()=>{if(!i){d.error("Selecciona un m√©todo Yape");return}if(!f){d.error("Debes subir el comprobante de pago");return}try{w(!0);const r=new FormData;r.append("voucher_file",f),r.append("installment_id",D),r.append("declared_amount",g.toString()),r.append("payment_date",new Date().toISOString().split("T")[0]),r.append("payment_method","yape"),await q.post("/api/student/upload-voucher",r,{headers:{"Content-Type":"multipart/form-data"}}),d.success("¬°Pago registrado exitosamente!",{description:"Tu comprobante est√° siendo verificado por el cajero"}),v(),t()}catch(r){console.error("Error uploading voucher:",r),d.error("Error al subir comprobante",{description:r.response?.data?.message||"No se pudo procesar el pago"})}finally{w(!1)}};return l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-4 flex items-center justify-between rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pe,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Pagar con Yape"}),e.jsx("p",{className:"text-sm text-white/90",children:"Escanea el QR y sube tu comprobante"})]})]}),e.jsx("button",{onClick:t,className:"text-white/80 hover:text-white transition-colors",children:e.jsx(K,{className:"w-6 h-6"})})]}),B?e.jsx("div",{className:"p-12 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-purple-600"})}):j.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(R,{className:"w-16 h-16 text-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No hay m√©todos Yape disponibles"}),e.jsx("p",{className:"text-slate-600",children:"Por favor, contacta con administraci√≥n"})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 border-2 border-purple-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900 mb-1",children:"Monto a pagar:"}),e.jsx("p",{className:"text-3xl font-bold text-purple-700",children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(g)})]}),j.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Selecciona la cuenta Yape:"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:j.map(r=>e.jsx("button",{onClick:()=>E(r),className:`p-4 rounded-xl border-2 transition-all text-left ${i?.id===r.id?"border-purple-600 bg-purple-50":"border-slate-200 hover:border-slate-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:r.name}),r.description&&e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:r.description}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:["üì± ",r.phone_number]})]}),i?.id===r.id&&e.jsx(J,{className:"w-6 h-6 text-purple-600"})]})},r.id))})]}),i&&e.jsxs("div",{className:"bg-white border-2 border-purple-200 rounded-xl p-6",children:[e.jsx("h4",{className:"font-bold text-slate-900 mb-4 text-center",children:i.name}),i.description&&e.jsx("p",{className:"text-sm text-slate-600 text-center mb-4",children:i.description}),i.qr_image_url?e.jsxs("div",{className:"flex flex-col items-center mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700 mb-3",children:"Escanea este c√≥digo QR con tu app de Yape:"}),e.jsx("img",{src:i.qr_image_url,alt:"QR Yape",className:"w-64 h-64 object-contain border-4 border-purple-200 rounded-xl shadow-lg"})]}):e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-purple-900 font-medium mb-2",children:"N√∫mero de Yape:"}),e.jsx("p",{className:"text-2xl font-bold text-purple-700",children:i.phone_number})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[e.jsx("h5",{className:"font-semibold text-blue-900 mb-2",children:"üìù Instrucciones:"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Abre tu app de Yape"}),e.jsx("li",{children:"Escanea el c√≥digo QR o ingresa el n√∫mero manualmente"}),e.jsxs("li",{children:["Ingresa el monto exacto: ",e.jsx("strong",{children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(g)})]}),e.jsx("li",{children:"Completa la transferencia"}),e.jsx("li",{children:"Toma una captura de pantalla del comprobante"}),e.jsx("li",{children:"Sube la imagen aqu√≠ abajo"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Comprobante de pago ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:b,className:"hidden",id:"yape-voucher-upload"}),e.jsx("label",{htmlFor:"yape-voucher-upload",className:"block w-full px-4 py-8 border-2 border-dashed border-slate-300 rounded-xl text-center cursor-pointer hover:border-purple-500 hover:bg-purple-50 transition-colors",children:M?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:M,alt:"Preview",className:"max-h-48 mx-auto rounded-lg"}),e.jsx("p",{className:"text-sm text-slate-600",children:f?.name}),e.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Click para cambiar"})]}):f?e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"w-12 h-12 text-purple-600 mx-auto"}),e.jsx("p",{className:"text-sm text-slate-900 font-medium",children:f.name}),e.jsx("p",{className:"text-xs text-purple-600 font-medium",children:"Click para cambiar"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"w-12 h-12 text-slate-400 mx-auto"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Click para subir tu comprobante"}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG o PDF (m√°x. 5MB)"})]})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:t,disabled:k,className:"flex-1 px-6 py-3 border-2 border-slate-300 text-slate-700 font-medium rounded-xl hover:bg-slate-50 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:y,disabled:k||!f,className:"flex-1 inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Confirmar Pago"]})})]})]})]})}):null},Ie=({isOpen:l,onClose:t,onSuccess:v,installmentId:D,amount:g})=>{const[j,N]=o.useState([]),[i,E]=o.useState(null),[f,S]=o.useState(null),[M,T]=o.useState(null),[k,w]=o.useState(!1),[B,C]=o.useState(!0);o.useEffect(()=>{l&&m()},[l]);const m=async()=>{try{C(!0);const c=(await q.get("/api/student/active-payment-methods")).data.transfers||[];N(c),c.length>0&&E(c[0])}catch(a){console.error("Error fetching transfer methods:",a),d.error("Error al cargar cuentas bancarias")}finally{C(!1)}},b=(a,c)=>{navigator.clipboard.writeText(a),d.success(`${c} copiado`,{duration:2e3})},y=a=>{const c=a.target.files?.[0];if(c){if(!c.type.startsWith("image/")&&c.type!=="application/pdf"){d.error("Solo se permiten im√°genes o archivos PDF");return}if(c.size>5*1024*1024){d.error("El archivo no debe superar 5MB");return}if(S(c),c.type.startsWith("image/")){const F=new FileReader;F.onloadend=()=>{T(F.result)},F.readAsDataURL(c)}else T(null)}},r=async()=>{if(!i){d.error("Selecciona una cuenta bancaria");return}if(!f){d.error("Debes subir el comprobante de pago");return}try{w(!0);const a=new FormData;a.append("voucher_file",f),a.append("installment_id",D),a.append("declared_amount",g.toString()),a.append("payment_date",new Date().toISOString().split("T")[0]),a.append("payment_method","transfer"),await q.post("/api/student/upload-voucher",a,{headers:{"Content-Type":"multipart/form-data"}}),d.success("¬°Pago registrado exitosamente!",{description:"Tu comprobante est√° siendo verificado por el cajero"}),v(),t()}catch(a){console.error("Error uploading voucher:",a),d.error("Error al subir comprobante",{description:a.response?.data?.message||"No se pudo procesar el pago"})}finally{w(!1)}};return l?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-blue-600 to-cyan-600 text-white px-6 py-4 flex items-center justify-between rounded-t-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(xe,{className:"w-6 h-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:"Transferencia Bancaria"}),e.jsx("p",{className:"text-sm text-white/90",children:"Transfiere y sube tu comprobante"})]})]}),e.jsx("button",{onClick:t,className:"text-white/80 hover:text-white transition-colors",children:e.jsx(K,{className:"w-6 h-6"})})]}),B?e.jsx("div",{className:"p-12 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):j.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(R,{className:"w-16 h-16 text-orange-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No hay cuentas bancarias disponibles"}),e.jsx("p",{className:"text-slate-600",children:"Por favor, contacta con administraci√≥n"})]}):e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-cyan-50 border-2 border-blue-200 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Monto a transferir:"}),e.jsx("p",{className:"text-3xl font-bold text-blue-700",children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(g)})]}),j.length>1&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Selecciona la cuenta bancaria:"}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:j.map(a=>e.jsx("button",{onClick:()=>E(a),className:`p-4 rounded-xl border-2 transition-all text-left ${i?.id===a.id?"border-blue-600 bg-blue-50":"border-slate-200 hover:border-slate-300"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[a.bank_logo_url&&e.jsx("img",{src:a.bank_logo_url,alt:a.bank_name,className:"h-8 object-contain"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-slate-900",children:a.name}),a.description&&e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:a.description}),e.jsxs("p",{className:"text-sm text-slate-700 mt-1",children:[a.bank_name," - ",a.account_holder]})]})]}),i?.id===a.id&&e.jsx(J,{className:"w-6 h-6 text-blue-600"})]})},a.id))})]}),i&&e.jsxs("div",{className:"bg-white border-2 border-blue-200 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[i.bank_logo_url&&e.jsx("img",{src:i.bank_logo_url,alt:i.bank_name,className:"h-12 object-contain"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-slate-900 text-lg",children:i.name}),i.description&&e.jsx("p",{className:"text-sm text-slate-600",children:i.description})]})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-600 mb-1",children:"Banco:"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900",children:i.bank_name})]}),e.jsxs("div",{className:"bg-slate-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-xs font-medium text-slate-600 mb-1",children:"Titular de la Cuenta:"}),e.jsx("p",{className:"text-lg font-semibold text-slate-900",children:i.account_holder})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-blue-900",children:"N√∫mero de Cuenta:"}),e.jsx("button",{onClick:()=>b(i.account_number,"N√∫mero de cuenta"),className:"p-1 hover:bg-blue-100 rounded transition-colors",title:"Copiar",children:e.jsx(ie,{className:"w-4 h-4 text-blue-600"})})]}),e.jsx("p",{className:"text-lg font-bold text-blue-700",children:i.account_number}),e.jsxs("p",{className:"text-xs text-blue-600 mt-1 capitalize",children:["Cuenta ",i.account_type]})]}),e.jsxs("div",{className:"bg-cyan-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("p",{className:"text-xs font-medium text-cyan-900",children:"CCI:"}),e.jsx("button",{onClick:()=>b(i.cci,"CCI"),className:"p-1 hover:bg-cyan-100 rounded transition-colors",title:"Copiar",children:e.jsx(ie,{className:"w-4 h-4 text-cyan-600"})})]}),e.jsx("p",{className:"text-lg font-bold text-cyan-700",children:i.cci}),e.jsx("p",{className:"text-xs text-cyan-600 mt-1",children:"Para transferencias interbancarias"})]})]})]}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-4",children:[e.jsx("h5",{className:"font-semibold text-amber-900 mb-2",children:"üìù Instrucciones:"}),e.jsxs("ol",{className:"text-sm text-amber-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Ingresa a tu banca por internet o app m√≥vil"}),e.jsx("li",{children:'Selecciona "Transferir a otro banco" o "Transferir a otra cuenta"'}),e.jsxs("li",{children:["Ingresa el ",e.jsx("strong",{children:"n√∫mero de cuenta"})," o ",e.jsx("strong",{children:"CCI"})," (usa los botones para copiar)"]}),e.jsxs("li",{children:["Ingresa el monto exacto: ",e.jsx("strong",{children:new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(g)})]}),e.jsx("li",{children:"Completa la transferencia"}),e.jsx("li",{children:"Guarda o toma captura del comprobante"}),e.jsx("li",{children:"Sube el comprobante aqu√≠ abajo"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:["Comprobante de transferencia ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:y,className:"hidden",id:"transfer-voucher-upload"}),e.jsx("label",{htmlFor:"transfer-voucher-upload",className:"block w-full px-4 py-8 border-2 border-dashed border-slate-300 rounded-xl text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-colors",children:M?e.jsxs("div",{className:"space-y-3",children:[e.jsx("img",{src:M,alt:"Preview",className:"max-h-48 mx-auto rounded-lg"}),e.jsx("p",{className:"text-sm text-slate-600",children:f?.name}),e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Click para cambiar"})]}):f?e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"w-12 h-12 text-blue-600 mx-auto"}),e.jsx("p",{className:"text-sm text-slate-900 font-medium",children:f.name}),e.jsx("p",{className:"text-xs text-blue-600 font-medium",children:"Click para cambiar"})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{className:"w-12 h-12 text-slate-400 mx-auto"}),e.jsx("p",{className:"text-sm text-slate-600",children:"Click para subir tu comprobante"}),e.jsx("p",{className:"text-xs text-slate-500",children:"PNG, JPG o PDF (m√°x. 5MB)"})]})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:t,disabled:k,className:"flex-1 px-6 py-3 border-2 border-slate-300 text-slate-700 font-medium rounded-xl hover:bg-slate-50 transition-colors disabled:opacity-50",children:"Cancelar"}),e.jsx("button",{onClick:r,disabled:k||!f,className:"flex-1 inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"Confirmar Pago"]})})]})]})]})}):null},cs=()=>{const[l,t]=o.useState(null),[v,D]=o.useState(!0),[g,j]=o.useState(null),[N,i]=o.useState(!1),[E,f]=o.useState([]),[S,M]=o.useState(!1),[T,k]=o.useState(""),[w,B]=o.useState(null),[C,m]=o.useState(!1),[b,y]=o.useState(!1),[r,a]=o.useState(""),[c,F]=o.useState(!1),[_,$]=o.useState(!1),[W,z]=o.useState(!1),[Y,L]=o.useState(!1),[U,G]=o.useState(!1),[p,V]=o.useState(null);o.useEffect(()=>{A(),ae()},[]);const A=async()=>{try{D(!0);const n=(await q.get("/api/student/enrollment")).data.enrollment,h=n.paymentPlan.gracePeriodDays||0;n.installments=n.installments.map(u=>{const P=new Date,I=new Date(P.getFullYear(),P.getMonth(),P.getDate());console.log("üïê Fecha del sistema:",P.toString()),console.log("üïê Fecha local procesada:",I.toString()),console.log("üïê Fecha ISO:",P.toISOString());const[Z,ge,je]=u.dueDate.split("-").map(Number),le=new Date(Z,ge-1,je),Ne=le.getTime()-I.getTime(),ne=Math.round(Ne/(1e3*60*60*24)),ee=new Date(le);ee.setDate(ee.getDate()+h);const oe=Math.round((ee.getTime()-I.getTime())/(1e3*60*60*24));return console.log("üìÖ Cuota #"+u.installmentNumber+":",{hoyLocal:I.toISOString().split("T")[0],fechaVencimiento:u.dueDate,diffDays:ne,gracePeriodDays:h,daysUntilGraceLimit:oe}),{...u,daysUntilDue:ne,daysUntilGraceLimit:oe,gracePeriodDays:h}}),t(n)}catch(s){console.error("Error fetching enrollment:",s);const n=s;d.error("Error al cargar informaci√≥n de pagos",{description:n.response?.data?.message||"No se pudo obtener tu cronograma de pagos"})}finally{D(!1)}},ae=async()=>{try{const s=await q.get("/api/student/can-change-plan");if(M(s.data.can_change),s.data.can_change){const n=await q.get("/api/student/available-plans");f(n.data.plans)}}catch(s){console.error("Error checking plan change eligibility:",s)}},he=async()=>{if(!w){d.error("Debes seleccionar un plan");return}try{m(!0),await q.post("/api/student/change-plan",{new_plan_id:w,reason:T||"Cambio solicitado por el estudiante"}),d.success("Plan de pago cambiado exitosamente",{description:"Tu cronograma de pagos ha sido actualizado"}),i(!1),await A(),await ae()}catch(s){const n=s;d.error("Error al cambiar plan de pago",{description:n.response?.data?.message||"No se pudo cambiar el plan"})}finally{m(!1)}},be=async s=>{if(!r||parseFloat(r)<=0){d.error("Ingresa un monto v√°lido");return}if(parseFloat(r)>(l?.totalPending||0)){d.error("Monto inv√°lido",{description:`El monto no puede ser mayor a tu deuda pendiente (${x(l?.totalPending||0)})`});return}try{F(!0);const h=new FormData;h.append("voucher_file",s),h.append("declared_amount",r),h.append("payment_date",new Date().toISOString().split("T")[0]),h.append("payment_method","transfer"),h.append("is_partial_payment","1");for(const P of Array.from(h.keys()))console.log("formData key:",P,h.get(P));const u=await q.post("/api/student/upload-voucher",h,{headers:{"Content-Type":"multipart/form-data"}});d.success("Pago parcial procesado exitosamente",{description:`S/ ${u.data.amount_distributed} distribuido a ${u.data.affected_installments} cuota(s)`}),y(!1),a(""),await A()}catch(h){const u=h;d.error("Error al procesar pago parcial",{description:u.response?.data?.message||"No se pudo procesar el pago"})}finally{F(!1)}},re=async(s,n,h)=>{try{j(n);const u=new FormData;u.append("voucher_file",h),u.append("declared_amount",String(l?.installments.find(P=>P.id===n)?.totalDue||l?.installments.find(P=>P.id===n)?.amount||0)),u.append("payment_date",new Date().toISOString().split("T")[0]),u.append("payment_method","transfer"),await q.post(`/api/student/vouchers/${s}/replace`,u,{headers:{"Content-Type":"multipart/form-data"}}),d.success("Voucher reemplazado exitosamente",{description:"El nuevo comprobante est√° siendo verificado"}),await A()}catch(u){console.error("Error replacing voucher:",u);const P=u;console.error("Server response:",P.response?.data);const I=P.response?.data,Z=I&&typeof I=="object"&&"message"in I?I.message:String(I??"");d.error("Error al reemplazar voucher",{description:Z||"No se pudo reemplazar el comprobante"})}finally{j(null)}},fe=s=>{if(s.status==="verified")return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#17BC91]/10 text-[#17BC91] border border-[#17BC91]/30",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Verificado"]});if(s.status==="paid"){if(s.paymentType==="partial"||s.paymentType==="combined"){const P=s.paidAmount||0;return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 border border-blue-300",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"Pago Parcial: ",x(P)," de ",x(s.totalDue)]})}return e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#073372]/10 text-[#073372] border border-[#073372]/30",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"En Verificaci√≥n"]})}const n=s.daysUntilDue||0,h=s.daysUntilGraceLimit||0,u=s.gracePeriodDays||0;return n<0&&h>=0&&u>0?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 border border-orange-300",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Per√≠odo de Gracia (",h," d√≠as restantes)"]}):s.isOverdue||h<0&&s.status==="pending"?e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-300",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Vencido con Mora (",Math.abs(h)," d√≠as)"]}):e.jsxs("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-[#F98613]/10 text-[#F98613] border border-[#F98613]/30",children:[e.jsx(Q,{className:"w-3 h-3 mr-1"}),"Pendiente (",n>0?`${n} d√≠as`:"Vence hoy",")"]})},x=s=>new Intl.NumberFormat("es-PE",{style:"currency",currency:"PEN"}).format(s),X=s=>new Date(s).toLocaleDateString("es-PE",{year:"numeric",month:"long",day:"numeric"});return v?e.jsx(se,{children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-slate-600",children:"Cargando informaci√≥n de pagos..."})]})})}):l?e.jsx(se,{children:e.jsxs("div",{className:"p-8 max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-slate-900 tracking-tight",children:"Control de Pagos"}),e.jsx("p",{className:"text-slate-600 mt-1",children:"Gestiona tus cuotas y comprobantes de pago"})]}),e.jsxs("div",{className:"flex gap-3",children:[S&&e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-all shadow-md hover:shadow-lg",children:[e.jsx(Fe,{className:"w-4 h-4 mr-2"}),"Cambiar Plan"]}),e.jsxs("button",{onClick:()=>y(!0),className:"inline-flex items-center px-4 py-2 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white font-medium rounded-lg transition-all shadow-md hover:shadow-lg",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Pago Parcial"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-[#073372] to-[#17BC91] text-white rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ce,{className:"w-8 h-8 opacity-80"}),e.jsx(Pe,{className:"w-5 h-5 opacity-60"})]}),e.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Total a Pagar"}),e.jsx("p",{className:"text-2xl font-bold",children:x(l.paymentPlan.totalAmount)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(de,{className:"w-8 h-8 text-[#17BC91]"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Pagado"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:x(l.totalPaid)}),e.jsxs("p",{className:"text-xs text-[#17BC91] mt-1",children:[l.paymentProgress.toFixed(0),"% completado"]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Q,{className:"w-8 h-8 text-[#F98613]"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Pendiente"}),e.jsx("p",{className:"text-2xl font-bold text-slate-900",children:x(l.totalPending)})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(me,{className:"w-8 h-8 text-[#073372]"})}),e.jsx("p",{className:"text-sm text-slate-600 mb-1",children:"Plan de Pago"}),e.jsxs("p",{className:"text-xl font-bold text-slate-900",children:[l.paymentPlan.installmentsCount," cuotas"]}),e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:l.paymentPlan.name})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:"Progreso de Pagos"}),e.jsxs("span",{className:"text-sm font-medium text-blue-600",children:[l.paymentProgress.toFixed(0),"%"]})]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-3",children:e.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-blue-700 h-3 rounded-full transition-all duration-500",style:{width:`${l.paymentProgress}%`}})})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg border border-slate-200",children:[e.jsxs("div",{className:"p-6 border-b border-slate-200",children:[e.jsx("h2",{className:"text-xl font-bold text-slate-900",children:"Cronograma de Cuotas"}),e.jsx("p",{className:"text-sm text-slate-600 mt-1",children:"Administra tus pagos mensuales y sube tus comprobantes"})]}),e.jsx("div",{className:"divide-y divide-slate-200",children:l.installments.map(s=>e.jsxs("div",{className:"p-6 hover:bg-slate-50 transition-colors",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs("h3",{className:"text-lg font-semibold text-slate-900",children:["Cuota #",s.installmentNumber]}),fe(s)]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Fecha de Vencimiento"}),e.jsxs("p",{className:"font-medium text-slate-900 flex items-center",children:[e.jsx(Se,{className:"w-4 h-4 mr-1 text-blue-600"}),X(s.dueDate)]}),s.daysUntilDue!==void 0&&s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:`text-xs mt-1 ${s.daysUntilDue<7&&s.daysUntilDue>=0?"text-orange-600 font-semibold":s.daysUntilDue<0?"text-red-600":"text-slate-500"}`,children:s.daysUntilDue>0?`Faltan ${s.daysUntilDue} d√≠as`:s.daysUntilDue===0?"¬°Vence hoy!":`Vencido hace ${Math.abs(s.daysUntilDue)} d√≠as`}),s.daysUntilDue<0&&s.daysUntilGraceLimit!==void 0&&s.daysUntilGraceLimit>=0&&s.gracePeriodDays&&s.gracePeriodDays>0&&e.jsxs("p",{className:"text-xs mt-1 text-orange-600 font-semibold bg-orange-50 px-2 py-1 rounded inline-block",children:["‚ö†Ô∏è Per√≠odo de gracia: ",s.daysUntilGraceLimit," d√≠as restantes"]}),s.daysUntilGraceLimit!==void 0&&s.daysUntilGraceLimit<0&&e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("p",{className:"text-xs text-red-600 font-bold bg-red-50 px-2 py-1 rounded inline-block",children:["üö® Mora aplicada (",Math.abs(s.daysUntilGraceLimit)," d√≠as)"]}),s.lateFee>0&&e.jsxs("p",{className:"text-xs text-red-700 font-bold bg-red-100 px-2 py-1 rounded inline-block",children:["üí∞ Recargo por mora: ",x(s.lateFee)]})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Monto"}),e.jsx("p",{className:"font-bold text-slate-900",children:x(s.amount)}),s.lateFee>0&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 font-semibold",children:["+ ",x(s.lateFee)," mora"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Total a Pagar"}),e.jsx("p",{className:"font-bold text-blue-600",children:x(s.totalDue)}),s.lateFee>0&&e.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"(Incluye mora)"}),(s.paymentType==="partial"||s.paymentType==="combined")&&s.remainingAmount&&s.remainingAmount>0&&e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-xs text-blue-600 font-semibold",children:["Pagado: ",x(s.paidAmount)]}),e.jsxs("p",{className:"text-xs text-orange-600 font-semibold",children:["Restante: ",x(s.remainingAmount)]}),e.jsx("div",{className:"w-full bg-slate-200 rounded-full h-1.5 mt-1",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full transition-all duration-300",style:{width:`${s.paidAmount/s.totalDue*100}%`}})})]})]}),s.paidDate&&e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 mb-1",children:"Fecha de Pago"}),e.jsx("p",{className:"font-medium text-green-600",children:X(s.paidDate)})]})]})]})}),s.vouchers.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-slate-700",children:"Comprobantes Subidos:"}),s.vouchers.map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded-lg border border-slate-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"w-5 h-5 text-slate-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-slate-900",children:x(n.declaredAmount)}),e.jsxs("p",{className:"text-xs text-slate-500",children:[X(n.paymentDate)," ¬∑ ",n.paymentMethod]}),n.status==="rejected"&&n.rejectionReason&&e.jsxs("p",{className:"text-xs text-red-600 mt-1 italic",children:["Motivo: ",n.rejectionReason]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[n.status==="approved"&&e.jsx("span",{className:"text-xs px-3 py-1 bg-green-100 text-green-800 rounded-full font-medium",children:"‚úì Aprobado"}),n.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full font-medium animate-pulse",children:"‚è≥ En revisi√≥n"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:h=>{const u=h.target.files?.[0];u&&re(n.id,s.id,u)},disabled:g===s.id,className:"hidden"}),e.jsxs("div",{className:"px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-medium rounded-lg transition-colors flex items-center space-x-1",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:"Reemplazar"})]})]})]}),n.status==="rejected"&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs px-3 py-1 bg-red-100 text-red-800 rounded-full font-medium",children:"‚úó Rechazado"}),e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:h=>{const u=h.target.files?.[0];u&&re(n.id,s.id,u)},disabled:g===s.id,className:"hidden"}),e.jsxs("div",{className:"px-3 py-1.5 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white text-xs font-medium rounded-lg transition-colors flex items-center space-x-1",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:"Subir Nuevo"})]})]})]}),e.jsx("a",{href:n.voucherUrl,target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-white rounded-lg transition-colors",title:"Descargar voucher",children:e.jsx(ve,{className:"w-4 h-4 text-blue-600"})})]})]},n.id))]}),(s.status==="pending"||s.status==="late"||s.isOverdue)&&(!s.vouchers.length||s.vouchers.every(n=>n.status==="rejected"))&&e.jsxs("div",{className:"mt-4",children:[s.vouchers.some(n=>n.status==="rejected")&&e.jsx("div",{className:"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 font-medium flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Tu voucher anterior fue rechazado. Por favor, realiza un nuevo pago."]})}),s.lateFee>0&&e.jsxs("div",{className:"mb-3 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-orange-800 font-bold flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Esta cuota tiene mora. Debes pagar el total: ",x(s.totalDue)]}),e.jsxs("p",{className:"text-xs text-orange-700 mt-1",children:["Monto original: ",x(s.amount)," + Mora: ",x(s.lateFee)]})]}),e.jsx("button",{onClick:()=>{V(s),$(!0)},disabled:g===s.id,className:"w-full flex items-center justify-center px-6 py-4 bg-gradient-to-r from-[#073372] to-[#17BC91] hover:from-[#073372]/90 hover:to-[#17BC91]/90 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed",children:g===s.id?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.jsx("span",{children:"Procesando..."})]}):e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(te,{className:"w-5 h-5"}),e.jsxs("span",{children:["Pagar ",x(s.totalDue)]})]})})]})]},s.id))})]}),_&&p&&e.jsx(Be,{isOpen:_,onClose:()=>{$(!1),V(null)},onSelectMethod:s=>{$(!1),s==="card"?z(!0):s==="yape"?L(!0):s==="transfer"&&G(!0)},installmentAmount:p.totalDue}),W&&p&&e.jsx(qe,{isOpen:W,onClose:()=>{z(!1),V(null)},onSuccess:()=>{A()},installment:{id:Number(p.id),amount:p.totalDue,installment_number:p.installmentNumber}}),Y&&p&&e.jsx(Ae,{isOpen:Y,onClose:()=>{L(!1),V(null)},onSuccess:()=>{A()},installmentId:p.id,amount:p.totalDue}),U&&p&&e.jsx(Ie,{isOpen:U,onClose:()=>{G(!1),V(null)},onSuccess:()=>{A()},installmentId:p.id,amount:p.totalDue}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-900",children:"Cambiar Plan de Pago"}),e.jsx("button",{onClick:()=>i(!1),className:"text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(K,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-blue-900 mb-2",children:"Plan Actual:"}),e.jsx("p",{className:"text-lg font-bold text-blue-700",children:l.paymentPlan.name}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Total:"}),e.jsx("p",{className:"font-bold text-blue-900",children:x(l.paymentPlan.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-blue-600",children:"Cuotas:"}),e.jsxs("p",{className:"font-bold text-blue-900",children:[l.paymentPlan.installmentsCount," mensuales"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-3",children:"Selecciona tu nuevo plan:"}),e.jsx("div",{className:"space-y-3",children:E.map(s=>e.jsxs("label",{className:`block p-4 border-2 rounded-lg cursor-pointer transition-all ${w===s.id?"border-[#17BC91] bg-[#17BC91]/5":"border-slate-200 hover:border-slate-300"}`,children:[e.jsx("input",{type:"radio",name:"new_plan",value:s.id,checked:w===s.id,onChange:()=>B(s.id),className:"hidden"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-900",children:s.name}),e.jsxs("p",{className:"text-sm text-slate-600 mt-1",children:[s.installmentsCount," cuotas de ",x(s.monthlyAmount)]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-600",children:"Total"}),e.jsx("p",{className:"text-lg font-bold text-[#073372]",children:x(s.totalAmount)})]})]})]},s.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Raz√≥n del cambio (opcional):"}),e.jsx("textarea",{value:T,onChange:s=>k(s.target.value),placeholder:"Ej: Cambio por disponibilidad econ√≥mica",rows:3,className:"w-full px-4 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-[#17BC91] focus:border-transparent"})]}),e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-sm text-orange-900",children:[e.jsx("strong",{children:"‚ö†Ô∏è Importante:"})," Al cambiar de plan, tus cuotas pendientes ser√°n canceladas y se generar√°n nuevas seg√∫n el plan seleccionado."]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-6 py-2 border border-slate-300 text-slate-700 font-medium rounded-lg hover:bg-slate-50 transition-colors",children:"Cancelar"}),e.jsx("button",{onClick:he,disabled:!w||C,className:"px-6 py-2 bg-[#17BC91] hover:bg-[#17BC91]/90 text-white font-medium rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Cambiando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"w-4 h-4 mr-2"}),"Confirmar Cambio"]})})]})]})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-lg w-full",children:[e.jsxs("div",{className:"bg-gradient-to-r from-[#073372] to-[#17BC91] text-white px-6 py-4 rounded-t-2xl flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Pago Parcial"}),e.jsx("button",{onClick:()=>{y(!1),a("")},className:"text-white/80 hover:text-white transition-colors",children:e.jsx(K,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"bg-slate-50 rounded-lg p-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600",children:"Total del plan:"}),e.jsx("p",{className:"text-lg font-bold text-slate-900",children:x(l.paymentPlan.totalAmount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-600",children:"Pendiente:"}),e.jsx("p",{className:"text-lg font-bold text-orange-600",children:x(l.totalPending)})]})]})}),e.jsxs("div",{children:[e.jsx("div",{className:"relative",children:e.jsx(we,{label:"Monto a pagar",type:"number",value:r,onChange:s=>a(s.target.value),placeholder:"0.00",min:.01,max:l.totalPending,step:.01,icon:e.jsx("span",{className:"text-slate-500 font-medium",children:"S/"}),helperText:`Monto m√°ximo: ${x(l.totalPending)}`,variant:"outlined"})}),r&&parseFloat(r)>l.totalPending&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("p",{className:"text-sm text-red-800 font-medium flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"El monto ingresado (",x(parseFloat(r)),") excede tu deuda pendiente (",x(l.totalPending),")"]})})]}),r&&parseFloat(r)>0&&parseFloat(r)<=l.totalPending&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm font-medium text-green-900 mb-2",children:"‚úÖ Distribuci√≥n autom√°tica:"}),e.jsxs("p",{className:"text-xs text-green-700",children:["El monto de ",x(parseFloat(r))," se aplicar√° a tus cuotas m√°s antiguas primero, cubriendo mora si existe."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-2",children:"Comprobante de pago:"}),e.jsx("input",{type:"file",accept:"image/*,.pdf",onChange:s=>{const n=s.target.files?.[0];n&&be(n)},disabled:c||!r||parseFloat(r)<=0||parseFloat(r)>l.totalPending,className:"hidden",id:"partial-payment-file"}),e.jsx("label",{htmlFor:"partial-payment-file",className:`block w-full px-4 py-3 border-2 border-dashed rounded-lg text-center cursor-pointer transition-all ${c||!r||parseFloat(r)<=0||parseFloat(r)>l.totalPending?"border-slate-200 bg-slate-50 cursor-not-allowed":"border-[#17BC91] hover:bg-[#17BC91]/5"}`,children:c?e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-[#17BC91]",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-[#17BC91]"}),e.jsx("span",{className:"font-medium",children:"Procesando..."})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-slate-700",children:[e.jsx(O,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Seleccionar comprobante"})]})})]})]})]})})]})}):e.jsx(se,{children:e.jsx("div",{className:"p-8 max-w-7xl mx-auto",children:e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-6 text-center",children:[e.jsx(R,{className:"w-12 h-12 text-yellow-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-900 mb-2",children:"No tienes matr√≠cula activa"}),e.jsx("p",{className:"text-slate-600",children:"Contacta con el √°rea de admisiones para m√°s informaci√≥n."})]})})})};export{cs as default};
